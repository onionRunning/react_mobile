a2dd955674087ebcfc9691e4184d7fe0
var select = require('css-select'),
    utils = require('../utils'),
    domEach = utils.domEach,
    uniqueSort = require('htmlparser2').DomUtils.uniqueSort,
    isTag = utils.isTag,
    _ = {
  bind: require('lodash/bind'),
  forEach: require('lodash/forEach'),
  reject: require('lodash/reject'),
  filter: require('lodash/filter'),
  reduce: require('lodash/reduce')
};

exports.find = function (selectorOrHaystack) {
  var elems = _.reduce(this, function (memo, elem) {
    return memo.concat(_.filter(elem.children, isTag));
  }, []);

  var contains = this.constructor.contains;
  var haystack;

  if (selectorOrHaystack && typeof selectorOrHaystack !== 'string') {
    if (selectorOrHaystack.cheerio) {
      haystack = selectorOrHaystack.get();
    } else {
      haystack = [selectorOrHaystack];
    }

    return this._make(haystack.filter(function (elem) {
      var idx, len;

      for (idx = 0, len = this.length; idx < len; ++idx) {
        if (contains(this[idx], elem)) {
          return true;
        }
      }
    }, this));
  }

  var options = {
    __proto__: this.options,
    context: this.toArray()
  };
  return this._make(select(selectorOrHaystack, elems, options));
}; // Get the parent of each element in the current set of matched elements,
// optionally filtered by a selector.


exports.parent = function (selector) {
  var set = [];
  domEach(this, function (idx, elem) {
    var parentElem = elem.parent;

    if (parentElem && set.indexOf(parentElem) < 0) {
      set.push(parentElem);
    }
  });

  if (arguments.length) {
    set = exports.filter.call(set, selector, this);
  }

  return this._make(set);
};

exports.parents = function (selector) {
  var parentNodes = []; // When multiple DOM elements are in the original set, the resulting set will
  // be in *reverse* order of the original elements as well, with duplicates
  // removed.

  this.get().reverse().forEach(function (elem) {
    traverseParents(this, elem.parent, selector, Infinity).forEach(function (node) {
      if (parentNodes.indexOf(node) === -1) {
        parentNodes.push(node);
      }
    });
  }, this);
  return this._make(parentNodes);
};

exports.parentsUntil = function (selector, filter) {
  var parentNodes = [],
      untilNode,
      untilNodes;

  if (typeof selector === 'string') {
    untilNode = select(selector, this.parents().toArray(), this.options)[0];
  } else if (selector && selector.cheerio) {
    untilNodes = selector.toArray();
  } else if (selector) {
    untilNode = selector;
  } // When multiple DOM elements are in the original set, the resulting set will
  // be in *reverse* order of the original elements as well, with duplicates
  // removed.


  this.toArray().reverse().forEach(function (elem) {
    while (elem = elem.parent) {
      if (untilNode && elem !== untilNode || untilNodes && untilNodes.indexOf(elem) === -1 || !untilNode && !untilNodes) {
        if (isTag(elem) && parentNodes.indexOf(elem) === -1) {
          parentNodes.push(elem);
        }
      } else {
        break;
      }
    }
  }, this);
  return this._make(filter ? select(filter, parentNodes, this.options) : parentNodes);
}; // For each element in the set, get the first element that matches the selector
// by testing the element itself and traversing up through its ancestors in the
// DOM tree.


exports.closest = function (selector) {
  var set = [];

  if (!selector) {
    return this._make(set);
  }

  domEach(this, function (idx, elem) {
    var closestElem = traverseParents(this, elem, selector, 1)[0]; // Do not add duplicate elements to the set

    if (closestElem && set.indexOf(closestElem) < 0) {
      set.push(closestElem);
    }
  }.bind(this));
  return this._make(set);
};

exports.next = function (selector) {
  if (!this[0]) {
    return this;
  }

  var elems = [];

  _.forEach(this, function (elem) {
    while (elem = elem.next) {
      if (isTag(elem)) {
        elems.push(elem);
        return;
      }
    }
  });

  return selector ? exports.filter.call(elems, selector, this) : this._make(elems);
};

exports.nextAll = function (selector) {
  if (!this[0]) {
    return this;
  }

  var elems = [];

  _.forEach(this, function (elem) {
    while (elem = elem.next) {
      if (isTag(elem) && elems.indexOf(elem) === -1) {
        elems.push(elem);
      }
    }
  });

  return selector ? exports.filter.call(elems, selector, this) : this._make(elems);
};

exports.nextUntil = function (selector, filterSelector) {
  if (!this[0]) {
    return this;
  }

  var elems = [],
      untilNode,
      untilNodes;

  if (typeof selector === 'string') {
    untilNode = select(selector, this.nextAll().get(), this.options)[0];
  } else if (selector && selector.cheerio) {
    untilNodes = selector.get();
  } else if (selector) {
    untilNode = selector;
  }

  _.forEach(this, function (elem) {
    while (elem = elem.next) {
      if (untilNode && elem !== untilNode || untilNodes && untilNodes.indexOf(elem) === -1 || !untilNode && !untilNodes) {
        if (isTag(elem) && elems.indexOf(elem) === -1) {
          elems.push(elem);
        }
      } else {
        break;
      }
    }
  });

  return filterSelector ? exports.filter.call(elems, filterSelector, this) : this._make(elems);
};

exports.prev = function (selector) {
  if (!this[0]) {
    return this;
  }

  var elems = [];

  _.forEach(this, function (elem) {
    while (elem = elem.prev) {
      if (isTag(elem)) {
        elems.push(elem);
        return;
      }
    }
  });

  return selector ? exports.filter.call(elems, selector, this) : this._make(elems);
};

exports.prevAll = function (selector) {
  if (!this[0]) {
    return this;
  }

  var elems = [];

  _.forEach(this, function (elem) {
    while (elem = elem.prev) {
      if (isTag(elem) && elems.indexOf(elem) === -1) {
        elems.push(elem);
      }
    }
  });

  return selector ? exports.filter.call(elems, selector, this) : this._make(elems);
};

exports.prevUntil = function (selector, filterSelector) {
  if (!this[0]) {
    return this;
  }

  var elems = [],
      untilNode,
      untilNodes;

  if (typeof selector === 'string') {
    untilNode = select(selector, this.prevAll().get(), this.options)[0];
  } else if (selector && selector.cheerio) {
    untilNodes = selector.get();
  } else if (selector) {
    untilNode = selector;
  }

  _.forEach(this, function (elem) {
    while (elem = elem.prev) {
      if (untilNode && elem !== untilNode || untilNodes && untilNodes.indexOf(elem) === -1 || !untilNode && !untilNodes) {
        if (isTag(elem) && elems.indexOf(elem) === -1) {
          elems.push(elem);
        }
      } else {
        break;
      }
    }
  });

  return filterSelector ? exports.filter.call(elems, filterSelector, this) : this._make(elems);
};

exports.siblings = function (selector) {
  var parent = this.parent();

  var elems = _.filter(parent ? parent.children() : this.siblingsAndMe(), _.bind(function (elem) {
    return isTag(elem) && !this.is(elem);
  }, this));

  if (selector !== undefined) {
    return exports.filter.call(elems, selector, this);
  } else {
    return this._make(elems);
  }
};

exports.children = function (selector) {
  var elems = _.reduce(this, function (memo, elem) {
    return memo.concat(_.filter(elem.children, isTag));
  }, []);

  if (selector === undefined) return this._make(elems);
  return exports.filter.call(elems, selector, this);
};

exports.contents = function () {
  return this._make(_.reduce(this, function (all, elem) {
    all.push.apply(all, elem.children);
    return all;
  }, []));
};

exports.each = function (fn) {
  var i = 0,
      len = this.length;

  while (i < len && fn.call(this[i], i, this[i]) !== false) ++i;

  return this;
};

exports.map = function (fn) {
  return this._make(_.reduce(this, function (memo, el, i) {
    var val = fn.call(el, i, el);
    return val == null ? memo : memo.concat(val);
  }, []));
};

var makeFilterMethod = function (filterFn) {
  return function (match, container) {
    var testFn;
    container = container || this;

    if (typeof match === 'string') {
      testFn = select.compile(match, container.options);
    } else if (typeof match === 'function') {
      testFn = function (el, i) {
        return match.call(el, i, el);
      };
    } else if (match.cheerio) {
      testFn = match.is.bind(match);
    } else {
      testFn = function (el) {
        return match === el;
      };
    }

    return container._make(filterFn(this, testFn));
  };
};

exports.filter = makeFilterMethod(_.filter);
exports.not = makeFilterMethod(_.reject);

exports.has = function (selectorOrHaystack) {
  var that = this;
  return exports.filter.call(this, function () {
    return that._make(this).find(selectorOrHaystack).length > 0;
  });
};

exports.first = function () {
  return this.length > 1 ? this._make(this[0]) : this;
};

exports.last = function () {
  return this.length > 1 ? this._make(this[this.length - 1]) : this;
}; // Reduce the set of matched elements to the one at the specified index.


exports.eq = function (i) {
  i = +i; // Use the first identity optimization if possible

  if (i === 0 && this.length <= 1) return this;
  if (i < 0) i = this.length + i;
  return this[i] ? this._make(this[i]) : this._make([]);
}; // Retrieve the DOM elements matched by the jQuery object.


exports.get = function (i) {
  if (i == null) {
    return Array.prototype.slice.call(this);
  } else {
    return this[i < 0 ? this.length + i : i];
  }
}; // Search for a given element from among the matched elements.


exports.index = function (selectorOrNeedle) {
  var $haystack, needle;

  if (arguments.length === 0) {
    $haystack = this.parent().children();
    needle = this[0];
  } else if (typeof selectorOrNeedle === 'string') {
    $haystack = this._make(selectorOrNeedle);
    needle = this[0];
  } else {
    $haystack = this;
    needle = selectorOrNeedle.cheerio ? selectorOrNeedle[0] : selectorOrNeedle;
  }

  return $haystack.get().indexOf(needle);
};

exports.slice = function () {
  return this._make([].slice.apply(this, arguments));
};

function traverseParents(self, elem, selector, limit) {
  var elems = [];

  while (elem && elems.length < limit) {
    if (!selector || exports.filter.call([elem], selector, self).length) {
      elems.push(elem);
    }

    elem = elem.parent;
  }

  return elems;
} // End the most recent filtering operation in the current chain and return the
// set of matched elements to its previous state.


exports.end = function () {
  return this.prevObject || this._make([]);
};

exports.add = function (other, context) {
  var selection = this._make(other, context);

  var contents = uniqueSort(selection.get().concat(this.get()));

  for (var i = 0; i < contents.length; ++i) {
    selection[i] = contents[i];
  }

  selection.length = contents.length;
  return selection;
}; // Add the previous set of elements on the stack to the current set, optionally
// filtered by a selector.


exports.addBack = function (selector) {
  return this.add(arguments.length ? this.prevObject.filter(selector) : this.prevObject);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRyYXZlcnNpbmcuanMiXSwibmFtZXMiOlsic2VsZWN0IiwicmVxdWlyZSIsInV0aWxzIiwiZG9tRWFjaCIsInVuaXF1ZVNvcnQiLCJEb21VdGlscyIsImlzVGFnIiwiXyIsImJpbmQiLCJmb3JFYWNoIiwicmVqZWN0IiwiZmlsdGVyIiwicmVkdWNlIiwiZXhwb3J0cyIsImZpbmQiLCJzZWxlY3Rvck9ySGF5c3RhY2siLCJlbGVtcyIsIm1lbW8iLCJlbGVtIiwiY29uY2F0IiwiY2hpbGRyZW4iLCJjb250YWlucyIsImNvbnN0cnVjdG9yIiwiaGF5c3RhY2siLCJjaGVlcmlvIiwiZ2V0IiwiX21ha2UiLCJpZHgiLCJsZW4iLCJsZW5ndGgiLCJvcHRpb25zIiwiX19wcm90b19fIiwiY29udGV4dCIsInRvQXJyYXkiLCJwYXJlbnQiLCJzZWxlY3RvciIsInNldCIsInBhcmVudEVsZW0iLCJpbmRleE9mIiwicHVzaCIsImFyZ3VtZW50cyIsImNhbGwiLCJwYXJlbnRzIiwicGFyZW50Tm9kZXMiLCJyZXZlcnNlIiwidHJhdmVyc2VQYXJlbnRzIiwiSW5maW5pdHkiLCJub2RlIiwicGFyZW50c1VudGlsIiwidW50aWxOb2RlIiwidW50aWxOb2RlcyIsImNsb3Nlc3QiLCJjbG9zZXN0RWxlbSIsIm5leHQiLCJuZXh0QWxsIiwibmV4dFVudGlsIiwiZmlsdGVyU2VsZWN0b3IiLCJwcmV2IiwicHJldkFsbCIsInByZXZVbnRpbCIsInNpYmxpbmdzIiwic2libGluZ3NBbmRNZSIsImlzIiwidW5kZWZpbmVkIiwiY29udGVudHMiLCJhbGwiLCJhcHBseSIsImVhY2giLCJmbiIsImkiLCJtYXAiLCJlbCIsInZhbCIsIm1ha2VGaWx0ZXJNZXRob2QiLCJmaWx0ZXJGbiIsIm1hdGNoIiwiY29udGFpbmVyIiwidGVzdEZuIiwiY29tcGlsZSIsIm5vdCIsImhhcyIsInRoYXQiLCJmaXJzdCIsImxhc3QiLCJlcSIsIkFycmF5IiwicHJvdG90eXBlIiwic2xpY2UiLCJpbmRleCIsInNlbGVjdG9yT3JOZWVkbGUiLCIkaGF5c3RhY2siLCJuZWVkbGUiLCJzZWxmIiwibGltaXQiLCJlbmQiLCJwcmV2T2JqZWN0IiwiYWRkIiwib3RoZXIiLCJzZWxlY3Rpb24iLCJhZGRCYWNrIl0sIm1hcHBpbmdzIjoiQUFBQSxJQUFJQSxNQUFNLEdBQUdDLE9BQU8sQ0FBQyxZQUFELENBQXBCO0FBQUEsSUFDSUMsS0FBSyxHQUFHRCxPQUFPLENBQUMsVUFBRCxDQURuQjtBQUFBLElBRUlFLE9BQU8sR0FBR0QsS0FBSyxDQUFDQyxPQUZwQjtBQUFBLElBR0lDLFVBQVUsR0FBR0gsT0FBTyxDQUFDLGFBQUQsQ0FBUCxDQUF1QkksUUFBdkIsQ0FBZ0NELFVBSGpEO0FBQUEsSUFJSUUsS0FBSyxHQUFHSixLQUFLLENBQUNJLEtBSmxCO0FBQUEsSUFLSUMsQ0FBQyxHQUFHO0FBQ0ZDLEVBQUFBLElBQUksRUFBRVAsT0FBTyxDQUFDLGFBQUQsQ0FEWDtBQUVGUSxFQUFBQSxPQUFPLEVBQUVSLE9BQU8sQ0FBQyxnQkFBRCxDQUZkO0FBR0ZTLEVBQUFBLE1BQU0sRUFBRVQsT0FBTyxDQUFDLGVBQUQsQ0FIYjtBQUlGVSxFQUFBQSxNQUFNLEVBQUVWLE9BQU8sQ0FBQyxlQUFELENBSmI7QUFLRlcsRUFBQUEsTUFBTSxFQUFFWCxPQUFPLENBQUMsZUFBRDtBQUxiLENBTFI7O0FBYUFZLE9BQU8sQ0FBQ0MsSUFBUixHQUFlLFVBQVNDLGtCQUFULEVBQTZCO0FBQzFDLE1BQUlDLEtBQUssR0FBR1QsQ0FBQyxDQUFDSyxNQUFGLENBQVMsSUFBVCxFQUFlLFVBQVNLLElBQVQsRUFBZUMsSUFBZixFQUFxQjtBQUM5QyxXQUFPRCxJQUFJLENBQUNFLE1BQUwsQ0FBWVosQ0FBQyxDQUFDSSxNQUFGLENBQVNPLElBQUksQ0FBQ0UsUUFBZCxFQUF3QmQsS0FBeEIsQ0FBWixDQUFQO0FBQ0QsR0FGVyxFQUVULEVBRlMsQ0FBWjs7QUFHQSxNQUFJZSxRQUFRLEdBQUcsS0FBS0MsV0FBTCxDQUFpQkQsUUFBaEM7QUFDQSxNQUFJ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QUlBYixPQUFPLENBQUNtRixHQUFSLEdBQWMsVUFBU0MsS0FBVCxFQUFnQmpFLE9BQWhCLEVBQXlCO0FBQ3JDLE1BQUlrRSxTQUFTLEdBQUcsS0FBS3hFLEtBQUwsQ0FBV3VFLEtBQVgsRUFBa0JqRSxPQUFsQixDQUFoQjs7QUFDQSxNQUFJZ0MsUUFBUSxHQUFHNUQsVUFBVSxDQUFDOEYsU0FBUyxDQUFDekUsR0FBVixHQUFnQk4sTUFBaEIsQ0FBdUIsS0FBS00sR0FBTCxFQUF2QixDQUFELENBQXpCOztBQUVBLE9BQUssSUFBSTRDLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUdMLFFBQVEsQ0FBQ25DLE1BQTdCLEVBQXFDLEVBQUV3QyxDQUF2QyxFQUEwQztBQUN4QzZCLElBQUFBLFNBQVMsQ0FBQzdCLENBQUQsQ0FBVCxHQUFlTCxRQUFRLENBQUNLLENBQUQsQ0FBdkI7QUFDRDs7QUFDRDZCLEVBQUFBLFNBQVMsQ0FBQ3JFLE1BQVYsR0FBbUJtQyxRQUFRLENBQUNuQyxNQUE1QjtBQUVBLFNBQU9xRSxTQUFQO0FBQ0QsQ0FWRCxDLENBWUE7QUFDQTs7O0FBQ0FyRixPQUFPLENBQUNzRixPQUFSLEdBQWtCLFVBQVNoRSxRQUFULEVBQW1CO0FBQ25DLFNBQU8sS0FBSzZELEdBQUwsQ0FDTHhELFNBQVMsQ0FBQ1gsTUFBVixHQUFtQixLQUFLa0UsVUFBTCxDQUFnQnBGLE1BQWhCLENBQXVCd0IsUUFBdkIsQ0FBbkIsR0FBc0QsS0FBSzRELFVBRHRELENBQVA7QUFHRCxDQUpEIiwic291cmNlc0NvbnRlbnQiOlsidmFyIHNlbGVjdCA9IHJlcXVpcmUoJ2Nzcy1zZWxlY3QnKSxcbiAgICB1dGlscyA9IHJlcXVpcmUoJy4uL3V0aWxzJyksXG4gICAgZG9tRWFjaCA9IHV0aWxzLmRvbUVhY2gsXG4gICAgdW5pcXVlU29ydCA9IHJlcXVpcmUoJ2h0bWxwYXJzZXIyJykuRG9tVXRpbHMudW5pcXVlU29ydCxcbiAgICBpc1RhZyA9IHV0aWxzLmlzVGFnLFxuICAgIF8gPSB7XG4gICAgICBiaW5kOiByZXF1aXJlKCdsb2Rhc2gvYmluZCcpLFxuICAgICAgZm9yRWFjaDogcmVxdWlyZSgnbG9kYXNoL2ZvckVhY2gnKSxcbiAgICAgIHJlamVjdDogcmVxdWlyZSgnbG9kYXNoL3JlamVjdCcpLFxuICAgICAgZmlsdGVyOiByZXF1aXJlKCdsb2Rhc2gvZmlsdGVyJyksXG4gICAgICByZWR1Y2U6IHJlcXVpcmUoJ2xvZGFzaC9yZWR1Y2UnKVxuICAgIH07XG5cbmV4cG9ydHMuZmluZCA9IGZ1bmN0aW9uKHNlbGVjdG9yT3JIYXlzdGFjaykge1xuICB2YXIgZWxlbXMgPSBfLnJlZHVjZSh0aGlzLCBmdW5jdGlvbihtZW1vLCBlbGVtKSB7XG4gICAgcmV0dXJuIG1lbW8uY29uY2F0KF8uZmlsdGVyKGVsZW0uY2hpbGRyZW4sIGlzVGFnKSk7XG4gIH0sIFtdKTtcbiAgdmFyIGNvbnRhaW5zID0gdGhpcy5jb25zdHJ1Y3Rvci5jb250YWlucztcbiAgdmFyIGhheXN0YWNrO1xuXG4gIGlmIChzZWxlY3Rvck9ySGF5c3RhY2sgJiYgdHlwZW9mIHNlbGVjdG9yT3JIYXlzdGFjayAhPT0gJ3N0cmluZycpIHtcbiAgICBpZiAoc2VsZWN0b3JPckhheXN0YWNrLmNoZWVyaW8pIHtcbiAgICAgIGhheXN0YWNrID0gc2VsZWN0b3JPckhheXN0YWNrLmdldCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBoYXlzdGFjayA9IFtzZWxlY3Rvck9ySGF5c3RhY2tdO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLl9tYWtlKGhheXN0YWNrLmZpbHRlcihmdW5jdGlvbihlbGVtKSB7XG4gICAgICB2YXIgaWR4LCBsZW47XG4gICAgICBmb3IgKGlkeCA9IDAsIGxlbiA9IHRoaXMubGVuZ3RoOyBpZHggPCBsZW47ICsraWR4KSB7XG4gICAgICAgIGlmIChjb250YWlucyh0aGlzW2lkeF0sIGVsZW0pKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LCB0aGlzKSk7XG4gIH1cblxuICB2YXIgb3B0aW9ucyA9IHtfX3Byb3RvX186IHRoaXMub3B0aW9ucywgY29udGV4dDogdGhpcy50b0FycmF5KCl9O1xuXG4gIHJldHVybiB0aGlzLl9tYWtlKHNlbGVjdChzZWxlY3Rvck9ySGF5c3RhY2ssIGVsZW1zLCBvcHRpb25zKSk7XG59O1xuXG4vLyBHZXQgdGhlIHBhcmVudCBvZiBlYWNoIGVsZW1lbnQgaW4gdGhlIGN1cnJlbnQgc2V0IG9mIG1hdGNoZWQgZWxlbWVudHMsXG4vLyBvcHRpb25hbGx5IGZpbHRlcmVkIGJ5IGEgc2VsZWN0b3IuXG5leHBvcnRzLnBhcmVudCA9IGZ1bmN0aW9uKHNlbGVjdG9yKSB7XG4gIHZhciBzZXQgPSBbXTtcblxuICBkb21FYWNoKHRoaXMsIGZ1bmN0aW9uKGlkeCwgZWxlbSkge1xuICAgIHZhciBwYXJlbnRFbGVtID0gZWxlbS5wYXJlbnQ7XG4gICAgaWYgKHBhcmVudEVsZW0gJiYgc2V0LmluZGV4T2YocGFyZW50RWxlbSkgPCAwKSB7XG4gICAgICBzZXQucHVzaChwYXJlbnRFbGVtKTtcbiAgICB9XG4gIH0pO1xuXG4gIGlmIChhcmd1bWVudHMubGVuZ3RoKSB7XG4gICAgc2V0ID0gZXhwb3J0cy5maWx0ZXIuY2FsbChzZXQsIHNlbGVjdG9yLCB0aGlzKTtcbiAgfVxuXG4gIHJldHVybiB0aGlzLl9tYWtlKHNldCk7XG59O1xuXG5leHBvcnRzLnBhcmVudHMgPSBmdW5jdGlvbihzZWxlY3Rvcikge1xuICB2YXIgcGFyZW50Tm9kZXMgPSBbXTtcblxuICAvLyBXaGVuIG11bHRpcGxlIERPTSBlbGVtZW50cyBhcmUgaW4gdGhlIG9yaWdpbmFsIHNldCwgdGhlIHJlc3VsdGluZyBzZXQgd2lsbFxuICAvLyBiZSBpbiAqcmV2ZXJzZSogb3JkZXIgb2YgdGhlIG9yaWdpbmFsIGVsZW1lbnRzIGFzIHdlbGwsIHdpdGggZHVwbGljYXRlc1xuICAvLyByZW1vdmVkLlxuICB0aGlzLmdldCgpLnJldmVyc2UoKS5mb3JFYWNoKGZ1bmN0aW9uKGVsZW0pIHtcbiAgICB0cmF2ZXJzZVBhcmVudHModGhpcywgZWxlbS5wYXJlbnQsIHNlbGVjdG9yLCBJbmZpbml0eSlcbiAgICAgIC5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgICAgaWYgKHBhcmVudE5vZGVzLmluZGV4T2Yobm9kZSkgPT09IC0xKSB7XG4gICAgICAgICAgcGFyZW50Tm9kZXMucHVzaChub2RlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICk7XG4gIH0sIHRoaXMpO1xuXG4gIHJldHVybiB0aGlzLl9tYWtlKHBhcmVudE5vZGVzKTtcbn07XG5cbmV4cG9ydHMucGFyZW50c1VudGlsID0gZnVuY3Rpb24oc2VsZWN0b3IsIGZpbHRlcikge1xuICB2YXIgcGFyZW50Tm9kZXMgPSBbXSwgdW50aWxOb2RlLCB1bnRpbE5vZGVzO1xuXG4gIGlmICh0eXBlb2Ygc2VsZWN0b3IgPT09ICdzdHJpbmcnKSB7XG4gICAgdW50aWxOb2RlID0gc2VsZWN0KHNlbGVjdG9yLCB0aGlzLnBhcmVudHMoKS50b0FycmF5KCksIHRoaXMub3B0aW9ucylbMF07XG4gIH0gZWxzZSBpZiAoc2VsZWN0b3IgJiYgc2VsZWN0b3IuY2hlZXJpbykge1xuICAgIHVudGlsTm9kZXMgPSBzZWxlY3Rvci50b0FycmF5KCk7XG4gIH0gZWxzZSBpZiAoc2VsZWN0b3IpIHtcbiAgICB1bnRpbE5vZGUgPSBzZWxlY3RvcjtcbiAgfVxuXG4gIC8vIFdoZW4gbXVsdGlwbGUgRE9NIGVsZW1lbnRzIGFyZSBpbiB0aGUgb3JpZ2luYWwgc2V0LCB0aGUgcmVzdWx0aW5nIHNldCB3aWxsXG4gIC8vIGJlIGluICpyZXZlcnNlKiBvcmRlciBvZiB0aGUgb3JpZ2luYWwgZWxlbWVudHMgYXMgd2VsbCwgd2l0aCBkdXBsaWNhdGVzXG4gIC8vIHJlbW92ZWQuXG5cbiAgdGhpcy50b0FycmF5KCkucmV2ZXJzZSgpLmZvckVhY2goZnVuY3Rpb24oZWxlbSkge1xuICAgIHdoaWxlICgoZWxlbSA9IGVsZW0ucGFyZW50KSkge1xuICAgICAgaWYgKCh1bnRpbE5vZGUgJiYgZWxlbSAhPT0gdW50aWxOb2RlKSB8fFxuICAgICAgICAodW50aWxOb2RlcyAmJiB1bnRpbE5vZGVzLmluZGV4T2YoZWxlbSkgPT09IC0xKSB8fFxuICAgICAgICAoIXVudGlsTm9kZSAmJiAhdW50aWxOb2RlcykpIHtcbiAgICAgICAgaWYgKGlzVGFnKGVsZW0pICYmIHBhcmVudE5vZGVzLmluZGV4T2YoZWxlbSkgPT09IC0xKSB7IHBhcmVudE5vZGVzLnB1c2goZWxlbSk7IH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfSwgdGhpcyk7XG5cbiAgcmV0dXJuIHRoaXMuX21ha2UoZmlsdGVyID8gc2VsZWN0KGZpbHRlciwgcGFyZW50Tm9kZXMsIHRoaXMub3B0aW9ucykgOiBwYXJlbnROb2Rlcyk7XG59O1xuXG4vLyBGb3IgZWFjaCBlbGVtZW50IGluIHRoZSBzZXQsIGdldCB0aGUgZmlyc3QgZWxlbWVudCB0aGF0IG1hdGNoZXMgdGhlIHNlbGVjdG9yXG4vLyBieSB0ZXN0aW5nIHRoZSBlbGVtZW50IGl0c2VsZiBhbmQgdHJhdmVyc2luZyB1cCB0aHJvdWdoIGl0cyBhbmNlc3RvcnMgaW4gdGhlXG4vLyBET00gdHJlZS5cbmV4cG9ydHMuY2xvc2VzdCA9IGZ1bmN0aW9uKHNlbGVjdG9yKSB7XG4gIHZhciBzZXQgPSBbXTtcblxuICBpZiAoIXNlbGVjdG9yKSB7XG4gICAgcmV0dXJuIHRoaXMuX21ha2Uoc2V0KTtcbiAgfVxuXG4gIGRvbUVhY2godGhpcywgZnVuY3Rpb24oaWR4LCBlbGVtKSB7XG4gICAgdmFyIGNsb3Nlc3RFbGVtID0gdHJhdmVyc2VQYXJlbnRzKHRoaXMsIGVsZW0sIHNlbGVjdG9yLCAxKVswXTtcblxuICAgIC8vIERvIG5vdCBhZGQgZHVwbGljYXRlIGVsZW1lbnRzIHRvIHRoZSBzZXRcbiAgICBpZiAoY2xvc2VzdEVsZW0gJiYgc2V0LmluZGV4T2YoY2xvc2VzdEVsZW0pIDwgMCkge1xuICAgICAgc2V0LnB1c2goY2xvc2VzdEVsZW0pO1xuICAgIH1cbiAgfS5iaW5kKHRoaXMpKTtcblxuICByZXR1cm4gdGhpcy5fbWFrZShzZXQpO1xufTtcblxuZXhwb3J0cy5uZXh0ID0gZnVuY3Rpb24oc2VsZWN0b3IpIHtcbiAgaWYgKCF0aGlzWzBdKSB7IHJldHVybiB0aGlzOyB9XG4gIHZhciBlbGVtcyA9IFtdO1xuXG4gIF8uZm9yRWFjaCh0aGlzLCBmdW5jdGlvbihlbGVtKSB7XG4gICAgd2hpbGUgKChlbGVtID0gZWxlbS5uZXh0KSkge1xuICAgICAgaWYgKGlzVGFnKGVsZW0pKSB7XG4gICAgICAgIGVsZW1zLnB1c2goZWxlbSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiBzZWxlY3RvciA/XG4gICAgZXhwb3J0cy5maWx0ZXIuY2FsbChlbGVtcywgc2VsZWN0b3IsIHRoaXMpIDpcbiAgICB0aGlzLl9tYWtlKGVsZW1zKTtcbn07XG5cbmV4cG9ydHMubmV4dEFsbCA9IGZ1bmN0aW9uKHNlbGVjdG9yKSB7XG4gIGlmICghdGhpc1swXSkgeyByZXR1cm4gdGhpczsgfVxuICB2YXIgZWxlbXMgPSBbXTtcblxuICBfLmZvckVhY2godGhpcywgZnVuY3Rpb24oZWxlbSkge1xuICAgIHdoaWxlICgoZWxlbSA9IGVsZW0ubmV4dCkpIHtcbiAgICAgIGlmIChpc1RhZyhlbGVtKSAmJiBlbGVtcy5pbmRleE9mKGVsZW0pID09PSAtMSkge1xuICAgICAgICBlbGVtcy5wdXNoKGVsZW0pO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIHNlbGVjdG9yID9cbiAgICBleHBvcnRzLmZpbHRlci5jYWxsKGVsZW1zLCBzZWxlY3RvciwgdGhpcykgOlxuICAgIHRoaXMuX21ha2UoZWxlbXMpO1xufTtcblxuZXhwb3J0cy5uZXh0VW50aWwgPSBmdW5jdGlvbihzZWxlY3RvciwgZmlsdGVyU2VsZWN0b3IpIHtcbiAgaWYgKCF0aGlzWzBdKSB7IHJldHVybiB0aGlzOyB9XG4gIHZhciBlbGVtcyA9IFtdLCB1bnRpbE5vZGUsIHVudGlsTm9kZXM7XG5cbiAgaWYgKHR5cGVvZiBzZWxlY3RvciA9PT0gJ3N0cmluZycpIHtcbiAgICB1bnRpbE5vZGUgPSBzZWxlY3Qoc2VsZWN0b3IsIHRoaXMubmV4dEFsbCgpLmdldCgpLCB0aGlzLm9wdGlvbnMpWzBdO1xuICB9IGVsc2UgaWYgKHNlbGVjdG9yICYmIHNlbGVjdG9yLmNoZWVyaW8pIHtcbiAgICB1bnRpbE5vZGVzID0gc2VsZWN0b3IuZ2V0KCk7XG4gIH0gZWxzZSBpZiAoc2VsZWN0b3IpIHtcbiAgICB1bnRpbE5vZGUgPSBzZWxlY3RvcjtcbiAgfVxuXG4gIF8uZm9yRWFjaCh0aGlzLCBmdW5jdGlvbihlbGVtKSB7XG4gICAgd2hpbGUgKChlbGVtID0gZWxlbS5uZXh0KSkge1xuICAgICAgaWYgKCh1bnRpbE5vZGUgJiYgZWxlbSAhPT0gdW50aWxOb2RlKSB8fFxuICAgICAgICAodW50aWxOb2RlcyAmJiB1bnRpbE5vZGVzLmluZGV4T2YoZWxlbSkgPT09IC0xKSB8fFxuICAgICAgICAoIXVudGlsTm9kZSAmJiAhdW50aWxOb2RlcykpIHtcbiAgICAgICAgaWYgKGlzVGFnKGVsZW0pICYmIGVsZW1zLmluZGV4T2YoZWxlbSkgPT09IC0xKSB7XG4gICAgICAgICAgZWxlbXMucHVzaChlbGVtKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gZmlsdGVyU2VsZWN0b3IgP1xuICAgIGV4cG9ydHMuZmlsdGVyLmNhbGwoZWxlbXMsIGZpbHRlclNlbGVjdG9yLCB0aGlzKSA6XG4gICAgdGhpcy5fbWFrZShlbGVtcyk7XG59O1xuXG5leHBvcnRzLnByZXYgPSBmdW5jdGlvbihzZWxlY3Rvcikge1xuICBpZiAoIXRoaXNbMF0pIHsgcmV0dXJuIHRoaXM7IH1cbiAgdmFyIGVsZW1zID0gW107XG5cbiAgXy5mb3JFYWNoKHRoaXMsIGZ1bmN0aW9uKGVsZW0pIHtcbiAgICB3aGlsZSAoKGVsZW0gPSBlbGVtLnByZXYpKSB7XG4gICAgICBpZiAoaXNUYWcoZWxlbSkpIHtcbiAgICAgICAgZWxlbXMucHVzaChlbGVtKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIHNlbGVjdG9yID9cbiAgICBleHBvcnRzLmZpbHRlci5jYWxsKGVsZW1zLCBzZWxlY3RvciwgdGhpcykgOlxuICAgIHRoaXMuX21ha2UoZWxlbXMpO1xufTtcblxuZXhwb3J0cy5wcmV2QWxsID0gZnVuY3Rpb24oc2VsZWN0b3IpIHtcbiAgaWYgKCF0aGlzWzBdKSB7IHJldHVybiB0aGlzOyB9XG4gIHZhciBlbGVtcyA9IFtdO1xuXG4gIF8uZm9yRWFjaCh0aGlzLCBmdW5jdGlvbihlbGVtKSB7XG4gICAgd2hpbGUgKChlbGVtID0gZWxlbS5wcmV2KSkge1xuICAgICAgaWYgKGlzVGFnKGVsZW0pICYmIGVsZW1zLmluZGV4T2YoZWxlbSkgPT09IC0xKSB7XG4gICAgICAgIGVsZW1zLnB1c2goZWxlbSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gc2VsZWN0b3IgP1xuICAgIGV4cG9ydHMuZmlsdGVyLmNhbGwoZWxlbXMsIHNlbGVjdG9yLCB0aGlzKSA6XG4gICAgdGhpcy5fbWFrZShlbGVtcyk7XG59O1xuXG5leHBvcnRzLnByZXZVbnRpbCA9IGZ1bmN0aW9uKHNlbGVjdG9yLCBmaWx0ZXJTZWxlY3Rvcikge1xuICBpZiAoIXRoaXNbMF0pIHsgcmV0dXJuIHRoaXM7IH1cbiAgdmFyIGVsZW1zID0gW10sIHVudGlsTm9kZSwgdW50aWxOb2RlcztcblxuICBpZiAodHlwZW9mIHNlbGVjdG9yID09PSAnc3RyaW5nJykge1xuICAgIHVudGlsTm9kZSA9IHNlbGVjdChzZWxlY3RvciwgdGhpcy5wcmV2QWxsKCkuZ2V0KCksIHRoaXMub3B0aW9ucylbMF07XG4gIH0gZWxzZSBpZiAoc2VsZWN0b3IgJiYgc2VsZWN0b3IuY2hlZXJpbykge1xuICAgIHVudGlsTm9kZXMgPSBzZWxlY3Rvci5nZXQoKTtcbiAgfSBlbHNlIGlmIChzZWxlY3Rvcikge1xuICAgIHVudGlsTm9kZSA9IHNlbGVjdG9yO1xuICB9XG5cbiAgXy5mb3JFYWNoKHRoaXMsIGZ1bmN0aW9uKGVsZW0pIHtcbiAgICB3aGlsZSAoKGVsZW0gPSBlbGVtLnByZXYpKSB7XG4gICAgICBpZiAoKHVudGlsTm9kZSAmJiBlbGVtICE9PSB1bnRpbE5vZGUpIHx8XG4gICAgICAgICh1bnRpbE5vZGVzICYmIHVudGlsTm9kZXMuaW5kZXhPZihlbGVtKSA9PT0gLTEpIHx8XG4gICAgICAgICghdW50aWxOb2RlICYmICF1bnRpbE5vZGVzKSkge1xuICAgICAgICBpZiAoaXNUYWcoZWxlbSkgJiYgZWxlbXMuaW5kZXhPZihlbGVtKSA9PT0gLTEpIHtcbiAgICAgICAgICBlbGVtcy5wdXNoKGVsZW0pO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiBmaWx0ZXJTZWxlY3RvciA/XG4gICAgZXhwb3J0cy5maWx0ZXIuY2FsbChlbGVtcywgZmlsdGVyU2VsZWN0b3IsIHRoaXMpIDpcbiAgICB0aGlzLl9tYWtlKGVsZW1zKTtcbn07XG5cbmV4cG9ydHMuc2libGluZ3MgPSBmdW5jdGlvbihzZWxlY3Rvcikge1xuICB2YXIgcGFyZW50ID0gdGhpcy5wYXJlbnQoKTtcblxuICB2YXIgZWxlbXMgPSBfLmZpbHRlcihcbiAgICBwYXJlbnQgPyBwYXJlbnQuY2hpbGRyZW4oKSA6IHRoaXMuc2libGluZ3NBbmRNZSgpLFxuICAgIF8uYmluZChmdW5jdGlvbihlbGVtKSB7IHJldHVybiBpc1RhZyhlbGVtKSAmJiAhdGhpcy5pcyhlbGVtKTsgfSwgdGhpcylcbiAgKTtcblxuICBpZiAoc2VsZWN0b3IgIT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybiBleHBvcnRzLmZpbHRlci5jYWxsKGVsZW1zLCBzZWxlY3RvciwgdGhpcyk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHRoaXMuX21ha2UoZWxlbXMpO1xuICB9XG59O1xuXG5leHBvcnRzLmNoaWxkcmVuID0gZnVuY3Rpb24oc2VsZWN0b3IpIHtcblxuICB2YXIgZWxlbXMgPSBfLnJlZHVjZSh0aGlzLCBmdW5jdGlvbihtZW1vLCBlbGVtKSB7XG4gICAgcmV0dXJuIG1lbW8uY29uY2F0KF8uZmlsdGVyKGVsZW0uY2hpbGRyZW4sIGlzVGFnKSk7XG4gIH0sIFtdKTtcblxuICBpZiAoc2VsZWN0b3IgPT09IHVuZGVmaW5lZCkgcmV0dXJuIHRoaXMuX21ha2UoZWxlbXMpO1xuXG4gIHJldHVybiBleHBvcnRzLmZpbHRlci5jYWxsKGVsZW1zLCBzZWxlY3RvciwgdGhpcyk7XG59O1xuXG5leHBvcnRzLmNvbnRlbnRzID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiB0aGlzLl9tYWtlKF8ucmVkdWNlKHRoaXMsIGZ1bmN0aW9uKGFsbCwgZWxlbSkge1xuICAgIGFsbC5wdXNoLmFwcGx5KGFsbCwgZWxlbS5jaGlsZHJlbik7XG4gICAgcmV0dXJuIGFsbDtcbiAgfSwgW10pKTtcbn07XG5cbmV4cG9ydHMuZWFjaCA9IGZ1bmN0aW9uKGZuKSB7XG4gIHZhciBpID0gMCwgbGVuID0gdGhpcy5sZW5ndGg7XG4gIHdoaWxlIChpIDwgbGVuICYmIGZuLmNhbGwodGhpc1tpXSwgaSwgdGhpc1tpXSkgIT09IGZhbHNlKSArK2k7XG4gIHJldHVybiB0aGlzO1xufTtcblxuZXhwb3J0cy5tYXAgPSBmdW5jdGlvbihmbikge1xuICByZXR1cm4gdGhpcy5fbWFrZShfLnJlZHVjZSh0aGlzLCBmdW5jdGlvbihtZW1vLCBlbCwgaSkge1xuICAgIHZhciB2YWwgPSBmbi5jYWxsKGVsLCBpLCBlbCk7XG4gICAgcmV0dXJuIHZhbCA9PSBudWxsID8gbWVtbyA6IG1lbW8uY29uY2F0KHZhbCk7XG4gIH0sIFtdKSk7XG59O1xuXG52YXIgbWFrZUZpbHRlck1ldGhvZCA9IGZ1bmN0aW9uKGZpbHRlckZuKSB7XG4gIHJldHVybiBmdW5jdGlvbihtYXRjaCwgY29udGFpbmVyKSB7XG4gICAgdmFyIHRlc3RGbjtcbiAgICBjb250YWluZXIgPSBjb250YWluZXIgfHwgdGhpcztcblxuICAgIGlmICh0eXBlb2YgbWF0Y2ggPT09ICdzdHJpbmcnKSB7XG4gICAgICB0ZXN0Rm4gPSBzZWxlY3QuY29tcGlsZShtYXRjaCwgY29udGFpbmVyLm9wdGlvbnMpO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIG1hdGNoID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICB0ZXN0Rm4gPSBmdW5jdGlvbihlbCwgaSkge1xuICAgICAgICByZXR1cm4gbWF0Y2guY2FsbChlbCwgaSwgZWwpO1xuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKG1hdGNoLmNoZWVyaW8pIHtcbiAgICAgIHRlc3RGbiA9IG1hdGNoLmlzLmJpbmQobWF0Y2gpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0ZXN0Rm4gPSBmdW5jdGlvbihlbCkge1xuICAgICAgICByZXR1cm4gbWF0Y2ggPT09IGVsO1xuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4gY29udGFpbmVyLl9tYWtlKGZpbHRlckZuKHRoaXMsIHRlc3RGbikpO1xuICB9O1xufTtcblxuZXhwb3J0cy5maWx0ZXIgPSBtYWtlRmlsdGVyTWV0aG9kKF8uZmlsdGVyKTtcbmV4cG9ydHMubm90ID0gbWFrZUZpbHRlck1ldGhvZChfLnJlamVjdCk7XG5cbmV4cG9ydHMuaGFzID0gZnVuY3Rpb24oc2VsZWN0b3JPckhheXN0YWNrKSB7XG4gIHZhciB0aGF0ID0gdGhpcztcbiAgcmV0dXJuIGV4cG9ydHMuZmlsdGVyLmNhbGwodGhpcywgZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoYXQuX21ha2UodGhpcykuZmluZChzZWxlY3Rvck9ySGF5c3RhY2spLmxlbmd0aCA+IDA7XG4gIH0pO1xufTtcblxuZXhwb3J0cy5maXJzdCA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gdGhpcy5sZW5ndGggPiAxID8gdGhpcy5fbWFrZSh0aGlzWzBdKSA6IHRoaXM7XG59O1xuXG5leHBvcnRzLmxhc3QgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuIHRoaXMubGVuZ3RoID4gMSA/IHRoaXMuX21ha2UodGhpc1t0aGlzLmxlbmd0aCAtIDFdKSA6IHRoaXM7XG59O1xuXG4vLyBSZWR1Y2UgdGhlIHNldCBvZiBtYXRjaGVkIGVsZW1lbnRzIHRvIHRoZSBvbmUgYXQgdGhlIHNwZWNpZmllZCBpbmRleC5cbmV4cG9ydHMuZXEgPSBmdW5jdGlvbihpKSB7XG4gIGkgPSAraTtcblxuICAvLyBVc2UgdGhlIGZpcnN0IGlkZW50aXR5IG9wdGltaXphdGlvbiBpZiBwb3NzaWJsZVxuICBpZiAoaSA9PT0gMCAmJiB0aGlzLmxlbmd0aCA8PSAxKSByZXR1cm4gdGhpcztcblxuICBpZiAoaSA8IDApIGkgPSB0aGlzLmxlbmd0aCArIGk7XG4gIHJldHVybiB0aGlzW2ldID8gdGhpcy5fbWFrZSh0aGlzW2ldKSA6IHRoaXMuX21ha2UoW10pO1xufTtcblxuLy8gUmV0cmlldmUgdGhlIERPTSBlbGVtZW50cyBtYXRjaGVkIGJ5IHRoZSBqUXVlcnkgb2JqZWN0LlxuZXhwb3J0cy5nZXQgPSBmdW5jdGlvbihpKSB7XG4gIGlmIChpID09IG51bGwpIHtcbiAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwodGhpcyk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHRoaXNbaSA8IDAgPyAodGhpcy5sZW5ndGggKyBpKSA6IGldO1xuICB9XG59O1xuXG4vLyBTZWFyY2ggZm9yIGEgZ2l2ZW4gZWxlbWVudCBmcm9tIGFtb25nIHRoZSBtYXRjaGVkIGVsZW1lbnRzLlxuZXhwb3J0cy5pbmRleCA9IGZ1bmN0aW9uKHNlbGVjdG9yT3JOZWVkbGUpIHtcbiAgdmFyICRoYXlzdGFjaywgbmVlZGxlO1xuXG4gIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgJGhheXN0YWNrID0gdGhpcy5wYXJlbnQoKS5jaGlsZHJlbigpO1xuICAgIG5lZWRsZSA9IHRoaXNbMF07XG4gIH0gZWxzZSBpZiAodHlwZW9mIHNlbGVjdG9yT3JOZWVkbGUgPT09ICdzdHJpbmcnKSB7XG4gICAgJGhheXN0YWNrID0gdGhpcy5fbWFrZShzZWxlY3Rvck9yTmVlZGxlKTtcbiAgICBuZWVkbGUgPSB0aGlzWzBdO1xuICB9IGVsc2Uge1xuICAgICRoYXlzdGFjayA9IHRoaXM7XG4gICAgbmVlZGxlID0gc2VsZWN0b3JPck5lZWRsZS5jaGVlcmlvID8gc2VsZWN0b3JPck5lZWRsZVswXSA6IHNlbGVjdG9yT3JOZWVkbGU7XG4gIH1cblxuICByZXR1cm4gJGhheXN0YWNrLmdldCgpLmluZGV4T2YobmVlZGxlKTtcbn07XG5cbmV4cG9ydHMuc2xpY2UgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuIHRoaXMuX21ha2UoW10uc2xpY2UuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7XG59O1xuXG5mdW5jdGlvbiB0cmF2ZXJzZVBhcmVudHMoc2VsZiwgZWxlbSwgc2VsZWN0b3IsIGxpbWl0KSB7XG4gIHZhciBlbGVtcyA9IFtdO1xuICB3aGlsZSAoZWxlbSAmJiBlbGVtcy5sZW5ndGggPCBsaW1pdCkge1xuICAgIGlmICghc2VsZWN0b3IgfHwgZXhwb3J0cy5maWx0ZXIuY2FsbChbZWxlbV0sIHNlbGVjdG9yLCBzZWxmKS5sZW5ndGgpIHtcbiAgICAgIGVsZW1zLnB1c2goZWxlbSk7XG4gICAgfVxuICAgIGVsZW0gPSBlbGVtLnBhcmVudDtcbiAgfVxuICByZXR1cm4gZWxlbXM7XG59XG5cbi8vIEVuZCB0aGUgbW9zdCByZWNlbnQgZmlsdGVyaW5nIG9wZXJhdGlvbiBpbiB0aGUgY3VycmVudCBjaGFpbiBhbmQgcmV0dXJuIHRoZVxuLy8gc2V0IG9mIG1hdGNoZWQgZWxlbWVudHMgdG8gaXRzIHByZXZpb3VzIHN0YXRlLlxuZXhwb3J0cy5lbmQgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuIHRoaXMucHJldk9iamVjdCB8fCB0aGlzLl9tYWtlKFtdKTtcbn07XG5cbmV4cG9ydHMuYWRkID0gZnVuY3Rpb24ob3RoZXIsIGNvbnRleHQpIHtcbiAgdmFyIHNlbGVjdGlvbiA9IHRoaXMuX21ha2Uob3RoZXIsIGNvbnRleHQpO1xuICB2YXIgY29udGVudHMgPSB1bmlxdWVTb3J0KHNlbGVjdGlvbi5nZXQoKS5jb25jYXQodGhpcy5nZXQoKSkpO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgY29udGVudHMubGVuZ3RoOyArK2kpIHtcbiAgICBzZWxlY3Rpb25baV0gPSBjb250ZW50c1tpXTtcbiAgfVxuICBzZWxlY3Rpb24ubGVuZ3RoID0gY29udGVudHMubGVuZ3RoO1xuXG4gIHJldHVybiBzZWxlY3Rpb247XG59O1xuXG4vLyBBZGQgdGhlIHByZXZpb3VzIHNldCBvZiBlbGVtZW50cyBvbiB0aGUgc3RhY2sgdG8gdGhlIGN1cnJlbnQgc2V0LCBvcHRpb25hbGx5XG4vLyBmaWx0ZXJlZCBieSBhIHNlbGVjdG9yLlxuZXhwb3J0cy5hZGRCYWNrID0gZnVuY3Rpb24oc2VsZWN0b3IpIHtcbiAgcmV0dXJuIHRoaXMuYWRkKFxuICAgIGFyZ3VtZW50cy5sZW5ndGggPyB0aGlzLnByZXZPYmplY3QuZmlsdGVyKHNlbGVjdG9yKSA6IHRoaXMucHJldk9iamVjdFxuICApO1xufTtcbiJdfQ==