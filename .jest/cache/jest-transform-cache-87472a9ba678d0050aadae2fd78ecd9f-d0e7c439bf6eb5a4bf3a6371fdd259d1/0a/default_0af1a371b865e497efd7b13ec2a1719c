db388b7cf5d293981f207036f5384fef
'use strict';

var DOCUMENT_MODE = require('../common/html').DOCUMENT_MODE; //Node construction


exports.createDocument = function () {
  return {
    nodeName: '#document',
    mode: DOCUMENT_MODE.NO_QUIRKS,
    childNodes: []
  };
};

exports.createDocumentFragment = function () {
  return {
    nodeName: '#document-fragment',
    childNodes: []
  };
};

exports.createElement = function (tagName, namespaceURI, attrs) {
  return {
    nodeName: tagName,
    tagName: tagName,
    attrs: attrs,
    namespaceURI: namespaceURI,
    childNodes: [],
    parentNode: null
  };
};

exports.createCommentNode = function (data) {
  return {
    nodeName: '#comment',
    data: data,
    parentNode: null
  };
};

var createTextNode = function (value) {
  return {
    nodeName: '#text',
    value: value,
    parentNode: null
  };
}; //Tree mutation


var appendChild = exports.appendChild = function (parentNode, newNode) {
  parentNode.childNodes.push(newNode);
  newNode.parentNode = parentNode;
};

var insertBefore = exports.insertBefore = function (parentNode, newNode, referenceNode) {
  var insertionIdx = parentNode.childNodes.indexOf(referenceNode);
  parentNode.childNodes.splice(insertionIdx, 0, newNode);
  newNode.parentNode = parentNode;
};

exports.setTemplateContent = function (templateElement, contentElement) {
  templateElement.content = contentElement;
};

exports.getTemplateContent = function (templateElement) {
  return templateElement.content;
};

exports.setDocumentType = function (document, name, publicId, systemId) {
  var doctypeNode = null;

  for (var i = 0; i < document.childNodes.length; i++) {
    if (document.childNodes[i].nodeName === '#documentType') {
      doctypeNode = document.childNodes[i];
      break;
    }
  }

  if (doctypeNode) {
    doctypeNode.name = name;
    doctypeNode.publicId = publicId;
    doctypeNode.systemId = systemId;
  } else {
    appendChild(document, {
      nodeName: '#documentType',
      name: name,
      publicId: publicId,
      systemId: systemId
    });
  }
};

exports.setDocumentMode = function (document, mode) {
  document.mode = mode;
};

exports.getDocumentMode = function (document) {
  return document.mode;
};

exports.detachNode = function (node) {
  if (node.parentNode) {
    var idx = node.parentNode.childNodes.indexOf(node);
    node.parentNode.childNodes.splice(idx, 1);
    node.parentNode = null;
  }
};

exports.insertText = function (parentNode, text) {
  if (parentNode.childNodes.length) {
    var prevNode = parentNode.childNodes[parentNode.childNodes.length - 1];

    if (prevNode.nodeName === '#text') {
      prevNode.value += text;
      return;
    }
  }

  appendChild(parentNode, createTextNode(text));
};

exports.insertTextBefore = function (parentNode, text, referenceNode) {
  var prevNode = parentNode.childNodes[parentNode.childNodes.indexOf(referenceNode) - 1];
  if (prevNode && prevNode.nodeName === '#text') prevNode.value += text;else insertBefore(parentNode, createTextNode(text), referenceNode);
};

exports.adoptAttributes = function (recipient, attrs) {
  var recipientAttrsMap = [];

  for (var i = 0; i < recipient.attrs.length; i++) recipientAttrsMap.push(recipient.attrs[i].name);

  for (var j = 0; j < attrs.length; j++) {
    if (recipientAttrsMap.indexOf(attrs[j].name) === -1) recipient.attrs.push(attrs[j]);
  }
}; //Tree traversing


exports.getFirstChild = function (node) {
  return node.childNodes[0];
};

exports.getChildNodes = function (node) {
  return node.childNodes;
};

exports.getParentNode = function (node) {
  return node.parentNode;
};

exports.getAttrList = function (element) {
  return element.attrs;
}; //Node data


exports.getTagName = function (element) {
  return element.tagName;
};

exports.getNamespaceURI = function (element) {
  return element.namespaceURI;
};

exports.getTextNodeContent = function (textNode) {
  return textNode.value;
};

exports.getCommentNodeContent = function (commentNode) {
  return commentNode.data;
};

exports.getDocumentTypeNodeName = function (doctypeNode) {
  return doctypeNode.name;
};

exports.getDocumentTypeNodePublicId = function (doctypeNode) {
  return doctypeNode.publicId;
};

exports.getDocumentTypeNodeSystemId = function (doctypeNode) {
  return doctypeNode.systemId;
}; //Node types


exports.isTextNode = function (node) {
  return node.nodeName === '#text';
};

exports.isCommentNode = function (node) {
  return node.nodeName === '#comment';
};

exports.isDocumentTypeNode = function (node) {
  return node.nodeName === '#documentType';
};

exports.isElementNode = function (node) {
  return !!node.tagName;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRlZmF1bHQuanMiXSwibmFtZXMiOlsiRE9DVU1FTlRfTU9ERSIsInJlcXVpcmUiLCJleHBvcnRzIiwiY3JlYXRlRG9jdW1lbnQiLCJub2RlTmFtZSIsIm1vZGUiLCJOT19RVUlSS1MiLCJjaGlsZE5vZGVzIiwiY3JlYXRlRG9jdW1lbnRGcmFnbWVudCIsImNyZWF0ZUVsZW1lbnQiLCJ0YWdOYW1lIiwibmFtZXNwYWNlVVJJIiwiYXR0cnMiLCJwYXJlbnROb2RlIiwiY3JlYXRlQ29tbWVudE5vZGUiLCJkYXRhIiwiY3JlYXRlVGV4dE5vZGUiLCJ2YWx1ZSIsImFwcGVuZENoaWxkIiwibmV3Tm9kZSIsInB1c2giLCJpbnNlcnRCZWZvcmUiLCJyZWZlcmVuY2VOb2RlIiwiaW5zZXJ0aW9uSWR4IiwiaW5kZXhPZiIsInNwbGljZSIsInNldFRlbXBsYXRlQ29udGVudCIsInRlbXBsYXRlRWxlbWVudCIsImNvbnRlbnRFbGVtZW50IiwiY29udGVudCIsImdldFRlbXBsYXRlQ29udGVudCIsInNldERvY3VtZW50VHlwZSIsImRvY3VtZW50IiwibmFtZSIsInB1YmxpY0lkIiwic3lzdGVtSWQiLCJkb2N0eXBlTm9kZSIsImkiLCJsZW5ndGgiLCJzZXREb2N1bWVudE1vZGUiLCJnZXREb2N1bWVudE1vZGUiLCJkZXRhY2hOb2RlIiwibm9kZSIsImlkeCIsImluc2VydFRleHQiLCJ0ZXh0IiwicHJldk5vZGUiLCJpbnNlcnRUZXh0QmVmb3JlIiwiYWRvcHRBdHRyaWJ1dGVzIiwicmVjaXBpZW50IiwicmVjaXBpZW50QXR0cnNNYXAiLCJqIiwiZ2V0Rmlyc3RDaGlsZCIsImdldENoaWxkTm9kZXMiLCJnZXRQYXJlbnROb2RlIiwiZ2V0QXR0ckxpc3QiLCJlbGVtZW50IiwiZ2V0VGFnTmFtZSIsImdldE5hbWVzcGFjZVVSSSIsImdldFRleHROb2RlQ29udGVudCIsInRleHROb2RlIiwiZ2V0Q29tbWVudE5vZGVDb250ZW50IiwiY29tbWVudE5vZGUiLCJnZXREb2N1bWVudFR5cGVOb2RlTmFtZSIsImdldERvY3VtZW50VHlwZU5vZGVQdWJsaWNJZCIsImdldERvY3VtZW50VHlwZU5vZGVTeXN0ZW1JZCIsImlzVGV4dE5vZGUiLCJpc0NvbW1lbnROb2RlIiwiaXNEb2N1bWVudFR5cGVOb2RlIiwiaXNFbGVtZW50Tm9kZSJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBSUEsYUFBYSxHQUFHQyxPQUFPLENBQUMsZ0JBQUQsQ0FBUCxDQUEwQkQsYUFBOUMsQyxDQUVBOzs7QUFDQUUsT0FBTyxDQUFDQyxjQUFSLEdBQXlCLFlBQVk7QUFDakMsU0FBTztBQUNIQyxJQUFBQSxRQUFRLEVBQUUsV0FEUDtBQUVIQyxJQUFBQSxJQUFJLEVBQUVMLGFBQWEsQ0FBQ00sU0FGakI7QUFHSEMsSUFBQUEsVUFBVSxFQUFFO0FBSFQsR0FBUDtBQUtILENBTkQ7O0FBUUFMLE9BQU8sQ0FBQ00sc0JBQVIsR0FBaUMsWUFBWTtBQUN6QyxTQUFPO0FBQ0hKLElBQUFBLFFBQVEsRUFBRSxvQkFEUDtBQUVIRyxJQUFBQSxVQUFVLEVBQUU7QUFGVCxHQUFQO0FBSUgsQ0FMRDs7QUFPQUwsT0FBTyxDQUFDTyxhQUFSLEdBQXdCLFVBQVVDLE9BQVYsRUFBbUJDLFlBQW5CLEVBQWlDQyxLQUFqQyxFQUF3QztBQUM1RCxTQUFPO0FBQ0hSLElBQUFBLFFBQVEsRUFBRU0sT0FEUDtBQUVIQSxJQUFBQSxPQUFPLEVBQUVBLE9BRk47QUFHSEUsSUFBQUEsS0FBSyxFQUFFQSxLQUhKO0FBSUhELElBQUFBLFlBQVksRUFBRUEsWUFKWDtBQUtISixJQUFBQSxVQUFVLEVBQUUsRUFMVDtBQU1ITSxJQUFBQSxVQUFVLEVBQUU7QUFOVCxHQUFQO0FBUUgsQ0FURDs7QUFXQVgsT0FBTyxDQUFDWSxpQkFBUixHQUE0QixVQUFVQyxJQUFWLEVBQWdCO0FBQ3hDLFNBQU87QUFDSFgsSUFBQUEsUUFBUSxFQUFFLFVBRFA7QUFFSFcsSUFBQUEsSUFBSSxFQUFFQSxJQUZIO0FBR0hGLElBQUFBLFVBQVUsRUFBRTtBQUhULEdB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QUNwQyxTQUFPQSxJQUFJLENBQUN0QyxRQUFMLEtBQWtCLFVBQXpCO0FBQ0gsQ0FGRDs7QUFJQUYsT0FBTyxDQUFDa0Usa0JBQVIsR0FBNkIsVUFBVTFCLElBQVYsRUFBZ0I7QUFDekMsU0FBT0EsSUFBSSxDQUFDdEMsUUFBTCxLQUFrQixlQUF6QjtBQUNILENBRkQ7O0FBSUFGLE9BQU8sQ0FBQ21FLGFBQVIsR0FBd0IsVUFBVTNCLElBQVYsRUFBZ0I7QUFDcEMsU0FBTyxDQUFDLENBQUNBLElBQUksQ0FBQ2hDLE9BQWQ7QUFDSCxDQUZEIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG52YXIgRE9DVU1FTlRfTU9ERSA9IHJlcXVpcmUoJy4uL2NvbW1vbi9odG1sJykuRE9DVU1FTlRfTU9ERTtcblxuLy9Ob2RlIGNvbnN0cnVjdGlvblxuZXhwb3J0cy5jcmVhdGVEb2N1bWVudCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBub2RlTmFtZTogJyNkb2N1bWVudCcsXG4gICAgICAgIG1vZGU6IERPQ1VNRU5UX01PREUuTk9fUVVJUktTLFxuICAgICAgICBjaGlsZE5vZGVzOiBbXVxuICAgIH07XG59O1xuXG5leHBvcnRzLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgbm9kZU5hbWU6ICcjZG9jdW1lbnQtZnJhZ21lbnQnLFxuICAgICAgICBjaGlsZE5vZGVzOiBbXVxuICAgIH07XG59O1xuXG5leHBvcnRzLmNyZWF0ZUVsZW1lbnQgPSBmdW5jdGlvbiAodGFnTmFtZSwgbmFtZXNwYWNlVVJJLCBhdHRycykge1xuICAgIHJldHVybiB7XG4gICAgICAgIG5vZGVOYW1lOiB0YWdOYW1lLFxuICAgICAgICB0YWdOYW1lOiB0YWdOYW1lLFxuICAgICAgICBhdHRyczogYXR0cnMsXG4gICAgICAgIG5hbWVzcGFjZVVSSTogbmFtZXNwYWNlVVJJLFxuICAgICAgICBjaGlsZE5vZGVzOiBbXSxcbiAgICAgICAgcGFyZW50Tm9kZTogbnVsbFxuICAgIH07XG59O1xuXG5leHBvcnRzLmNyZWF0ZUNvbW1lbnROb2RlID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBub2RlTmFtZTogJyNjb21tZW50JyxcbiAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgcGFyZW50Tm9kZTogbnVsbFxuICAgIH07XG59O1xuXG52YXIgY3JlYXRlVGV4dE5vZGUgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBub2RlTmFtZTogJyN0ZXh0JyxcbiAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICBwYXJlbnROb2RlOiBudWxsXG4gICAgfTtcbn07XG5cblxuLy9UcmVlIG11dGF0aW9uXG52YXIgYXBwZW5kQ2hpbGQgPSBleHBvcnRzLmFwcGVuZENoaWxkID0gZnVuY3Rpb24gKHBhcmVudE5vZGUsIG5ld05vZGUpIHtcbiAgICBwYXJlbnROb2RlLmNoaWxkTm9kZXMucHVzaChuZXdOb2RlKTtcbiAgICBuZXdOb2RlLnBhcmVudE5vZGUgPSBwYXJlbnROb2RlO1xufTtcblxudmFyIGluc2VydEJlZm9yZSA9IGV4cG9ydHMuaW5zZXJ0QmVmb3JlID0gZnVuY3Rpb24gKHBhcmVudE5vZGUsIG5ld05vZGUsIHJlZmVyZW5jZU5vZGUpIHtcbiAgICB2YXIgaW5zZXJ0aW9uSWR4ID0gcGFyZW50Tm9kZS5jaGlsZE5vZGVzLmluZGV4T2YocmVmZXJlbmNlTm9kZSk7XG5cbiAgICBwYXJlbnROb2RlLmNoaWxkTm9kZXMuc3BsaWNlKGluc2VydGlvbklkeCwgMCwgbmV3Tm9kZSk7XG4gICAgbmV3Tm9kZS5wYXJlbnROb2RlID0gcGFyZW50Tm9kZTtcbn07XG5cbmV4cG9ydHMuc2V0VGVtcGxhdGVDb250ZW50ID0gZnVuY3Rpb24gKHRlbXBsYXRlRWxlbWVudCwgY29udGVudEVsZW1lbnQpIHtcbiAgICB0ZW1wbGF0ZUVsZW1lbnQuY29udGVudCA9IGNvbnRlbnRFbGVtZW50O1xufTtcblxuZXhwb3J0cy5nZXRUZW1wbGF0ZUNvbnRlbnQgPSBmdW5jdGlvbiAodGVtcGxhdGVFbGVtZW50KSB7XG4gICAgcmV0dXJuIHRlbXBsYXRlRWxlbWVudC5jb250ZW50O1xufTtcblxuZXhwb3J0cy5zZXREb2N1bWVudFR5cGUgPSBmdW5jdGlvbiAoZG9jdW1lbnQsIG5hbWUsIHB1YmxpY0lkLCBzeXN0ZW1JZCkge1xuICAgIHZhciBkb2N0eXBlTm9kZSA9IG51bGw7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRvY3VtZW50LmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKGRvY3VtZW50LmNoaWxkTm9kZXNbaV0ubm9kZU5hbWUgPT09ICcjZG9jdW1lbnRUeXBlJykge1xuICAgICAgICAgICAgZG9jdHlwZU5vZGUgPSBkb2N1bWVudC5jaGlsZE5vZGVzW2ldO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoZG9jdHlwZU5vZGUpIHtcbiAgICAgICAgZG9jdHlwZU5vZGUubmFtZSA9IG5hbWU7XG4gICAgICAgIGRvY3R5cGVOb2RlLnB1YmxpY0lkID0gcHVibGljSWQ7XG4gICAgICAgIGRvY3R5cGVOb2RlLnN5c3RlbUlkID0gc3lzdGVtSWQ7XG4gICAgfVxuXG4gICAgZWxzZSB7XG4gICAgICAgIGFwcGVuZENoaWxkKGRvY3VtZW50LCB7XG4gICAgICAgICAgICBub2RlTmFtZTogJyNkb2N1bWVudFR5cGUnLFxuICAgICAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgICAgIHB1YmxpY0lkOiBwdWJsaWNJZCxcbiAgICAgICAgICAgIHN5c3RlbUlkOiBzeXN0ZW1JZFxuICAgICAgICB9KTtcbiAgICB9XG59O1xuXG5leHBvcnRzLnNldERvY3VtZW50TW9kZSA9IGZ1bmN0aW9uIChkb2N1bWVudCwgbW9kZSkge1xuICAgIGRvY3VtZW50Lm1vZGUgPSBtb2RlO1xufTtcblxuZXhwb3J0cy5nZXREb2N1bWVudE1vZGUgPSBmdW5jdGlvbiAoZG9jdW1lbnQpIHtcbiAgICByZXR1cm4gZG9jdW1lbnQubW9kZTtcbn07XG5cbmV4cG9ydHMuZGV0YWNoTm9kZSA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgaWYgKG5vZGUucGFyZW50Tm9kZSkge1xuICAgICAgICB2YXIgaWR4ID0gbm9kZS5wYXJlbnROb2RlLmNoaWxkTm9kZXMuaW5kZXhPZihub2RlKTtcblxuICAgICAgICBub2RlLnBhcmVudE5vZGUuY2hpbGROb2Rlcy5zcGxpY2UoaWR4LCAxKTtcbiAgICAgICAgbm9kZS5wYXJlbnROb2RlID0gbnVsbDtcbiAgICB9XG59O1xuXG5leHBvcnRzLmluc2VydFRleHQgPSBmdW5jdGlvbiAocGFyZW50Tm9kZSwgdGV4dCkge1xuICAgIGlmIChwYXJlbnROb2RlLmNoaWxkTm9kZXMubGVuZ3RoKSB7XG4gICAgICAgIHZhciBwcmV2Tm9kZSA9IHBhcmVudE5vZGUuY2hpbGROb2Rlc1twYXJlbnROb2RlLmNoaWxkTm9kZXMubGVuZ3RoIC0gMV07XG5cbiAgICAgICAgaWYgKHByZXZOb2RlLm5vZGVOYW1lID09PSAnI3RleHQnKSB7XG4gICAgICAgICAgICBwcmV2Tm9kZS52YWx1ZSArPSB0ZXh0O1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXBwZW5kQ2hpbGQocGFyZW50Tm9kZSwgY3JlYXRlVGV4dE5vZGUodGV4dCkpO1xufTtcblxuZXhwb3J0cy5pbnNlcnRUZXh0QmVmb3JlID0gZnVuY3Rpb24gKHBhcmVudE5vZGUsIHRleHQsIHJlZmVyZW5jZU5vZGUpIHtcbiAgICB2YXIgcHJldk5vZGUgPSBwYXJlbnROb2RlLmNoaWxkTm9kZXNbcGFyZW50Tm9kZS5jaGlsZE5vZGVzLmluZGV4T2YocmVmZXJlbmNlTm9kZSkgLSAxXTtcblxuICAgIGlmIChwcmV2Tm9kZSAmJiBwcmV2Tm9kZS5ub2RlTmFtZSA9PT0gJyN0ZXh0JylcbiAgICAgICAgcHJldk5vZGUudmFsdWUgKz0gdGV4dDtcbiAgICBlbHNlXG4gICAgICAgIGluc2VydEJlZm9yZShwYXJlbnROb2RlLCBjcmVhdGVUZXh0Tm9kZSh0ZXh0KSwgcmVmZXJlbmNlTm9kZSk7XG59O1xuXG5leHBvcnRzLmFkb3B0QXR0cmlidXRlcyA9IGZ1bmN0aW9uIChyZWNpcGllbnQsIGF0dHJzKSB7XG4gICAgdmFyIHJlY2lwaWVudEF0dHJzTWFwID0gW107XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlY2lwaWVudC5hdHRycy5sZW5ndGg7IGkrKylcbiAgICAgICAgcmVjaXBpZW50QXR0cnNNYXAucHVzaChyZWNpcGllbnQuYXR0cnNbaV0ubmFtZSk7XG5cbiAgICBmb3IgKHZhciBqID0gMDsgaiA8IGF0dHJzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIGlmIChyZWNpcGllbnRBdHRyc01hcC5pbmRleE9mKGF0dHJzW2pdLm5hbWUpID09PSAtMSlcbiAgICAgICAgICAgIHJlY2lwaWVudC5hdHRycy5wdXNoKGF0dHJzW2pdKTtcbiAgICB9XG59O1xuXG5cbi8vVHJlZSB0cmF2ZXJzaW5nXG5leHBvcnRzLmdldEZpcnN0Q2hpbGQgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgIHJldHVybiBub2RlLmNoaWxkTm9kZXNbMF07XG59O1xuXG5leHBvcnRzLmdldENoaWxkTm9kZXMgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgIHJldHVybiBub2RlLmNoaWxkTm9kZXM7XG59O1xuXG5leHBvcnRzLmdldFBhcmVudE5vZGUgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgIHJldHVybiBub2RlLnBhcmVudE5vZGU7XG59O1xuXG5leHBvcnRzLmdldEF0dHJMaXN0ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICByZXR1cm4gZWxlbWVudC5hdHRycztcbn07XG5cbi8vTm9kZSBkYXRhXG5leHBvcnRzLmdldFRhZ05hbWUgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgIHJldHVybiBlbGVtZW50LnRhZ05hbWU7XG59O1xuXG5leHBvcnRzLmdldE5hbWVzcGFjZVVSSSA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgcmV0dXJuIGVsZW1lbnQubmFtZXNwYWNlVVJJO1xufTtcblxuZXhwb3J0cy5nZXRUZXh0Tm9kZUNvbnRlbnQgPSBmdW5jdGlvbiAodGV4dE5vZGUpIHtcbiAgICByZXR1cm4gdGV4dE5vZGUudmFsdWU7XG59O1xuXG5leHBvcnRzLmdldENvbW1lbnROb2RlQ29udGVudCA9IGZ1bmN0aW9uIChjb21tZW50Tm9kZSkge1xuICAgIHJldHVybiBjb21tZW50Tm9kZS5kYXRhO1xufTtcblxuZXhwb3J0cy5nZXREb2N1bWVudFR5cGVOb2RlTmFtZSA9IGZ1bmN0aW9uIChkb2N0eXBlTm9kZSkge1xuICAgIHJldHVybiBkb2N0eXBlTm9kZS5uYW1lO1xufTtcblxuZXhwb3J0cy5nZXREb2N1bWVudFR5cGVOb2RlUHVibGljSWQgPSBmdW5jdGlvbiAoZG9jdHlwZU5vZGUpIHtcbiAgICByZXR1cm4gZG9jdHlwZU5vZGUucHVibGljSWQ7XG59O1xuXG5leHBvcnRzLmdldERvY3VtZW50VHlwZU5vZGVTeXN0ZW1JZCA9IGZ1bmN0aW9uIChkb2N0eXBlTm9kZSkge1xuICAgIHJldHVybiBkb2N0eXBlTm9kZS5zeXN0ZW1JZDtcbn07XG5cbi8vTm9kZSB0eXBlc1xuZXhwb3J0cy5pc1RleHROb2RlID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICByZXR1cm4gbm9kZS5ub2RlTmFtZSA9PT0gJyN0ZXh0Jztcbn07XG5cbmV4cG9ydHMuaXNDb21tZW50Tm9kZSA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgcmV0dXJuIG5vZGUubm9kZU5hbWUgPT09ICcjY29tbWVudCc7XG59O1xuXG5leHBvcnRzLmlzRG9jdW1lbnRUeXBlTm9kZSA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgcmV0dXJuIG5vZGUubm9kZU5hbWUgPT09ICcjZG9jdW1lbnRUeXBlJztcbn07XG5cbmV4cG9ydHMuaXNFbGVtZW50Tm9kZSA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgcmV0dXJuICEhbm9kZS50YWdOYW1lO1xufTtcbiJdfQ==