7c92890348161dac9003313ab14cf15a
/*
  Module dependencies
*/
var ElementType = require('domelementtype');

var entities = require('entities');
/* mixed-case SVG and MathML tags & attributes
   recognized by the HTML parser, see
   https://html.spec.whatwg.org/multipage/parsing.html#parsing-main-inforeign
*/


var foreignNames = require('./foreignNames.json');

foreignNames.elementNames.__proto__ = null;
/* use as a simple dictionary */

foreignNames.attributeNames.__proto__ = null;
var unencodedElements = {
  __proto__: null,
  style: true,
  script: true,
  xmp: true,
  iframe: true,
  noembed: true,
  noframes: true,
  plaintext: true,
  noscript: true
};
/*
  Format attributes
*/

function formatAttrs(attributes, opts) {
  if (!attributes) return;
  var output = '';
  var value; // Loop through the attributes

  for (var key in attributes) {
    value = attributes[key];

    if (output) {
      output += ' ';
    }

    if (opts.xmlMode === 'foreign') {
      /* fix up mixed-case attribute names */
      key = foreignNames.attributeNames[key] || key;
    }

    output += key;

    if (value !== null && value !== '' || opts.xmlMode) {
      output += '="' + (opts.decodeEntities ? entities.encodeXML(value) : value.replace(/\"/g, '&quot;')) + '"';
    }
  }

  return output;
}
/*
  Self-enclosing tags (stolen from node-htmlparser)
*/


var singleTag = {
  __proto__: null,
  area: true,
  base: true,
  basefont: true,
  br: true,
  col: true,
  command: true,
  embed: true,
  frame: true,
  hr: true,
  img: true,
  input: true,
  isindex: true,
  keygen: true,
  link: true,
  meta: true,
  param: true,
  source: true,
  track: true,
  wbr: true
};

var render = module.exports = function (dom, opts) {
  if (!Array.isArray(dom) && !dom.cheerio) dom = [dom];
  opts = opts || {};
  var output = '';

  for (var i = 0; i < dom.length; i++) {
    var elem = dom[i];
    if (elem.type === 'root') output += render(elem.children, opts);else if (ElementType.isTag(elem)) output += renderTag(elem, opts);else if (elem.type === ElementType.Directive) output += renderDirective(elem);else if (elem.type === ElementType.Comment) output += renderComment(elem);else if (elem.type === ElementType.CDATA) output += renderCdata(elem);else output += renderText(elem, opts);
  }

  return output;
};

var foreignModeIntegrationPoints = ['mi', 'mo', 'mn', 'ms', 'mtext', 'annotation-xml', 'foreignObject', 'desc', 'title'];

function renderTag(elem, opts) {
  // Handle SVG / MathML in HTML
  if (opts.xmlMode === 'foreign') {
    /* fix up mixed-case element names */
    elem.name = foreignNames.elementNames[elem.name] || elem.name;
    /* exit foreign mode at integration points */

    if (elem.parent && foreignModeIntegrationPoints.indexOf(elem.parent.name) >= 0) opts = Object.assign({}, opts, {
      xmlMode: false
    });
  }

  if (!opts.xmlMode && ['svg', 'math'].indexOf(elem.name) >= 0) {
    opts = Object.assign({}, opts, {
      xmlMode: 'foreign'
    });
  }

  var tag = '<' + elem.name;
  var attribs = formatAttrs(elem.attribs, opts);

  if (attribs) {
    tag += ' ' + attribs;
  }

  if (opts.xmlMode && (!elem.children || elem.children.length === 0)) {
    tag += '/>';
  } else {
    tag += '>';

    if (elem.children) {
      tag += render(elem.children, opts);
    }

    if (!singleTag[elem.name] || opts.xmlMode) {
      tag += '</' + elem.name + '>';
    }
  }

  return tag;
}

function renderDirective(elem) {
  return '<' + elem.data + '>';
}

function renderText(elem, opts) {
  var data = elem.data || ''; // if entities weren't decoded, no need to encode them back

  if (opts.decodeEntities && !(elem.parent && elem.parent.name in unencodedElements)) {
    data = entities.encodeXML(data);
  }

  return data;
}

function renderCdata(elem) {
  return '<![CDATA[' + elem.children[0].data + ']]>';
}

function renderComment(elem) {
  return '<!--' + elem.data + '-->';
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIkVsZW1lbnRUeXBlIiwicmVxdWlyZSIsImVudGl0aWVzIiwiZm9yZWlnbk5hbWVzIiwiZWxlbWVudE5hbWVzIiwiX19wcm90b19fIiwiYXR0cmlidXRlTmFtZXMiLCJ1bmVuY29kZWRFbGVtZW50cyIsInN0eWxlIiwic2NyaXB0IiwieG1wIiwiaWZyYW1lIiwibm9lbWJlZCIsIm5vZnJhbWVzIiwicGxhaW50ZXh0Iiwibm9zY3JpcHQiLCJmb3JtYXRBdHRycyIsImF0dHJpYnV0ZXMiLCJvcHRzIiwib3V0cHV0IiwidmFsdWUiLCJrZXkiLCJ4bWxNb2RlIiwiZGVjb2RlRW50aXRpZXMiLCJlbmNvZGVYTUwiLCJyZXBsYWNlIiwic2luZ2xlVGFnIiwiYXJlYSIsImJhc2UiLCJiYXNlZm9udCIsImJyIiwiY29sIiwiY29tbWFuZCIsImVtYmVkIiwiZnJhbWUiLCJociIsImltZyIsImlucHV0IiwiaXNpbmRleCIsImtleWdlbiIsImxpbmsiLCJtZXRhIiwicGFyYW0iLCJzb3VyY2UiLCJ0cmFjayIsIndiciIsInJlbmRlciIsIm1vZHVsZSIsImV4cG9ydHMiLCJkb20iLCJBcnJheSIsImlzQXJyYXkiLCJjaGVlcmlvIiwiaSIsImxlbmd0aCIsImVsZW0iLCJ0eXBlIiwiY2hpbGRyZW4iLCJpc1RhZyIsInJlbmRlclRhZyIsIkRpcmVjdGl2ZSIsInJlbmRlckRpcmVjdGl2ZSIsIkNvbW1lbnQiLCJyZW5kZXJDb21tZW50IiwiQ0RBVEEiLCJyZW5kZXJDZGF0YSIsInJlbmRlclRleHQiLCJmb3JlaWduTW9kZUludGVncmF0aW9uUG9pbnRzIiwibmFtZSIsInBhcmVudCIsImluZGV4T2YiLCJPYmplY3QiLCJhc3NpZ24iLCJ0YWciLCJhdHRyaWJzIiwiZGF0YSJdLCJtYXBwaW5ncyI6IkFBQUE7OztBQUdBLElBQUlBLFdBQVcsR0FBR0MsT0FBTyxDQUFDLGdCQUFELENBQXpCOztBQUNBLElBQUlDLFFBQVEsR0FBR0QsT0FBTyxD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QUFHekUsUUFBUSxDQUFDc0IsU0FBVCxDQUFtQm1ELElBQW5CLENBQVA7QUFDRDs7QUFFRCxTQUFPQSxJQUFQO0FBQ0Q7O0FBRUQsU0FBU1YsV0FBVCxDQUFxQlYsSUFBckIsRUFBMkI7QUFDekIsU0FBTyxjQUFjQSxJQUFJLENBQUNFLFFBQUwsQ0FBYyxDQUFkLEVBQWlCa0IsSUFBL0IsR0FBc0MsS0FBN0M7QUFDRDs7QUFFRCxTQUFTWixhQUFULENBQXVCUixJQUF2QixFQUE2QjtBQUMzQixTQUFPLFNBQVNBLElBQUksQ0FBQ29CLElBQWQsR0FBcUIsS0FBNUI7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gIE1vZHVsZSBkZXBlbmRlbmNpZXNcbiovXG52YXIgRWxlbWVudFR5cGUgPSByZXF1aXJlKCdkb21lbGVtZW50dHlwZScpO1xudmFyIGVudGl0aWVzID0gcmVxdWlyZSgnZW50aXRpZXMnKTtcblxuLyogbWl4ZWQtY2FzZSBTVkcgYW5kIE1hdGhNTCB0YWdzICYgYXR0cmlidXRlc1xuICAgcmVjb2duaXplZCBieSB0aGUgSFRNTCBwYXJzZXIsIHNlZVxuICAgaHR0cHM6Ly9odG1sLnNwZWMud2hhdHdnLm9yZy9tdWx0aXBhZ2UvcGFyc2luZy5odG1sI3BhcnNpbmctbWFpbi1pbmZvcmVpZ25cbiovXG52YXIgZm9yZWlnbk5hbWVzID0gcmVxdWlyZSgnLi9mb3JlaWduTmFtZXMuanNvbicpO1xuZm9yZWlnbk5hbWVzLmVsZW1lbnROYW1lcy5fX3Byb3RvX18gPSBudWxsOyAvKiB1c2UgYXMgYSBzaW1wbGUgZGljdGlvbmFyeSAqL1xuZm9yZWlnbk5hbWVzLmF0dHJpYnV0ZU5hbWVzLl9fcHJvdG9fXyA9IG51bGw7XG5cbnZhciB1bmVuY29kZWRFbGVtZW50cyA9IHtcbiAgX19wcm90b19fOiBudWxsLFxuICBzdHlsZTogdHJ1ZSxcbiAgc2NyaXB0OiB0cnVlLFxuICB4bXA6IHRydWUsXG4gIGlmcmFtZTogdHJ1ZSxcbiAgbm9lbWJlZDogdHJ1ZSxcbiAgbm9mcmFtZXM6IHRydWUsXG4gIHBsYWludGV4dDogdHJ1ZSxcbiAgbm9zY3JpcHQ6IHRydWVcbn07XG5cbi8qXG4gIEZvcm1hdCBhdHRyaWJ1dGVzXG4qL1xuZnVuY3Rpb24gZm9ybWF0QXR0cnMoYXR0cmlidXRlcywgb3B0cykge1xuICBpZiAoIWF0dHJpYnV0ZXMpIHJldHVybjtcblxuICB2YXIgb3V0cHV0ID0gJyc7XG4gIHZhciB2YWx1ZTtcblxuICAvLyBMb29wIHRocm91Z2ggdGhlIGF0dHJpYnV0ZXNcbiAgZm9yICh2YXIga2V5IGluIGF0dHJpYnV0ZXMpIHtcbiAgICB2YWx1ZSA9IGF0dHJpYnV0ZXNba2V5XTtcbiAgICBpZiAob3V0cHV0KSB7XG4gICAgICBvdXRwdXQgKz0gJyAnO1xuICAgIH1cblxuICAgIGlmIChvcHRzLnhtbE1vZGUgPT09ICdmb3JlaWduJykge1xuICAgICAgLyogZml4IHVwIG1peGVkLWNhc2UgYXR0cmlidXRlIG5hbWVzICovXG4gICAgICBrZXkgPSBmb3JlaWduTmFtZXMuYXR0cmlidXRlTmFtZXNba2V5XSB8fCBrZXk7XG4gICAgfVxuICAgIG91dHB1dCArPSBrZXk7XG4gICAgaWYgKCh2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gJycpIHx8IG9wdHMueG1sTW9kZSkge1xuICAgICAgb3V0cHV0ICs9XG4gICAgICAgICc9XCInICtcbiAgICAgICAgKG9wdHMuZGVjb2RlRW50aXRpZXNcbiAgICAgICAgICA/IGVudGl0aWVzLmVuY29kZVhNTCh2YWx1ZSlcbiAgICAgICAgICA6IHZhbHVlLnJlcGxhY2UoL1xcXCIvZywgJyZxdW90OycpKSArXG4gICAgICAgICdcIic7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIG91dHB1dDtcbn1cblxuLypcbiAgU2VsZi1lbmNsb3NpbmcgdGFncyAoc3RvbGVuIGZyb20gbm9kZS1odG1scGFyc2VyKVxuKi9cbnZhciBzaW5nbGVUYWcgPSB7XG4gIF9fcHJvdG9fXzogbnVsbCxcbiAgYXJlYTogdHJ1ZSxcbiAgYmFzZTogdHJ1ZSxcbiAgYmFzZWZvbnQ6IHRydWUsXG4gIGJyOiB0cnVlLFxuICBjb2w6IHRydWUsXG4gIGNvbW1hbmQ6IHRydWUsXG4gIGVtYmVkOiB0cnVlLFxuICBmcmFtZTogdHJ1ZSxcbiAgaHI6IHRydWUsXG4gIGltZzogdHJ1ZSxcbiAgaW5wdXQ6IHRydWUsXG4gIGlzaW5kZXg6IHRydWUsXG4gIGtleWdlbjogdHJ1ZSxcbiAgbGluazogdHJ1ZSxcbiAgbWV0YTogdHJ1ZSxcbiAgcGFyYW06IHRydWUsXG4gIHNvdXJjZTogdHJ1ZSxcbiAgdHJhY2s6IHRydWUsXG4gIHdicjogdHJ1ZVxufTtcblxudmFyIHJlbmRlciA9IChtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGRvbSwgb3B0cykge1xuICBpZiAoIUFycmF5LmlzQXJyYXkoZG9tKSAmJiAhZG9tLmNoZWVyaW8pIGRvbSA9IFtkb21dO1xuICBvcHRzID0gb3B0cyB8fCB7fTtcblxuICB2YXIgb3V0cHV0ID0gJyc7XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBkb20ubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgZWxlbSA9IGRvbVtpXTtcblxuICAgIGlmIChlbGVtLnR5cGUgPT09ICdyb290Jykgb3V0cHV0ICs9IHJlbmRlcihlbGVtLmNoaWxkcmVuLCBvcHRzKTtcbiAgICBlbHNlIGlmIChFbGVtZW50VHlwZS5pc1RhZyhlbGVtKSkgb3V0cHV0ICs9IHJlbmRlclRhZyhlbGVtLCBvcHRzKTtcbiAgICBlbHNlIGlmIChlbGVtLnR5cGUgPT09IEVsZW1lbnRUeXBlLkRpcmVjdGl2ZSlcbiAgICAgIG91dHB1dCArPSByZW5kZXJEaXJlY3RpdmUoZWxlbSk7XG4gICAgZWxzZSBpZiAoZWxlbS50eXBlID09PSBFbGVtZW50VHlwZS5Db21tZW50KSBvdXRwdXQgKz0gcmVuZGVyQ29tbWVudChlbGVtKTtcbiAgICBlbHNlIGlmIChlbGVtLnR5cGUgPT09IEVsZW1lbnRUeXBlLkNEQVRBKSBvdXRwdXQgKz0gcmVuZGVyQ2RhdGEoZWxlbSk7XG4gICAgZWxzZSBvdXRwdXQgKz0gcmVuZGVyVGV4dChlbGVtLCBvcHRzKTtcbiAgfVxuXG4gIHJldHVybiBvdXRwdXQ7XG59KTtcblxudmFyIGZvcmVpZ25Nb2RlSW50ZWdyYXRpb25Qb2ludHMgPSBbXG4gICdtaScsXG4gICdtbycsXG4gICdtbicsXG4gICdtcycsXG4gICdtdGV4dCcsXG4gICdhbm5vdGF0aW9uLXhtbCcsXG4gICdmb3JlaWduT2JqZWN0JyxcbiAgJ2Rlc2MnLFxuICAndGl0bGUnXG5dO1xuXG5mdW5jdGlvbiByZW5kZXJUYWcoZWxlbSwgb3B0cykge1xuICAvLyBIYW5kbGUgU1ZHIC8gTWF0aE1MIGluIEhUTUxcbiAgaWYgKG9wdHMueG1sTW9kZSA9PT0gJ2ZvcmVpZ24nKSB7XG4gICAgLyogZml4IHVwIG1peGVkLWNhc2UgZWxlbWVudCBuYW1lcyAqL1xuICAgIGVsZW0ubmFtZSA9IGZvcmVpZ25OYW1lcy5lbGVtZW50TmFtZXNbZWxlbS5uYW1lXSB8fCBlbGVtLm5hbWU7XG4gICAgLyogZXhpdCBmb3JlaWduIG1vZGUgYXQgaW50ZWdyYXRpb24gcG9pbnRzICovXG4gICAgaWYgKFxuICAgICAgZWxlbS5wYXJlbnQgJiZcbiAgICAgIGZvcmVpZ25Nb2RlSW50ZWdyYXRpb25Qb2ludHMuaW5kZXhPZihlbGVtLnBhcmVudC5uYW1lKSA+PSAwXG4gICAgKVxuICAgICAgb3B0cyA9IE9iamVjdC5hc3NpZ24oe30sIG9wdHMsIHsgeG1sTW9kZTogZmFsc2UgfSk7XG4gIH1cbiAgaWYgKCFvcHRzLnhtbE1vZGUgJiYgWydzdmcnLCAnbWF0aCddLmluZGV4T2YoZWxlbS5uYW1lKSA+PSAwKSB7XG4gICAgb3B0cyA9IE9iamVjdC5hc3NpZ24oe30sIG9wdHMsIHsgeG1sTW9kZTogJ2ZvcmVpZ24nIH0pO1xuICB9XG5cbiAgdmFyIHRhZyA9ICc8JyArIGVsZW0ubmFtZTtcbiAgdmFyIGF0dHJpYnMgPSBmb3JtYXRBdHRycyhlbGVtLmF0dHJpYnMsIG9wdHMpO1xuXG4gIGlmIChhdHRyaWJzKSB7XG4gICAgdGFnICs9ICcgJyArIGF0dHJpYnM7XG4gIH1cblxuICBpZiAob3B0cy54bWxNb2RlICYmICghZWxlbS5jaGlsZHJlbiB8fCBlbGVtLmNoaWxkcmVuLmxlbmd0aCA9PT0gMCkpIHtcbiAgICB0YWcgKz0gJy8+JztcbiAgfSBlbHNlIHtcbiAgICB0YWcgKz0gJz4nO1xuICAgIGlmIChlbGVtLmNoaWxkcmVuKSB7XG4gICAgICB0YWcgKz0gcmVuZGVyKGVsZW0uY2hpbGRyZW4sIG9wdHMpO1xuICAgIH1cblxuICAgIGlmICghc2luZ2xlVGFnW2VsZW0ubmFtZV0gfHwgb3B0cy54bWxNb2RlKSB7XG4gICAgICB0YWcgKz0gJzwvJyArIGVsZW0ubmFtZSArICc+JztcbiAgICB9XG4gIH1cblxuICByZXR1cm4gdGFnO1xufVxuXG5mdW5jdGlvbiByZW5kZXJEaXJlY3RpdmUoZWxlbSkge1xuICByZXR1cm4gJzwnICsgZWxlbS5kYXRhICsgJz4nO1xufVxuXG5mdW5jdGlvbiByZW5kZXJUZXh0KGVsZW0sIG9wdHMpIHtcbiAgdmFyIGRhdGEgPSBlbGVtLmRhdGEgfHwgJyc7XG5cbiAgLy8gaWYgZW50aXRpZXMgd2VyZW4ndCBkZWNvZGVkLCBubyBuZWVkIHRvIGVuY29kZSB0aGVtIGJhY2tcbiAgaWYgKFxuICAgIG9wdHMuZGVjb2RlRW50aXRpZXMgJiZcbiAgICAhKGVsZW0ucGFyZW50ICYmIGVsZW0ucGFyZW50Lm5hbWUgaW4gdW5lbmNvZGVkRWxlbWVudHMpXG4gICkge1xuICAgIGRhdGEgPSBlbnRpdGllcy5lbmNvZGVYTUwoZGF0YSk7XG4gIH1cblxuICByZXR1cm4gZGF0YTtcbn1cblxuZnVuY3Rpb24gcmVuZGVyQ2RhdGEoZWxlbSkge1xuICByZXR1cm4gJzwhW0NEQVRBWycgKyBlbGVtLmNoaWxkcmVuWzBdLmRhdGEgKyAnXV0+Jztcbn1cblxuZnVuY3Rpb24gcmVuZGVyQ29tbWVudChlbGVtKSB7XG4gIHJldHVybiAnPCEtLScgKyBlbGVtLmRhdGEgKyAnLS0+Jztcbn1cbiJdfQ==