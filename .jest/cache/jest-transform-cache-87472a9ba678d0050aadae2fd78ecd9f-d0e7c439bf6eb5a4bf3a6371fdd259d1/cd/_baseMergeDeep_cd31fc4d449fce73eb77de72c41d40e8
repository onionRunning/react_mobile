8199f25081dc5d2289192c80404a19fb
var assignMergeValue = require('./_assignMergeValue'),
    cloneBuffer = require('./_cloneBuffer'),
    cloneTypedArray = require('./_cloneTypedArray'),
    copyArray = require('./_copyArray'),
    initCloneObject = require('./_initCloneObject'),
    isArguments = require('./isArguments'),
    isArray = require('./isArray'),
    isArrayLikeObject = require('./isArrayLikeObject'),
    isBuffer = require('./isBuffer'),
    isFunction = require('./isFunction'),
    isObject = require('./isObject'),
    isPlainObject = require('./isPlainObject'),
    isTypedArray = require('./isTypedArray'),
    safeGet = require('./_safeGet'),
    toPlainObject = require('./toPlainObject');
/**
 * A specialized version of `baseMerge` for arrays and objects which performs
 * deep merges and tracks traversed objects enabling objects with circular
 * references to be merged.
 *
 * @private
 * @param {Object} object The destination object.
 * @param {Object} source The source object.
 * @param {string} key The key of the value to merge.
 * @param {number} srcIndex The index of `source`.
 * @param {Function} mergeFunc The function to merge values.
 * @param {Function} [customizer] The function to customize assigned values.
 * @param {Object} [stack] Tracks traversed source values and their merged
 *  counterparts.
 */


function baseMergeDeep(object, source, key, srcIndex, mergeFunc, customizer, stack) {
  var objValue = safeGet(object, key),
      srcValue = safeGet(source, key),
      stacked = stack.get(srcValue);

  if (stacked) {
    assignMergeValue(object, key, stacked);
    return;
  }

  var newValue = customizer ? customizer(objValue, srcValue, key + '', object, source, stack) : undefined;
  var isCommon = newValue === undefined;

  if (isCommon) {
    var isArr = isArray(srcValue),
        isBuff = !isArr && isBuffer(srcValue),
        isTyped = !isArr && !isBuff && isTypedArray(srcValue);
    newValue = srcValue;

    if (isArr || isBuff || isTyped) {
      if (isArray(objValue)) {
        newValue = objValue;
      } else if (isArrayLikeObject(objValue)) {
        newValue = copyArray(objValue);
      } else if (isBuff) {
        isCommon = false;
        newValue = cloneBuffer(srcValue, true);
      } else if (isTyped) {
        isCommon = false;
        newValue = cloneTypedArray(srcValue, true);
      } else {
        newValue = [];
      }
    } else if (isPlainObject(srcValue) || isArguments(srcValue)) {
      newValue = objValue;

      if (isArguments(objValue)) {
        newValue = toPlainObject(objValue);
      } else if (!isObject(objValue) || isFunction(objValue)) {
        newValue = initCloneObject(srcValue);
      }
    } else {
      isCommon = false;
    }
  }

  if (isCommon) {
    // Recursively merge objects and arrays (susceptible to call stack limits).
    stack.set(srcValue, newValue);
    mergeFunc(newValue, srcValue, srcIndex, customizer, stack);
    stack['delete'](srcValue);
  }

  assignMergeValue(object, key, newValue);
}

module.exports = baseMergeDeep;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIl9iYXNlTWVyZ2VEZWVwLmpzIl0sIm5hbWVzIjpbImFzc2lnbk1lcmdlVmFsdWUiLCJyZXF1aXJlIiwiY2xvbmVCdWZmZXIiLCJjbG9uZVR5cGVkQXJyYXkiLCJjb3B5QXJyYXkiLCJpbml0Q2xvbmVPYmplY3QiLCJpc0FyZ3VtZW50cyIsImlzQXJyYXkiLCJpc0FycmF5TGlrZU9iamVjdCIsImlzQnVmZmVyIiwiaXNGdW5jdGlvbiIsImlzT2JqZWN0IiwiaXNQbGFpbk9iamVjdCIsImlzVHlwZWRBcnJheSIsInNhZmVHZXQiLCJ0b1BsYWluT2JqZWN0IiwiYmFzZU1lcmdlRGVlcCIsIm9iamVjdCIsInNvdXJjZSIsImtleSIsInNyY0luZGV4IiwibWVyZ2VGdW5jIiwiY3VzdG9taXplciIsInN0YWNrIiwib2JqVmFsdWUiLCJzcmNWYWx1ZSIsInN0YWNrZWQiLCJnZXQiLCJuZXdWYWx1ZSIsInVuZGVmaW5lZCIsImlzQ29tbW9uIiwiaXNBcnIiLCJpc0J1ZmYiLCJpc1R5cGVkIiwic2V0IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSUEsZ0JBQWdCLEdBQUdDLE9BQU8sQ0FBQyxxQkFBRCxDQUE5QjtBQUFBLElBQ0lDLFdBQVcsR0FBR0QsT0FBTyxDQUFDLGdCQUFELENBRHpCO0FBQUEsSUFFSUUsZUFBZSxHQUFHRixPQUFPLENBQUMsb0JBQUQsQ0FGN0I7QUFBQSxJQUdJRyxTQUFTLEdBQUdILE9BQU8sQ0FBQyxjQUFELENBSHZCO0FBQUEsSUFJSUksZUFBZSxHQUFHSixPQUFPLENBQUMsb0JBQUQsQ0FKN0I7QUFBQSxJQUtJSyxXQUFXLEdBQUdMLE9BQU8sQ0FBQyxlQUFELENBTHpCO0FBQUEsSUFNSU0sT0FBTyxHQUFHTixPQUFPLENBQUMsV0FBRCxDQU5yQjtBQUFBLElBT0lPLGlCQUFpQixHQUFHUCxPQUFPLENBQUMscUJBQUQsQ0FQL0I7QUFBQSxJQVFJUSxRQUFRLEdBQUdSLE9BQU8sQ0FBQyxZQUFELENBUnRCO0FB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QUQsQ0FBVCxJQUF1QmQsVUFBVSxDQUFDYyxRQUFELENBQXJDLEVBQWlEO0FBQ3BESSxRQUFBQSxRQUFRLEdBQUd2QixlQUFlLENBQUNvQixRQUFELENBQTFCO0FBQ0Q7QUFDRixLQVJJLE1BU0E7QUFDSEssTUFBQUEsUUFBUSxHQUFHLEtBQVg7QUFDRDtBQUNGOztBQUNELE1BQUlBLFFBQUosRUFBYztBQUNaO0FBQ0FQLElBQUFBLEtBQUssQ0FBQ1csR0FBTixDQUFVVCxRQUFWLEVBQW9CRyxRQUFwQjtBQUNBUCxJQUFBQSxTQUFTLENBQUNPLFFBQUQsRUFBV0gsUUFBWCxFQUFxQkwsUUFBckIsRUFBK0JFLFVBQS9CLEVBQTJDQyxLQUEzQyxDQUFUO0FBQ0FBLElBQUFBLEtBQUssQ0FBQyxRQUFELENBQUwsQ0FBZ0JFLFFBQWhCO0FBQ0Q7O0FBQ0R6QixFQUFBQSxnQkFBZ0IsQ0FBQ2lCLE1BQUQsRUFBU0UsR0FBVCxFQUFjUyxRQUFkLENBQWhCO0FBQ0Q7O0FBRURPLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQnBCLGFBQWpCIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGFzc2lnbk1lcmdlVmFsdWUgPSByZXF1aXJlKCcuL19hc3NpZ25NZXJnZVZhbHVlJyksXG4gICAgY2xvbmVCdWZmZXIgPSByZXF1aXJlKCcuL19jbG9uZUJ1ZmZlcicpLFxuICAgIGNsb25lVHlwZWRBcnJheSA9IHJlcXVpcmUoJy4vX2Nsb25lVHlwZWRBcnJheScpLFxuICAgIGNvcHlBcnJheSA9IHJlcXVpcmUoJy4vX2NvcHlBcnJheScpLFxuICAgIGluaXRDbG9uZU9iamVjdCA9IHJlcXVpcmUoJy4vX2luaXRDbG9uZU9iamVjdCcpLFxuICAgIGlzQXJndW1lbnRzID0gcmVxdWlyZSgnLi9pc0FyZ3VtZW50cycpLFxuICAgIGlzQXJyYXkgPSByZXF1aXJlKCcuL2lzQXJyYXknKSxcbiAgICBpc0FycmF5TGlrZU9iamVjdCA9IHJlcXVpcmUoJy4vaXNBcnJheUxpa2VPYmplY3QnKSxcbiAgICBpc0J1ZmZlciA9IHJlcXVpcmUoJy4vaXNCdWZmZXInKSxcbiAgICBpc0Z1bmN0aW9uID0gcmVxdWlyZSgnLi9pc0Z1bmN0aW9uJyksXG4gICAgaXNPYmplY3QgPSByZXF1aXJlKCcuL2lzT2JqZWN0JyksXG4gICAgaXNQbGFpbk9iamVjdCA9IHJlcXVpcmUoJy4vaXNQbGFpbk9iamVjdCcpLFxuICAgIGlzVHlwZWRBcnJheSA9IHJlcXVpcmUoJy4vaXNUeXBlZEFycmF5JyksXG4gICAgc2FmZUdldCA9IHJlcXVpcmUoJy4vX3NhZmVHZXQnKSxcbiAgICB0b1BsYWluT2JqZWN0ID0gcmVxdWlyZSgnLi90b1BsYWluT2JqZWN0Jyk7XG5cbi8qKlxuICogQSBzcGVjaWFsaXplZCB2ZXJzaW9uIG9mIGBiYXNlTWVyZ2VgIGZvciBhcnJheXMgYW5kIG9iamVjdHMgd2hpY2ggcGVyZm9ybXNcbiAqIGRlZXAgbWVyZ2VzIGFuZCB0cmFja3MgdHJhdmVyc2VkIG9iamVjdHMgZW5hYmxpbmcgb2JqZWN0cyB3aXRoIGNpcmN1bGFyXG4gKiByZWZlcmVuY2VzIHRvIGJlIG1lcmdlZC5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBUaGUgZGVzdGluYXRpb24gb2JqZWN0LlxuICogQHBhcmFtIHtPYmplY3R9IHNvdXJjZSBUaGUgc291cmNlIG9iamVjdC5cbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSBvZiB0aGUgdmFsdWUgdG8gbWVyZ2UuXG4gKiBAcGFyYW0ge251bWJlcn0gc3JjSW5kZXggVGhlIGluZGV4IG9mIGBzb3VyY2VgLlxuICogQHBhcmFtIHtGdW5jdGlvbn0gbWVyZ2VGdW5jIFRoZSBmdW5jdGlvbiB0byBtZXJnZSB2YWx1ZXMuXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBbY3VzdG9taXplcl0gVGhlIGZ1bmN0aW9uIHRvIGN1c3RvbWl6ZSBhc3NpZ25lZCB2YWx1ZXMuXG4gKiBAcGFyYW0ge09iamVjdH0gW3N0YWNrXSBUcmFja3MgdHJhdmVyc2VkIHNvdXJjZSB2YWx1ZXMgYW5kIHRoZWlyIG1lcmdlZFxuICogIGNvdW50ZXJwYXJ0cy5cbiAqL1xuZnVuY3Rpb24gYmFzZU1lcmdlRGVlcChvYmplY3QsIHNvdXJjZSwga2V5LCBzcmNJbmRleCwgbWVyZ2VGdW5jLCBjdXN0b21pemVyLCBzdGFjaykge1xuICB2YXIgb2JqVmFsdWUgPSBzYWZlR2V0KG9iamVjdCwga2V5KSxcbiAgICAgIHNyY1ZhbHVlID0gc2FmZUdldChzb3VyY2UsIGtleSksXG4gICAgICBzdGFja2VkID0gc3RhY2suZ2V0KHNyY1ZhbHVlKTtcblxuICBpZiAoc3RhY2tlZCkge1xuICAgIGFzc2lnbk1lcmdlVmFsdWUob2JqZWN0LCBrZXksIHN0YWNrZWQpO1xuICAgIHJldHVybjtcbiAgfVxuICB2YXIgbmV3VmFsdWUgPSBjdXN0b21pemVyXG4gICAgPyBjdXN0b21pemVyKG9ialZhbHVlLCBzcmNWYWx1ZSwgKGtleSArICcnKSwgb2JqZWN0LCBzb3VyY2UsIHN0YWNrKVxuICAgIDogdW5kZWZpbmVkO1xuXG4gIHZhciBpc0NvbW1vbiA9IG5ld1ZhbHVlID09PSB1bmRlZmluZWQ7XG5cbiAgaWYgKGlzQ29tbW9uKSB7XG4gICAgdmFyIGlzQXJyID0gaXNBcnJheShzcmNWYWx1ZSksXG4gICAgICAgIGlzQnVmZiA9ICFpc0FyciAmJiBpc0J1ZmZlcihzcmNWYWx1ZSksXG4gICAgICAgIGlzVHlwZWQgPSAhaXNBcnIgJiYgIWlzQnVmZiAmJiBpc1R5cGVkQXJyYXkoc3JjVmFsdWUpO1xuXG4gICAgbmV3VmFsdWUgPSBzcmNWYWx1ZTtcbiAgICBpZiAoaXNBcnIgfHwgaXNCdWZmIHx8IGlzVHlwZWQpIHtcbiAgICAgIGlmIChpc0FycmF5KG9ialZhbHVlKSkge1xuICAgICAgICBuZXdWYWx1ZSA9IG9ialZhbHVlO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAoaXNBcnJheUxpa2VPYmplY3Qob2JqVmFsdWUpKSB7XG4gICAgICAgIG5ld1ZhbHVlID0gY29weUFycmF5KG9ialZhbHVlKTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKGlzQnVmZikge1xuICAgICAgICBpc0NvbW1vbiA9IGZhbHNlO1xuICAgICAgICBuZXdWYWx1ZSA9IGNsb25lQnVmZmVyKHNyY1ZhbHVlLCB0cnVlKTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKGlzVHlwZWQpIHtcbiAgICAgICAgaXNDb21tb24gPSBmYWxzZTtcbiAgICAgICAgbmV3VmFsdWUgPSBjbG9uZVR5cGVkQXJyYXkoc3JjVmFsdWUsIHRydWUpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIG5ld1ZhbHVlID0gW107XG4gICAgICB9XG4gICAgfVxuICAgIGVsc2UgaWYgKGlzUGxhaW5PYmplY3Qoc3JjVmFsdWUpIHx8IGlzQXJndW1lbnRzKHNyY1ZhbHVlKSkge1xuICAgICAgbmV3VmFsdWUgPSBvYmpWYWx1ZTtcbiAgICAgIGlmIChpc0FyZ3VtZW50cyhvYmpWYWx1ZSkpIHtcbiAgICAgICAgbmV3VmFsdWUgPSB0b1BsYWluT2JqZWN0KG9ialZhbHVlKTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKCFpc09iamVjdChvYmpWYWx1ZSkgfHwgaXNGdW5jdGlvbihvYmpWYWx1ZSkpIHtcbiAgICAgICAgbmV3VmFsdWUgPSBpbml0Q2xvbmVPYmplY3Qoc3JjVmFsdWUpO1xuICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGlzQ29tbW9uID0gZmFsc2U7XG4gICAgfVxuICB9XG4gIGlmIChpc0NvbW1vbikge1xuICAgIC8vIFJlY3Vyc2l2ZWx5IG1lcmdlIG9iamVjdHMgYW5kIGFycmF5cyAoc3VzY2VwdGlibGUgdG8gY2FsbCBzdGFjayBsaW1pdHMpLlxuICAgIHN0YWNrLnNldChzcmNWYWx1ZSwgbmV3VmFsdWUpO1xuICAgIG1lcmdlRnVuYyhuZXdWYWx1ZSwgc3JjVmFsdWUsIHNyY0luZGV4LCBjdXN0b21pemVyLCBzdGFjayk7XG4gICAgc3RhY2tbJ2RlbGV0ZSddKHNyY1ZhbHVlKTtcbiAgfVxuICBhc3NpZ25NZXJnZVZhbHVlKG9iamVjdCwga2V5LCBuZXdWYWx1ZSk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gYmFzZU1lcmdlRGVlcDtcbiJdfQ==