75b709a433bb418fbaee6e53e88a3d18
'use strict';

var HTML = require('../common/html'); //Aliases


var $ = HTML.TAG_NAMES,
    NS = HTML.NAMESPACES; //Element utils
//OPTIMIZATION: Integer comparisons are low-cost, so we can use very fast tag name length filters here.
//It's faster than using dictionary.

function isImpliedEndTagRequired(tn) {
  switch (tn.length) {
    case 1:
      return tn === $.P;

    case 2:
      return tn === $.RB || tn === $.RP || tn === $.RT || tn === $.DD || tn === $.DT || tn === $.LI;

    case 3:
      return tn === $.RTC;

    case 6:
      return tn === $.OPTION;

    case 8:
      return tn === $.OPTGROUP || tn === $.MENUITEM;
  }

  return false;
}

function isScopingElement(tn, ns) {
  switch (tn.length) {
    case 2:
      if (tn === $.TD || tn === $.TH) return ns === NS.HTML;else if (tn === $.MI || tn === $.MO || tn === $.MN || tn === $.MS) return ns === NS.MATHML;
      break;

    case 4:
      if (tn === $.HTML) return ns === NS.HTML;else if (tn === $.DESC) return ns === NS.SVG;
      break;

    case 5:
      if (tn === $.TABLE) return ns === NS.HTML;else if (tn === $.MTEXT) return ns === NS.MATHML;else if (tn === $.TITLE) return ns === NS.SVG;
      break;

    case 6:
      return (tn === $.APPLET || tn === $.OBJECT) && ns === NS.HTML;

    case 7:
      return (tn === $.CAPTION || tn === $.MARQUEE) && ns === NS.HTML;

    case 8:
      return tn === $.TEMPLATE && ns === NS.HTML;

    case 13:
      return tn === $.FOREIGN_OBJECT && ns === NS.SVG;

    case 14:
      return tn === $.ANNOTATION_XML && ns === NS.MATHML;
  }

  return false;
} //Stack of open elements


var OpenElementStack = module.exports = function (document, treeAdapter) {
  this.stackTop = -1;
  this.items = [];
  this.current = document;
  this.currentTagName = null;
  this.currentTmplContent = null;
  this.tmplCount = 0;
  this.treeAdapter = treeAdapter;
}; //Index of element


OpenElementStack.prototype._indexOf = function (element) {
  var idx = -1;

  for (var i = this.stackTop; i >= 0; i--) {
    if (this.items[i] === element) {
      idx = i;
      break;
    }
  }

  return idx;
}; //Update current element


OpenElementStack.prototype._isInTemplate = function () {
  return this.currentTagName === $.TEMPLATE && this.treeAdapter.getNamespaceURI(this.current) === NS.HTML;
};

OpenElementStack.prototype._updateCurrentElement = function () {
  this.current = this.items[this.stackTop];
  this.currentTagName = this.current && this.treeAdapter.getTagName(this.current);
  this.currentTmplContent = this._isInTemplate() ? this.treeAdapter.getTemplateContent(this.current) : null;
}; //Mutations


OpenElementStack.prototype.push = function (element) {
  this.items[++this.stackTop] = element;

  this._updateCurrentElement();

  if (this._isInTemplate()) this.tmplCount++;
};

OpenElementStack.prototype.pop = function () {
  this.stackTop--;
  if (this.tmplCount > 0 && this._isInTemplate()) this.tmplCount--;

  this._updateCurrentElement();
};

OpenElementStack.prototype.replace = function (oldElement, newElement) {
  var idx = this._indexOf(oldElement);

  this.items[idx] = newElement;
  if (idx === this.stackTop) this._updateCurrentElement();
};

OpenElementStack.prototype.insertAfter = function (referenceElement, newElement) {
  var insertionIdx = this._indexOf(referenceElement) + 1;
  this.items.splice(insertionIdx, 0, newElement);
  if (insertionIdx === ++this.stackTop) this._updateCurrentElement();
};

OpenElementStack.prototype.popUntilTagNamePopped = function (tagName) {
  while (this.stackTop > -1) {
    var tn = this.currentTagName,
        ns = this.treeAdapter.getNamespaceURI(this.current);
    this.pop();
    if (tn === tagName && ns === NS.HTML) break;
  }
};

OpenElementStack.prototype.popUntilElementPopped = function (element) {
  while (this.stackTop > -1) {
    var poppedElement = this.current;
    this.pop();
    if (poppedElement === element) break;
  }
};

OpenElementStack.prototype.popUntilNumberedHeaderPopped = function () {
  while (this.stackTop > -1) {
    var tn = this.currentTagName,
        ns = this.treeAdapter.getNamespaceURI(this.current);
    this.pop();
    if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6 && ns === NS.HTML) break;
  }
};

OpenElementStack.prototype.popUntilTableCellPopped = function () {
  while (this.stackTop > -1) {
    var tn = this.currentTagName,
        ns = this.treeAdapter.getNamespaceURI(this.current);
    this.pop();
    if (tn === $.TD || tn === $.TH && ns === NS.HTML) break;
  }
};

OpenElementStack.prototype.popAllUpToHtmlElement = function () {
  //NOTE: here we assume that root <html> element is always first in the open element stack, so
  //we perform this fast stack clean up.
  this.stackTop = 0;

  this._updateCurrentElement();
};

OpenElementStack.prototype.clearBackToTableContext = function () {
  while (this.currentTagName !== $.TABLE && this.currentTagName !== $.TEMPLATE && this.currentTagName !== $.HTML || this.treeAdapter.getNamespaceURI(this.current) !== NS.HTML) this.pop();
};

OpenElementStack.prototype.clearBackToTableBodyContext = function () {
  while (this.currentTagName !== $.TBODY && this.currentTagName !== $.TFOOT && this.currentTagName !== $.THEAD && this.currentTagName !== $.TEMPLATE && this.currentTagName !== $.HTML || this.treeAdapter.getNamespaceURI(this.current) !== NS.HTML) this.pop();
};

OpenElementStack.prototype.clearBackToTableRowContext = function () {
  while (this.currentTagName !== $.TR && this.currentTagName !== $.TEMPLATE && this.currentTagName !== $.HTML || this.treeAdapter.getNamespaceURI(this.current) !== NS.HTML) this.pop();
};

OpenElementStack.prototype.remove = function (element) {
  for (var i = this.stackTop; i >= 0; i--) {
    if (this.items[i] === element) {
      this.items.splice(i, 1);
      this.stackTop--;

      this._updateCurrentElement();

      break;
    }
  }
}; //Search


OpenElementStack.prototype.tryPeekProperlyNestedBodyElement = function () {
  //Properly nested <body> element (should be second element in stack).
  var element = this.items[1];
  return element && this.treeAdapter.getTagName(element) === $.BODY ? element : null;
};

OpenElementStack.prototype.contains = function (element) {
  return this._indexOf(element) > -1;
};

OpenElementStack.prototype.getCommonAncestor = function (element) {
  var elementIdx = this._indexOf(element);

  return --elementIdx >= 0 ? this.items[elementIdx] : null;
};

OpenElementStack.prototype.isRootHtmlElementCurrent = function () {
  return this.stackTop === 0 && this.currentTagName === $.HTML;
}; //Element in scope


OpenElementStack.prototype.hasInScope = function (tagName) {
  for (var i = this.stackTop; i >= 0; i--) {
    var tn = this.treeAdapter.getTagName(this.items[i]),
        ns = this.treeAdapter.getNamespaceURI(this.items[i]);
    if (tn === tagName && ns === NS.HTML) return true;
    if (isScopingElement(tn, ns)) return false;
  }

  return true;
};

OpenElementStack.prototype.hasNumberedHeaderInScope = function () {
  for (var i = this.stackTop; i >= 0; i--) {
    var tn = this.treeAdapter.getTagName(this.items[i]),
        ns = this.treeAdapter.getNamespaceURI(this.items[i]);
    if ((tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6) && ns === NS.HTML) return true;
    if (isScopingElement(tn, ns)) return false;
  }

  return true;
};

OpenElementStack.prototype.hasInListItemScope = function (tagName) {
  for (var i = this.stackTop; i >= 0; i--) {
    var tn = this.treeAdapter.getTagName(this.items[i]),
        ns = this.treeAdapter.getNamespaceURI(this.items[i]);
    if (tn === tagName && ns === NS.HTML) return true;
    if ((tn === $.UL || tn === $.OL) && ns === NS.HTML || isScopingElement(tn, ns)) return false;
  }

  return true;
};

OpenElementStack.prototype.hasInButtonScope = function (tagName) {
  for (var i = this.stackTop; i >= 0; i--) {
    var tn = this.treeAdapter.getTagName(this.items[i]),
        ns = this.treeAdapter.getNamespaceURI(this.items[i]);
    if (tn === tagName && ns === NS.HTML) return true;
    if (tn === $.BUTTON && ns === NS.HTML || isScopingElement(tn, ns)) return false;
  }

  return true;
};

OpenElementStack.prototype.hasInTableScope = function (tagName) {
  for (var i = this.stackTop; i >= 0; i--) {
    var tn = this.treeAdapter.getTagName(this.items[i]),
        ns = this.treeAdapter.getNamespaceURI(this.items[i]);
    if (ns !== NS.HTML) continue;
    if (tn === tagName) return true;
    if (tn === $.TABLE || tn === $.TEMPLATE || tn === $.HTML) return false;
  }

  return true;
};

OpenElementStack.prototype.hasTableBodyContextInTableScope = function () {
  for (var i = this.stackTop; i >= 0; i--) {
    var tn = this.treeAdapter.getTagName(this.items[i]),
        ns = this.treeAdapter.getNamespaceURI(this.items[i]);
    if (ns !== NS.HTML) continue;
    if (tn === $.TBODY || tn === $.THEAD || tn === $.TFOOT) return true;
    if (tn === $.TABLE || tn === $.HTML) return false;
  }

  return true;
};

OpenElementStack.prototype.hasInSelectScope = function (tagName) {
  for (var i = this.stackTop; i >= 0; i--) {
    var tn = this.treeAdapter.getTagName(this.items[i]),
        ns = this.treeAdapter.getNamespaceURI(this.items[i]);
    if (ns !== NS.HTML) continue;
    if (tn === tagName) return true;
    if (tn !== $.OPTION && tn !== $.OPTGROUP) return false;
  }

  return true;
}; //Implied end tags


OpenElementStack.prototype.generateImpliedEndTags = function () {
  while (isImpliedEndTagRequired(this.currentTagName)) this.pop();
};

OpenElementStack.prototype.generateImpliedEndTagsWithExclusion = function (exclusionTagName) {
  while (isImpliedEndTagRequired(this.currentTagName) && this.currentTagName !== exclusionTagName) this.pop();
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm9wZW5fZWxlbWVudF9zdGFjay5qcyJdLCJuYW1lcyI6WyJIVE1MIiwicmVxdWlyZSIsIiQiLCJUQUdfTkFNRVMiLCJOUyIsIk5BTUVTUEFDRVMiLCJpc0ltcGxpZWRFbmRUYWdSZXF1aXJlZCIsInRuIiwibGVuZ3RoIiwiUCIsIlJCIiwiUlAiLCJSVCIsIkREIiwiRFQiLCJMSSIsIlJUQyIsIk9QVElPTiIsIk9QVEdST1VQIiwiTUVOVUlURU0iLCJpc1Njb3BpbmdFbGVtZW50IiwibnMiLCJURCIsIlRIIiwiTUkiLCJNTyIsIk1OIiwiTVMiLCJNQVRITUwiLCJERVNDIiwiU1ZHIiwiVEFCTEUiLCJNVEVYVCIsIlRJVExFIiwiQVBQTEVUIiwiT0JKRUNUIiwiQ0FQVElPTiIsIk1BUlFVRUUiLCJURU1QTEFURSIsIkZPUkVJR05fT0JKRUNUIiwiQU5OT1RBVElPTl9YTUwiLCJPcGVuRWxlbWVudFN0YWNrIiwibW9kdWxlIiwiZXhwb3J0cyIsImRvY3VtZW50IiwidHJlZUFkYXB0ZXIiLCJzdGFja1RvcCIsIml0ZW1zIiwiY3VycmVudCIsImN1cnJlbnRUYWdOYW1lIiwiY3VycmVudFRtcGxDb250ZW50IiwidG1wbENvdW50IiwicHJvdG90eXBlIiwiX2luZGV4T2YiLCJlbGVtZW50IiwiaWR4IiwiaSIsIl9pc0luVGVtcGxhdGUiLCJnZXROYW1lc3BhY2VVUkkiLCJfdXBkYXRlQ3VycmVudEVsZW1lbnQiLCJnZXRUYWdOYW1lIiwiZ2V0VGVtcGxhdGVDb250ZW50IiwicHVzaCIsInBvcCIsInJlcGxhY2UiLCJvbGRFbGVtZW50IiwibmV3RWxlbWVudCIsImluc2VydEFmdGVyIiwicmVmZXJlbmNlRWxlbWVudCIsImluc2VydGlvbklkeCIsInNwbGljZSIsInBvcFVudGlsVGFnTmFtZVBvcHBlZCIsInRhZ05hbWUiLCJwb3BVbnRpbEVsZW1lbnRQb3BwZWQiLCJwb3BwZWRFbGVtZW50IiwicG9wVW50aWxOdW1iZXJlZEhlYWRlclBvcHBlZCIsIkgxIiwiSDIiLCJIMyIsIkg0IiwiSDUiLCJINiIsInBvcFVudGlsVGFibGVDZWxsUG9wcGVkIiwicG9wQWxsVXBUb0h0bWxFbGVtZW50IiwiY2xlYXJCYWNrVG9UYWJsZUNvbnRleHQiLCJjbGVhckJhY2tUb1RhYmxlQm9keUNvbnRleHQiLCJUQk9EWSIsIlRGT09UIiwiVEhFQUQiLCJjbGVhckJhY2tUb1RhYmxlUm93Q29udGV4dCIsIlRSIiwicmVtb3ZlIiwidHJ5UGVla1Byb3Blcmx5TmVzdGVkQm9keUVsZW1lbnQiLCJCT0RZIiwiY29udGFpbnMiLCJnZXRDb21tb25BbmNlc3RvciIsImVsZW1lbnRJZHgiLCJpc1Jvb3RIdG1sRWxlbWVudEN1cnJlbnQiLCJoYXNJblNjb3BlIiwiaGFzTnVtYmVyZWRIZWFkZXJJblNjb3BlIiwiaGFzSW5MaXN0SXRlbVNjb3BlIiwiVUwiLCJPTCIsImhhc0luQnV0dG9uU2NvcGUiLCJCVVRUT04iLCJoYXNJblRhYmxlU2NvcGUiLCJoYXNUYWJsZUJvZHlDb250ZXh0SW5UYWJsZVNjb3BlIiwiaGFzSW5TZWxlY3RTY29wZSIsImdlbmVyYXRlSW1wbGllZEVuZFRhZ3MiLCJnZW5lcmF0ZUltcGxpZWRFbmRUYWdzV2l0aEV4Y2x1c2lvbiIsImV4Y2x1c2lvblRhZ05hbWUiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBLElBQUlBLElBQUksR0FBR0MsT0FBTyxDQUFDLGdCQUFELENBQWxCLEMsQ0FFQTs7O0FBQ0EsSUFBSUMsQ0FBQyxHQUFHRixJQUFJLENBQUNHLFNBQWI7QUFBQSxJQUNJQyxFQUFFLEdBQUdKLElBQUksQ0FBQ0ssVUFEZCxDLENBR0E7QUFFQTtBQUNBOztBQUNBLFNBQVNDLHVCQUFULENBQWlDQyxFQUFqQyxFQUFxQztBQUNqQyxVQUFRQSxFQUFFLENBQUNDLE1BQVg7QUFDSSxTQUFLLENBQUw7QUFDSSxhQUFPRCxFQUFFLEtBQUtMLENBQUMsQ0FBQ08sQ0FBaEI7O0FBRUosU0FBSyxDQUFMO0FBQ0ksYUFBT0YsRUFBRSxLQUFLTCxDQUFDLENBQUNRLEVBQVQsSUFB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dmFyIEhUTUwgPSByZXF1aXJlKCcuLi9jb21tb24vaHRtbCcpO1xuXG4vL0FsaWFzZXNcbnZhciAkID0gSFRNTC5UQUdfTkFNRVMsXG4gICAgTlMgPSBIVE1MLk5BTUVTUEFDRVM7XG5cbi8vRWxlbWVudCB1dGlsc1xuXG4vL09QVElNSVpBVElPTjogSW50ZWdlciBjb21wYXJpc29ucyBhcmUgbG93LWNvc3QsIHNvIHdlIGNhbiB1c2UgdmVyeSBmYXN0IHRhZyBuYW1lIGxlbmd0aCBmaWx0ZXJzIGhlcmUuXG4vL0l0J3MgZmFzdGVyIHRoYW4gdXNpbmcgZGljdGlvbmFyeS5cbmZ1bmN0aW9uIGlzSW1wbGllZEVuZFRhZ1JlcXVpcmVkKHRuKSB7XG4gICAgc3dpdGNoICh0bi5sZW5ndGgpIHtcbiAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgcmV0dXJuIHRuID09PSAkLlA7XG5cbiAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgcmV0dXJuIHRuID09PSAkLlJCIHx8IHRuID09PSAkLlJQIHx8IHRuID09PSAkLlJUIHx8IHRuID09PSAkLkREIHx8IHRuID09PSAkLkRUIHx8IHRuID09PSAkLkxJO1xuXG4gICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgIHJldHVybiB0biA9PT0gJC5SVEM7XG5cbiAgICAgICAgY2FzZSA2OlxuICAgICAgICAgICAgcmV0dXJuIHRuID09PSAkLk9QVElPTjtcblxuICAgICAgICBjYXNlIDg6XG4gICAgICAgICAgICByZXR1cm4gdG4gPT09ICQuT1BUR1JPVVAgfHwgdG4gPT09ICQuTUVOVUlURU07XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xufVxuXG5mdW5jdGlvbiBpc1Njb3BpbmdFbGVtZW50KHRuLCBucykge1xuICAgIHN3aXRjaCAodG4ubGVuZ3RoKSB7XG4gICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgIGlmICh0biA9PT0gJC5URCB8fCB0biA9PT0gJC5USClcbiAgICAgICAgICAgICAgICByZXR1cm4gbnMgPT09IE5TLkhUTUw7XG5cbiAgICAgICAgICAgIGVsc2UgaWYgKHRuID09PSAkLk1JIHx8IHRuID09PSAkLk1PIHx8IHRuID09PSAkLk1OIHx8IHRuID09PSAkLk1TKVxuICAgICAgICAgICAgICAgIHJldHVybiBucyA9PT0gTlMuTUFUSE1MO1xuXG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICBpZiAodG4gPT09ICQuSFRNTClcbiAgICAgICAgICAgICAgICByZXR1cm4gbnMgPT09IE5TLkhUTUw7XG5cbiAgICAgICAgICAgIGVsc2UgaWYgKHRuID09PSAkLkRFU0MpXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5zID09PSBOUy5TVkc7XG5cbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgIGlmICh0biA9PT0gJC5UQUJMRSlcbiAgICAgICAgICAgICAgICByZXR1cm4gbnMgPT09IE5TLkhUTUw7XG5cbiAgICAgICAgICAgIGVsc2UgaWYgKHRuID09PSAkLk1URVhUKVxuICAgICAgICAgICAgICAgIHJldHVybiBucyA9PT0gTlMuTUFUSE1MO1xuXG4gICAgICAgICAgICBlbHNlIGlmICh0biA9PT0gJC5USVRMRSlcbiAgICAgICAgICAgICAgICByZXR1cm4gbnMgPT09IE5TLlNWRztcblxuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSA2OlxuICAgICAgICAgICAgcmV0dXJuICh0biA9PT0gJC5BUFBMRVQgfHwgdG4gPT09ICQuT0JKRUNUKSAmJiBucyA9PT0gTlMuSFRNTDtcblxuICAgICAgICBjYXNlIDc6XG4gICAgICAgICAgICByZXR1cm4gKHRuID09PSAkLkNBUFRJT04gfHwgdG4gPT09ICQuTUFSUVVFRSkgJiYgbnMgPT09IE5TLkhUTUw7XG5cbiAgICAgICAgY2FzZSA4OlxuICAgICAgICAgICAgcmV0dXJuIHRuID09PSAkLlRFTVBMQVRFICYmIG5zID09PSBOUy5IVE1MO1xuXG4gICAgICAgIGNhc2UgMTM6XG4gICAgICAgICAgICByZXR1cm4gdG4gPT09ICQuRk9SRUlHTl9PQkpFQ1QgJiYgbnMgPT09IE5TLlNWRztcblxuICAgICAgICBjYXNlIDE0OlxuICAgICAgICAgICAgcmV0dXJuIHRuID09PSAkLkFOTk9UQVRJT05fWE1MICYmIG5zID09PSBOUy5NQVRITUw7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xufVxuXG4vL1N0YWNrIG9mIG9wZW4gZWxlbWVudHNcbnZhciBPcGVuRWxlbWVudFN0YWNrID0gbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoZG9jdW1lbnQsIHRyZWVBZGFwdGVyKSB7XG4gICAgdGhpcy5zdGFja1RvcCA9IC0xO1xuICAgIHRoaXMuaXRlbXMgPSBbXTtcbiAgICB0aGlzLmN1cnJlbnQgPSBkb2N1bWVudDtcbiAgICB0aGlzLmN1cnJlbnRUYWdOYW1lID0gbnVsbDtcbiAgICB0aGlzLmN1cnJlbnRUbXBsQ29udGVudCA9IG51bGw7XG4gICAgdGhpcy50bXBsQ291bnQgPSAwO1xuICAgIHRoaXMudHJlZUFkYXB0ZXIgPSB0cmVlQWRhcHRlcjtcbn07XG5cbi8vSW5kZXggb2YgZWxlbWVudFxuT3BlbkVsZW1lbnRTdGFjay5wcm90b3R5cGUuX2luZGV4T2YgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgIHZhciBpZHggPSAtMTtcblxuICAgIGZvciAodmFyIGkgPSB0aGlzLnN0YWNrVG9wOyBpID49IDA7IGktLSkge1xuICAgICAgICBpZiAodGhpcy5pdGVtc1tpXSA9PT0gZWxlbWVudCkge1xuICAgICAgICAgICAgaWR4ID0gaTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBpZHg7XG59O1xuXG4vL1VwZGF0ZSBjdXJyZW50IGVsZW1lbnRcbk9wZW5FbGVtZW50U3RhY2sucHJvdG90eXBlLl9pc0luVGVtcGxhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuY3VycmVudFRhZ05hbWUgPT09ICQuVEVNUExBVEUgJiYgdGhpcy50cmVlQWRhcHRlci5nZXROYW1lc3BhY2VVUkkodGhpcy5jdXJyZW50KSA9PT0gTlMuSFRNTDtcbn07XG5cbk9wZW5FbGVtZW50U3RhY2sucHJvdG90eXBlLl91cGRhdGVDdXJyZW50RWxlbWVudCA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmN1cnJlbnQgPSB0aGlzLml0ZW1zW3RoaXMuc3RhY2tUb3BdO1xuICAgIHRoaXMuY3VycmVudFRhZ05hbWUgPSB0aGlzLmN1cnJlbnQgJiYgdGhpcy50cmVlQWRhcHRlci5nZXRUYWdOYW1lKHRoaXMuY3VycmVudCk7XG5cbiAgICB0aGlzLmN1cnJlbnRUbXBsQ29udGVudCA9IHRoaXMuX2lzSW5UZW1wbGF0ZSgpID8gdGhpcy50cmVlQWRhcHRlci5nZXRUZW1wbGF0ZUNvbnRlbnQodGhpcy5jdXJyZW50KSA6IG51bGw7XG59O1xuXG4vL011dGF0aW9uc1xuT3BlbkVsZW1lbnRTdGFjay5wcm90b3R5cGUucHVzaCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgdGhpcy5pdGVtc1srK3RoaXMuc3RhY2tUb3BdID0gZWxlbWVudDtcbiAgICB0aGlzLl91cGRhdGVDdXJyZW50RWxlbWVudCgpO1xuXG4gICAgaWYgKHRoaXMuX2lzSW5UZW1wbGF0ZSgpKVxuICAgICAgICB0aGlzLnRtcGxDb3VudCsrO1xuXG59O1xuXG5PcGVuRWxlbWVudFN0YWNrLnByb3RvdHlwZS5wb3AgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5zdGFja1RvcC0tO1xuXG4gICAgaWYgKHRoaXMudG1wbENvdW50ID4gMCAmJiB0aGlzLl9pc0luVGVtcGxhdGUoKSlcbiAgICAgICAgdGhpcy50bXBsQ291bnQtLTtcblxuICAgIHRoaXMuX3VwZGF0ZUN1cnJlbnRFbGVtZW50KCk7XG59O1xuXG5PcGVuRWxlbWVudFN0YWNrLnByb3RvdHlwZS5yZXBsYWNlID0gZnVuY3Rpb24gKG9sZEVsZW1lbnQsIG5ld0VsZW1lbnQpIHtcbiAgICB2YXIgaWR4ID0gdGhpcy5faW5kZXhPZihvbGRFbGVtZW50KTtcblxuICAgIHRoaXMuaXRlbXNbaWR4XSA9IG5ld0VsZW1lbnQ7XG5cbiAgICBpZiAoaWR4ID09PSB0aGlzLnN0YWNrVG9wKVxuICAgICAgICB0aGlzLl91cGRhdGVDdXJyZW50RWxlbWVudCgpO1xufTtcblxuT3BlbkVsZW1lbnRTdGFjay5wcm90b3R5cGUuaW5zZXJ0QWZ0ZXIgPSBmdW5jdGlvbiAocmVmZXJlbmNlRWxlbWVudCwgbmV3RWxlbWVudCkge1xuICAgIHZhciBpbnNlcnRpb25JZHggPSB0aGlzLl9pbmRleE9mKHJlZmVyZW5jZUVsZW1lbnQpICsgMTtcblxuICAgIHRoaXMuaXRlbXMuc3BsaWNlKGluc2VydGlvbklkeCwgMCwgbmV3RWxlbWVudCk7XG5cbiAgICBpZiAoaW5zZXJ0aW9uSWR4ID09PSArK3RoaXMuc3RhY2tUb3ApXG4gICAgICAgIHRoaXMuX3VwZGF0ZUN1cnJlbnRFbGVtZW50KCk7XG59O1xuXG5PcGVuRWxlbWVudFN0YWNrLnByb3RvdHlwZS5wb3BVbnRpbFRhZ05hbWVQb3BwZWQgPSBmdW5jdGlvbiAodGFnTmFtZSkge1xuICAgIHdoaWxlICh0aGlzLnN0YWNrVG9wID4gLTEpIHtcbiAgICAgICAgdmFyIHRuID0gdGhpcy5jdXJyZW50VGFnTmFtZSxcbiAgICAgICAgICAgIG5zID0gdGhpcy50cmVlQWRhcHRlci5nZXROYW1lc3BhY2VVUkkodGhpcy5jdXJyZW50KTtcblxuICAgICAgICB0aGlzLnBvcCgpO1xuXG4gICAgICAgIGlmICh0biA9PT0gdGFnTmFtZSAmJiBucyA9PT0gTlMuSFRNTClcbiAgICAgICAgICAgIGJyZWFrO1xuICAgIH1cbn07XG5cbk9wZW5FbGVtZW50U3RhY2sucHJvdG90eXBlLnBvcFVudGlsRWxlbWVudFBvcHBlZCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgd2hpbGUgKHRoaXMuc3RhY2tUb3AgPiAtMSkge1xuICAgICAgICB2YXIgcG9wcGVkRWxlbWVudCA9IHRoaXMuY3VycmVudDtcblxuICAgICAgICB0aGlzLnBvcCgpO1xuXG4gICAgICAgIGlmIChwb3BwZWRFbGVtZW50ID09PSBlbGVtZW50KVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgfVxufTtcblxuT3BlbkVsZW1lbnRTdGFjay5wcm90b3R5cGUucG9wVW50aWxOdW1iZXJlZEhlYWRlclBvcHBlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICB3aGlsZSAodGhpcy5zdGFja1RvcCA+IC0xKSB7XG4gICAgICAgIHZhciB0biA9IHRoaXMuY3VycmVudFRhZ05hbWUsXG4gICAgICAgICAgICBucyA9IHRoaXMudHJlZUFkYXB0ZXIuZ2V0TmFtZXNwYWNlVVJJKHRoaXMuY3VycmVudCk7XG5cbiAgICAgICAgdGhpcy5wb3AoKTtcblxuICAgICAgICBpZiAodG4gPT09ICQuSDEgfHwgdG4gPT09ICQuSDIgfHwgdG4gPT09ICQuSDMgfHwgdG4gPT09ICQuSDQgfHwgdG4gPT09ICQuSDUgfHwgdG4gPT09ICQuSDYgJiYgbnMgPT09IE5TLkhUTUwpXG4gICAgICAgICAgICBicmVhaztcbiAgICB9XG59O1xuXG5PcGVuRWxlbWVudFN0YWNrLnByb3RvdHlwZS5wb3BVbnRpbFRhYmxlQ2VsbFBvcHBlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICB3aGlsZSAodGhpcy5zdGFja1RvcCA+IC0xKSB7XG4gICAgICAgIHZhciB0biA9IHRoaXMuY3VycmVudFRhZ05hbWUsXG4gICAgICAgICAgICBucyA9IHRoaXMudHJlZUFkYXB0ZXIuZ2V0TmFtZXNwYWNlVVJJKHRoaXMuY3VycmVudCk7XG5cbiAgICAgICAgdGhpcy5wb3AoKTtcblxuICAgICAgICBpZiAodG4gPT09ICQuVEQgfHwgdG4gPT09ICQuVEggJiYgbnMgPT09IE5TLkhUTUwpXG4gICAgICAgICAgICBicmVhaztcbiAgICB9XG59O1xuXG5PcGVuRWxlbWVudFN0YWNrLnByb3RvdHlwZS5wb3BBbGxVcFRvSHRtbEVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgLy9OT1RFOiBoZXJlIHdlIGFzc3VtZSB0aGF0IHJvb3QgPGh0bWw+IGVsZW1lbnQgaXMgYWx3YXlzIGZpcnN0IGluIHRoZSBvcGVuIGVsZW1lbnQgc3RhY2ssIHNvXG4gICAgLy93ZSBwZXJmb3JtIHRoaXMgZmFzdCBzdGFjayBjbGVhbiB1cC5cbiAgICB0aGlzLnN0YWNrVG9wID0gMDtcbiAgICB0aGlzLl91cGRhdGVDdXJyZW50RWxlbWVudCgpO1xufTtcblxuT3BlbkVsZW1lbnRTdGFjay5wcm90b3R5cGUuY2xlYXJCYWNrVG9UYWJsZUNvbnRleHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgd2hpbGUgKHRoaXMuY3VycmVudFRhZ05hbWUgIT09ICQuVEFCTEUgJiZcbiAgICAgICAgICAgdGhpcy5jdXJyZW50VGFnTmFtZSAhPT0gJC5URU1QTEFURSAmJlxuICAgICAgICAgICB0aGlzLmN1cnJlbnRUYWdOYW1lICE9PSAkLkhUTUwgfHxcbiAgICAgICAgICAgdGhpcy50cmVlQWRhcHRlci5nZXROYW1lc3BhY2VVUkkodGhpcy5jdXJyZW50KSAhPT0gTlMuSFRNTClcbiAgICAgICAgdGhpcy5wb3AoKTtcbn07XG5cbk9wZW5FbGVtZW50U3RhY2sucHJvdG90eXBlLmNsZWFyQmFja1RvVGFibGVCb2R5Q29udGV4dCA9IGZ1bmN0aW9uICgpIHtcbiAgICB3aGlsZSAodGhpcy5jdXJyZW50VGFnTmFtZSAhPT0gJC5UQk9EWSAmJlxuICAgICAgICAgICB0aGlzLmN1cnJlbnRUYWdOYW1lICE9PSAkLlRGT09UICYmXG4gICAgICAgICAgIHRoaXMuY3VycmVudFRhZ05hbWUgIT09ICQuVEhFQUQgJiZcbiAgICAgICAgICAgdGhpcy5jdXJyZW50VGFnTmFtZSAhPT0gJC5URU1QTEFURSAmJlxuICAgICAgICAgICB0aGlzLmN1cnJlbnRUYWdOYW1lICE9PSAkLkhUTUwgfHxcbiAgICAgICAgICAgdGhpcy50cmVlQWRhcHRlci5nZXROYW1lc3BhY2VVUkkodGhpcy5jdXJyZW50KSAhPT0gTlMuSFRNTClcbiAgICAgICAgdGhpcy5wb3AoKTtcbn07XG5cbk9wZW5FbGVtZW50U3RhY2sucHJvdG90eXBlLmNsZWFyQmFja1RvVGFibGVSb3dDb250ZXh0ID0gZnVuY3Rpb24gKCkge1xuICAgIHdoaWxlICh0aGlzLmN1cnJlbnRUYWdOYW1lICE9PSAkLlRSICYmXG4gICAgICAgICAgIHRoaXMuY3VycmVudFRhZ05hbWUgIT09ICQuVEVNUExBVEUgJiZcbiAgICAgICAgICAgdGhpcy5jdXJyZW50VGFnTmFtZSAhPT0gJC5IVE1MIHx8XG4gICAgICAgICAgIHRoaXMudHJlZUFkYXB0ZXIuZ2V0TmFtZXNwYWNlVVJJKHRoaXMuY3VycmVudCkgIT09IE5TLkhUTUwpXG4gICAgICAgIHRoaXMucG9wKCk7XG59O1xuXG5PcGVuRWxlbWVudFN0YWNrLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgIGZvciAodmFyIGkgPSB0aGlzLnN0YWNrVG9wOyBpID49IDA7IGktLSkge1xuICAgICAgICBpZiAodGhpcy5pdGVtc1tpXSA9PT0gZWxlbWVudCkge1xuICAgICAgICAgICAgdGhpcy5pdGVtcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICB0aGlzLnN0YWNrVG9wLS07XG4gICAgICAgICAgICB0aGlzLl91cGRhdGVDdXJyZW50RWxlbWVudCgpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG4vL1NlYXJjaFxuT3BlbkVsZW1lbnRTdGFjay5wcm90b3R5cGUudHJ5UGVla1Byb3Blcmx5TmVzdGVkQm9keUVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgLy9Qcm9wZXJseSBuZXN0ZWQgPGJvZHk+IGVsZW1lbnQgKHNob3VsZCBiZSBzZWNvbmQgZWxlbWVudCBpbiBzdGFjaykuXG4gICAgdmFyIGVsZW1lbnQgPSB0aGlzLml0ZW1zWzFdO1xuXG4gICAgcmV0dXJuIGVsZW1lbnQgJiYgdGhpcy50cmVlQWRhcHRlci5nZXRUYWdOYW1lKGVsZW1lbnQpID09PSAkLkJPRFkgPyBlbGVtZW50IDogbnVsbDtcbn07XG5cbk9wZW5FbGVtZW50U3RhY2sucHJvdG90eXBlLmNvbnRhaW5zID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICByZXR1cm4gdGhpcy5faW5kZXhPZihlbGVtZW50KSA+IC0xO1xufTtcblxuT3BlbkVsZW1lbnRTdGFjay5wcm90b3R5cGUuZ2V0Q29tbW9uQW5jZXN0b3IgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgIHZhciBlbGVtZW50SWR4ID0gdGhpcy5faW5kZXhPZihlbGVtZW50KTtcblxuICAgIHJldHVybiAtLWVsZW1lbnRJZHggPj0gMCA/IHRoaXMuaXRlbXNbZWxlbWVudElkeF0gOiBudWxsO1xufTtcblxuT3BlbkVsZW1lbnRTdGFjay5wcm90b3R5cGUuaXNSb290SHRtbEVsZW1lbnRDdXJyZW50ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLnN0YWNrVG9wID09PSAwICYmIHRoaXMuY3VycmVudFRhZ05hbWUgPT09ICQuSFRNTDtcbn07XG5cbi8vRWxlbWVudCBpbiBzY29wZVxuT3BlbkVsZW1lbnRTdGFjay5wcm90b3R5cGUuaGFzSW5TY29wZSA9IGZ1bmN0aW9uICh0YWdOYW1lKSB7XG4gICAgZm9yICh2YXIgaSA9IHRoaXMuc3RhY2tUb3A7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgIHZhciB0biA9IHRoaXMudHJlZUFkYXB0ZXIuZ2V0VGFnTmFtZSh0aGlzLml0ZW1zW2ldKSxcbiAgICAgICAgICAgIG5zID0gdGhpcy50cmVlQWRhcHRlci5nZXROYW1lc3BhY2VVUkkodGhpcy5pdGVtc1tpXSk7XG5cbiAgICAgICAgaWYgKHRuID09PSB0YWdOYW1lICYmIG5zID09PSBOUy5IVE1MKVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG5cbiAgICAgICAgaWYgKGlzU2NvcGluZ0VsZW1lbnQodG4sIG5zKSlcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbn07XG5cbk9wZW5FbGVtZW50U3RhY2sucHJvdG90eXBlLmhhc051bWJlcmVkSGVhZGVySW5TY29wZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBmb3IgKHZhciBpID0gdGhpcy5zdGFja1RvcDsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgdmFyIHRuID0gdGhpcy50cmVlQWRhcHRlci5nZXRUYWdOYW1lKHRoaXMuaXRlbXNbaV0pLFxuICAgICAgICAgICAgbnMgPSB0aGlzLnRyZWVBZGFwdGVyLmdldE5hbWVzcGFjZVVSSSh0aGlzLml0ZW1zW2ldKTtcblxuICAgICAgICBpZiAoKHRuID09PSAkLkgxIHx8IHRuID09PSAkLkgyIHx8IHRuID09PSAkLkgzIHx8IHRuID09PSAkLkg0IHx8IHRuID09PSAkLkg1IHx8IHRuID09PSAkLkg2KSAmJiBucyA9PT0gTlMuSFRNTClcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuXG4gICAgICAgIGlmIChpc1Njb3BpbmdFbGVtZW50KHRuLCBucykpXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG59O1xuXG5PcGVuRWxlbWVudFN0YWNrLnByb3RvdHlwZS5oYXNJbkxpc3RJdGVtU2NvcGUgPSBmdW5jdGlvbiAodGFnTmFtZSkge1xuICAgIGZvciAodmFyIGkgPSB0aGlzLnN0YWNrVG9wOyBpID49IDA7IGktLSkge1xuICAgICAgICB2YXIgdG4gPSB0aGlzLnRyZWVBZGFwdGVyLmdldFRhZ05hbWUodGhpcy5pdGVtc1tpXSksXG4gICAgICAgICAgICBucyA9IHRoaXMudHJlZUFkYXB0ZXIuZ2V0TmFtZXNwYWNlVVJJKHRoaXMuaXRlbXNbaV0pO1xuXG4gICAgICAgIGlmICh0biA9PT0gdGFnTmFtZSAmJiBucyA9PT0gTlMuSFRNTClcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuXG4gICAgICAgIGlmICgodG4gPT09ICQuVUwgfHwgdG4gPT09ICQuT0wpICYmIG5zID09PSBOUy5IVE1MIHx8IGlzU2NvcGluZ0VsZW1lbnQodG4sIG5zKSlcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbn07XG5cbk9wZW5FbGVtZW50U3RhY2sucHJvdG90eXBlLmhhc0luQnV0dG9uU2NvcGUgPSBmdW5jdGlvbiAodGFnTmFtZSkge1xuICAgIGZvciAodmFyIGkgPSB0aGlzLnN0YWNrVG9wOyBpID49IDA7IGktLSkge1xuICAgICAgICB2YXIgdG4gPSB0aGlzLnRyZWVBZGFwdGVyLmdldFRhZ05hbWUodGhpcy5pdGVtc1tpXSksXG4gICAgICAgICAgICBucyA9IHRoaXMudHJlZUFkYXB0ZXIuZ2V0TmFtZXNwYWNlVVJJKHRoaXMuaXRlbXNbaV0pO1xuXG4gICAgICAgIGlmICh0biA9PT0gdGFnTmFtZSAmJiBucyA9PT0gTlMuSFRNTClcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuXG4gICAgICAgIGlmICh0biA9PT0gJC5CVVRUT04gJiYgbnMgPT09IE5TLkhUTUwgfHwgaXNTY29waW5nRWxlbWVudCh0biwgbnMpKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xufTtcblxuT3BlbkVsZW1lbnRTdGFjay5wcm90b3R5cGUuaGFzSW5UYWJsZVNjb3BlID0gZnVuY3Rpb24gKHRhZ05hbWUpIHtcbiAgICBmb3IgKHZhciBpID0gdGhpcy5zdGFja1RvcDsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgdmFyIHRuID0gdGhpcy50cmVlQWRhcHRlci5nZXRUYWdOYW1lKHRoaXMuaXRlbXNbaV0pLFxuICAgICAgICAgICAgbnMgPSB0aGlzLnRyZWVBZGFwdGVyLmdldE5hbWVzcGFjZVVSSSh0aGlzLml0ZW1zW2ldKTtcblxuICAgICAgICBpZiAobnMgIT09IE5TLkhUTUwpXG4gICAgICAgICAgICBjb250aW51ZTtcblxuICAgICAgICBpZiAodG4gPT09IHRhZ05hbWUpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcblxuICAgICAgICBpZiAodG4gPT09ICQuVEFCTEUgfHwgdG4gPT09ICQuVEVNUExBVEUgfHwgdG4gPT09ICQuSFRNTClcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbn07XG5cbk9wZW5FbGVtZW50U3RhY2sucHJvdG90eXBlLmhhc1RhYmxlQm9keUNvbnRleHRJblRhYmxlU2NvcGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgZm9yICh2YXIgaSA9IHRoaXMuc3RhY2tUb3A7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgIHZhciB0biA9IHRoaXMudHJlZUFkYXB0ZXIuZ2V0VGFnTmFtZSh0aGlzLml0ZW1zW2ldKSxcbiAgICAgICAgICAgIG5zID0gdGhpcy50cmVlQWRhcHRlci5nZXROYW1lc3BhY2VVUkkodGhpcy5pdGVtc1tpXSk7XG5cbiAgICAgICAgaWYgKG5zICE9PSBOUy5IVE1MKVxuICAgICAgICAgICAgY29udGludWU7XG5cbiAgICAgICAgaWYgKHRuID09PSAkLlRCT0RZIHx8IHRuID09PSAkLlRIRUFEIHx8IHRuID09PSAkLlRGT09UKVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG5cbiAgICAgICAgaWYgKHRuID09PSAkLlRBQkxFIHx8IHRuID09PSAkLkhUTUwpXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG59O1xuXG5PcGVuRWxlbWVudFN0YWNrLnByb3RvdHlwZS5oYXNJblNlbGVjdFNjb3BlID0gZnVuY3Rpb24gKHRhZ05hbWUpIHtcbiAgICBmb3IgKHZhciBpID0gdGhpcy5zdGFja1RvcDsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgdmFyIHRuID0gdGhpcy50cmVlQWRhcHRlci5nZXRUYWdOYW1lKHRoaXMuaXRlbXNbaV0pLFxuICAgICAgICAgICAgbnMgPSB0aGlzLnRyZWVBZGFwdGVyLmdldE5hbWVzcGFjZVVSSSh0aGlzLml0ZW1zW2ldKTtcblxuICAgICAgICBpZiAobnMgIT09IE5TLkhUTUwpXG4gICAgICAgICAgICBjb250aW51ZTtcblxuICAgICAgICBpZiAodG4gPT09IHRhZ05hbWUpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcblxuICAgICAgICBpZiAodG4gIT09ICQuT1BUSU9OICYmIHRuICE9PSAkLk9QVEdST1VQKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xufTtcblxuLy9JbXBsaWVkIGVuZCB0YWdzXG5PcGVuRWxlbWVudFN0YWNrLnByb3RvdHlwZS5nZW5lcmF0ZUltcGxpZWRFbmRUYWdzID0gZnVuY3Rpb24gKCkge1xuICAgIHdoaWxlIChpc0ltcGxpZWRFbmRUYWdSZXF1aXJlZCh0aGlzLmN1cnJlbnRUYWdOYW1lKSlcbiAgICAgICAgdGhpcy5wb3AoKTtcbn07XG5cbk9wZW5FbGVtZW50U3RhY2sucHJvdG90eXBlLmdlbmVyYXRlSW1wbGllZEVuZFRhZ3NXaXRoRXhjbHVzaW9uID0gZnVuY3Rpb24gKGV4Y2x1c2lvblRhZ05hbWUpIHtcbiAgICB3aGlsZSAoaXNJbXBsaWVkRW5kVGFnUmVxdWlyZWQodGhpcy5jdXJyZW50VGFnTmFtZSkgJiYgdGhpcy5jdXJyZW50VGFnTmFtZSAhPT0gZXhjbHVzaW9uVGFnTmFtZSlcbiAgICAgICAgdGhpcy5wb3AoKTtcbn07XG4iXX0=