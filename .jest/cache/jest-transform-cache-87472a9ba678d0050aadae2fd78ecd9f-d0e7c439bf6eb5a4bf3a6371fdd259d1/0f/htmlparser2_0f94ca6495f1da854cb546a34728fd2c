303ab54171eb98ae734bce2c46ddee46
'use strict';

var doctype = require('../common/doctype'),
    DOCUMENT_MODE = require('../common/html').DOCUMENT_MODE; //Conversion tables for DOM Level1 structure emulation


var nodeTypes = {
  element: 1,
  text: 3,
  cdata: 4,
  comment: 8
};
var nodePropertyShorthands = {
  tagName: 'name',
  childNodes: 'children',
  parentNode: 'parent',
  previousSibling: 'prev',
  nextSibling: 'next',
  nodeValue: 'data'
}; //Node

var Node = function (props) {
  for (var key in props) {
    if (props.hasOwnProperty(key)) this[key] = props[key];
  }
};

Node.prototype = {
  get firstChild() {
    var children = this.children;
    return children && children[0] || null;
  },

  get lastChild() {
    var children = this.children;
    return children && children[children.length - 1] || null;
  },

  get nodeType() {
    return nodeTypes[this.type] || nodeTypes.element;
  }

};
Object.keys(nodePropertyShorthands).forEach(function (key) {
  var shorthand = nodePropertyShorthands[key];
  Object.defineProperty(Node.prototype, key, {
    get: function () {
      return this[shorthand] || null;
    },
    set: function (val) {
      this[shorthand] = val;
      return val;
    }
  });
}); //Node construction

exports.createDocument = function () {
  return new Node({
    type: 'root',
    name: 'root',
    parent: null,
    prev: null,
    next: null,
    children: [],
    'x-mode': DOCUMENT_MODE.NO_QUIRKS
  });
};

exports.createDocumentFragment = function () {
  return new Node({
    type: 'root',
    name: 'root',
    parent: null,
    prev: null,
    next: null,
    children: []
  });
};

exports.createElement = function (tagName, namespaceURI, attrs) {
  var attribs = Object.create(null),
      attribsNamespace = Object.create(null),
      attribsPrefix = Object.create(null);

  for (var i = 0; i < attrs.length; i++) {
    var attrName = attrs[i].name;
    attribs[attrName] = attrs[i].value;
    attribsNamespace[attrName] = attrs[i].namespace;
    attribsPrefix[attrName] = attrs[i].prefix;
  }

  return new Node({
    type: tagName === 'script' || tagName === 'style' ? tagName : 'tag',
    name: tagName,
    namespace: namespaceURI,
    attribs: attribs,
    'x-attribsNamespace': attribsNamespace,
    'x-attribsPrefix': attribsPrefix,
    children: [],
    parent: null,
    prev: null,
    next: null
  });
};

exports.createCommentNode = function (data) {
  return new Node({
    type: 'comment',
    data: data,
    parent: null,
    prev: null,
    next: null
  });
};

var createTextNode = function (value) {
  return new Node({
    type: 'text',
    data: value,
    parent: null,
    prev: null,
    next: null
  });
}; //Tree mutation


var appendChild = exports.appendChild = function (parentNode, newNode) {
  var prev = parentNode.children[parentNode.children.length - 1];

  if (prev) {
    prev.next = newNode;
    newNode.prev = prev;
  }

  parentNode.children.push(newNode);
  newNode.parent = parentNode;
};

var insertBefore = exports.insertBefore = function (parentNode, newNode, referenceNode) {
  var insertionIdx = parentNode.children.indexOf(referenceNode),
      prev = referenceNode.prev;

  if (prev) {
    prev.next = newNode;
    newNode.prev = prev;
  }

  referenceNode.prev = newNode;
  newNode.next = referenceNode;
  parentNode.children.splice(insertionIdx, 0, newNode);
  newNode.parent = parentNode;
};

exports.setTemplateContent = function (templateElement, contentElement) {
  appendChild(templateElement, contentElement);
};

exports.getTemplateContent = function (templateElement) {
  return templateElement.children[0];
};

exports.setDocumentType = function (document, name, publicId, systemId) {
  var data = doctype.serializeContent(name, publicId, systemId),
      doctypeNode = null;

  for (var i = 0; i < document.children.length; i++) {
    if (document.children[i].type === 'directive' && document.children[i].name === '!doctype') {
      doctypeNode = document.children[i];
      break;
    }
  }

  if (doctypeNode) {
    doctypeNode.data = data;
    doctypeNode['x-name'] = name;
    doctypeNode['x-publicId'] = publicId;
    doctypeNode['x-systemId'] = systemId;
  } else {
    appendChild(document, new Node({
      type: 'directive',
      name: '!doctype',
      data: data,
      'x-name': name,
      'x-publicId': publicId,
      'x-systemId': systemId
    }));
  }
};

exports.setDocumentMode = function (document, mode) {
  document['x-mode'] = mode;
};

exports.getDocumentMode = function (document) {
  return document['x-mode'];
};

exports.detachNode = function (node) {
  if (node.parent) {
    var idx = node.parent.children.indexOf(node),
        prev = node.prev,
        next = node.next;
    node.prev = null;
    node.next = null;
    if (prev) prev.next = next;
    if (next) next.prev = prev;
    node.parent.children.splice(idx, 1);
    node.parent = null;
  }
};

exports.insertText = function (parentNode, text) {
  var lastChild = parentNode.children[parentNode.children.length - 1];
  if (lastChild && lastChild.type === 'text') lastChild.data += text;else appendChild(parentNode, createTextNode(text));
};

exports.insertTextBefore = function (parentNode, text, referenceNode) {
  var prevNode = parentNode.children[parentNode.children.indexOf(referenceNode) - 1];
  if (prevNode && prevNode.type === 'text') prevNode.data += text;else insertBefore(parentNode, createTextNode(text), referenceNode);
};

exports.adoptAttributes = function (recipient, attrs) {
  for (var i = 0; i < attrs.length; i++) {
    var attrName = attrs[i].name;

    if (typeof recipient.attribs[attrName] === 'undefined') {
      recipient.attribs[attrName] = attrs[i].value;
      recipient['x-attribsNamespace'][attrName] = attrs[i].namespace;
      recipient['x-attribsPrefix'][attrName] = attrs[i].prefix;
    }
  }
}; //Tree traversing


exports.getFirstChild = function (node) {
  return node.children[0];
};

exports.getChildNodes = function (node) {
  return node.children;
};

exports.getParentNode = function (node) {
  return node.parent;
};

exports.getAttrList = function (element) {
  var attrList = [];

  for (var name in element.attribs) {
    attrList.push({
      name: name,
      value: element.attribs[name],
      namespace: element['x-attribsNamespace'][name],
      prefix: element['x-attribsPrefix'][name]
    });
  }

  return attrList;
}; //Node data


exports.getTagName = function (element) {
  return element.name;
};

exports.getNamespaceURI = function (element) {
  return element.namespace;
};

exports.getTextNodeContent = function (textNode) {
  return textNode.data;
};

exports.getCommentNodeContent = function (commentNode) {
  return commentNode.data;
};

exports.getDocumentTypeNodeName = function (doctypeNode) {
  return doctypeNode['x-name'];
};

exports.getDocumentTypeNodePublicId = function (doctypeNode) {
  return doctypeNode['x-publicId'];
};

exports.getDocumentTypeNodeSystemId = function (doctypeNode) {
  return doctypeNode['x-systemId'];
}; //Node types


exports.isTextNode = function (node) {
  return node.type === 'text';
};

exports.isCommentNode = function (node) {
  return node.type === 'comment';
};

exports.isDocumentTypeNode = function (node) {
  return node.type === 'directive' && node.name === '!doctype';
};

exports.isElementNode = function (node) {
  return !!node.attribs;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0bWxwYXJzZXIyLmpzIl0sIm5hbWVzIjpbImRvY3R5cGUiLCJyZXF1aXJlIiwiRE9DVU1FTlRfTU9ERSIsIm5vZGVUeXBlcyIsImVsZW1lbnQiLCJ0ZXh0IiwiY2RhdGEiLCJjb21tZW50Iiwibm9kZVByb3BlcnR5U2hvcnRoYW5kcyIsInRhZ05hbWUiLCJjaGlsZE5vZGVzIiwicGFyZW50Tm9kZSIsInByZXZpb3VzU2libGluZyIsIm5leHRTaWJsaW5nIiwibm9kZVZhbHVlIiwiTm9kZSIsInByb3BzIiwia2V5IiwiaGFzT3duUHJvcGVydHkiLCJwcm90b3R5cGUiLCJmaXJzdENoaWxkIiwiY2hpbGRyZW4iLCJsYXN0Q2hpbGQiLCJsZW5ndGgiLCJub2RlVHlwZSIsInR5cGUiLCJPYmplY3QiLCJrZXlzIiwiZm9yRWFjaCIsInNob3J0aGFuZCIsImRlZmluZVByb3BlcnR5IiwiZ2V0Iiwic2V0IiwidmFsIiwiZXhwb3J0cyIsImNyZWF0ZURvY3VtZW50IiwibmFtZSIsInBhcmVudCIsInByZXYiLCJuZXh0IiwiTk9fUVVJUktTIiwiY3JlYXRlRG9jdW1lbnRGcmFnbWVudCIsImNyZWF0ZUVsZW1lbnQiLCJuYW1lc3BhY2VVUkkiLCJhdHRycyIsImF0dHJpYnMiLCJjcmVhdGUiLCJhdHRyaWJzTmFtZXNwYWNlIiwiYXR0cmlic1ByZWZpeCIsImkiLCJhdHRyTmFtZSIsInZhbHVlIiwibmFtZXNwYWNlIiwicHJlZml4IiwiY3JlYXRlQ29tbWVudE5vZGUiLCJkYXRhIiwiY3JlYXRlVGV4dE5vZGUiLCJhcHBlbmRDaGlsZCIsIm5ld05vZGUiLCJwdXNoIiwiaW5zZXJ0QmVmb3JlIiwicmVmZXJlbmNlTm9kZSIsImluc2VydGlvbklkeCIsImluZGV4T2YiLCJzcGxpY2UiLCJzZXRUZW1wbGF0ZUNvbnRlbnQiLCJ0ZW1wbGF0ZUVsZW1lbnQiLCJjb250ZW50RWxlbWVudCIsImdldFRlbXBsYXRlQ29udGVudCIsInNldERvY3VtZW50VHlwZSIsImRvY3VtZW50IiwicHVibGljSWQiLCJzeXN0ZW1JZCIsInNlcmlhbGl6ZUNvbnRlbnQiLCJkb2N0eXBlTm9kZSIsInNldERvY3VtZW50TW9kZSIsIm1vZGUiLCJnZXREb2N1bWVudE1vZGUiLCJkZXRhY2hOb2RlIiwibm9kZSIsImlkeCIsImluc2VydFRleHQiLCJpbnNlcnRUZXh0QmVmb3JlIiwicHJldk5vZGUiLCJhZG9wdEF0dHJpYnV0ZXMiLCJyZWNpcGllbnQiLCJnZXRGaXJzdENoaWxkIiwiZ2V0Q2hpbGROb2RlcyIsImdldFBhcmVudE5vZGUiLCJnZXRBdHRyTGlzdCIsImF0dHJMaXN0IiwiZ2V0VGFnTmFtZSIsImdldE5hbWVzcGFjZVVSSSIsImdldFRleHROb2RlQ29udGVudCIsInRleHROb2RlIiwiZ2V0Q29tbWVudE5vZGVDb250ZW50IiwiY29tbWVudE5vZGUiLCJnZXREb2N1bWVudFR5cGVOb2RlTmFtZSIsImdldERvY3VtZW50VHlwZU5vZGVQdWJsaWNJZCIsImdldERvY3VtZW50VHlwZU5vZGVTeXN0ZW1JZCIsImlzVGV4dE5vZGUiLCJpc0NvbW1lbnROb2RlIiwiaXNEb2N1bWVudFR5cGVOb2RlIiwiaXNFbGVtZW50Tm9kZSJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBSUEsT0FBTyxHQUFHQyxPQUFPLENBQUMsbUJBQUQsQ0FBckI7QUFBQSxJQUNJQyxhQUFhLEdBQUdELE9BQU8sQ0FBQyxnQkFBRCxDQUFQLENBQTBCQyxhQUQ5QyxDLENBSUE7OztBQUNBLElBQUlDLFNBQVMsR0FBRztBQUNaQyxFQUFBQSxPQUFPLEVBQUUsQ0FERztBQUVaQyxFQUFBQSxJQUFJLEVBQUUsQ0FGTTtBQUdaQyxFQUFBQSxLQUFLLEVBQUUsQ0FISztBQUlaQyxFQUFBQSxPQUFPLEVBQUU7QUFKRyxDQUFoQjtBQU9BLElBQUlDLHNCQUFzQixHQUFHO0FBQ3pCQyxFQUFBQSxPQUFPLEVBQUUsTUFEZ0I7QUFFekJDLEVBQUFBLFVBQVUsRUFBRSxVQUZhO0FBR3pCQyxFQUFBQSxVQUFVLEVBQUUsUUFIYTtBQUl6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ZG9jdHlwZSA9IHJlcXVpcmUoJy4uL2NvbW1vbi9kb2N0eXBlJyksXG4gICAgRE9DVU1FTlRfTU9ERSA9IHJlcXVpcmUoJy4uL2NvbW1vbi9odG1sJykuRE9DVU1FTlRfTU9ERTtcblxuXG4vL0NvbnZlcnNpb24gdGFibGVzIGZvciBET00gTGV2ZWwxIHN0cnVjdHVyZSBlbXVsYXRpb25cbnZhciBub2RlVHlwZXMgPSB7XG4gICAgZWxlbWVudDogMSxcbiAgICB0ZXh0OiAzLFxuICAgIGNkYXRhOiA0LFxuICAgIGNvbW1lbnQ6IDhcbn07XG5cbnZhciBub2RlUHJvcGVydHlTaG9ydGhhbmRzID0ge1xuICAgIHRhZ05hbWU6ICduYW1lJyxcbiAgICBjaGlsZE5vZGVzOiAnY2hpbGRyZW4nLFxuICAgIHBhcmVudE5vZGU6ICdwYXJlbnQnLFxuICAgIHByZXZpb3VzU2libGluZzogJ3ByZXYnLFxuICAgIG5leHRTaWJsaW5nOiAnbmV4dCcsXG4gICAgbm9kZVZhbHVlOiAnZGF0YSdcbn07XG5cbi8vTm9kZVxudmFyIE5vZGUgPSBmdW5jdGlvbiAocHJvcHMpIHtcbiAgICBmb3IgKHZhciBrZXkgaW4gcHJvcHMpIHtcbiAgICAgICAgaWYgKHByb3BzLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgICAgICAgICB0aGlzW2tleV0gPSBwcm9wc1trZXldO1xuICAgIH1cbn07XG5cbk5vZGUucHJvdG90eXBlID0ge1xuICAgIGdldCBmaXJzdENoaWxkKCkge1xuICAgICAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xuXG4gICAgICAgIHJldHVybiBjaGlsZHJlbiAmJiBjaGlsZHJlblswXSB8fCBudWxsO1xuICAgIH0sXG5cbiAgICBnZXQgbGFzdENoaWxkKCkge1xuICAgICAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xuXG4gICAgICAgIHJldHVybiBjaGlsZHJlbiAmJiBjaGlsZHJlbltjaGlsZHJlbi5sZW5ndGggLSAxXSB8fCBudWxsO1xuICAgIH0sXG5cbiAgICBnZXQgbm9kZVR5cGUoKSB7XG4gICAgICAgIHJldHVybiBub2RlVHlwZXNbdGhpcy50eXBlXSB8fCBub2RlVHlwZXMuZWxlbWVudDtcbiAgICB9XG59O1xuXG5PYmplY3Qua2V5cyhub2RlUHJvcGVydHlTaG9ydGhhbmRzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICB2YXIgc2hvcnRoYW5kID0gbm9kZVByb3BlcnR5U2hvcnRoYW5kc1trZXldO1xuXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KE5vZGUucHJvdG90eXBlLCBrZXksIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpc1tzaG9ydGhhbmRdIHx8IG51bGw7XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICAgICAgdGhpc1tzaG9ydGhhbmRdID0gdmFsO1xuICAgICAgICAgICAgcmV0dXJuIHZhbDtcbiAgICAgICAgfVxuICAgIH0pO1xufSk7XG5cblxuLy9Ob2RlIGNvbnN0cnVjdGlvblxuZXhwb3J0cy5jcmVhdGVEb2N1bWVudCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbmV3IE5vZGUoe1xuICAgICAgICB0eXBlOiAncm9vdCcsXG4gICAgICAgIG5hbWU6ICdyb290JyxcbiAgICAgICAgcGFyZW50OiBudWxsLFxuICAgICAgICBwcmV2OiBudWxsLFxuICAgICAgICBuZXh0OiBudWxsLFxuICAgICAgICBjaGlsZHJlbjogW10sXG4gICAgICAgICd4LW1vZGUnOiBET0NVTUVOVF9NT0RFLk5PX1FVSVJLU1xuICAgIH0pO1xufTtcblxuZXhwb3J0cy5jcmVhdGVEb2N1bWVudEZyYWdtZW50ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgTm9kZSh7XG4gICAgICAgIHR5cGU6ICdyb290JyxcbiAgICAgICAgbmFtZTogJ3Jvb3QnLFxuICAgICAgICBwYXJlbnQ6IG51bGwsXG4gICAgICAgIHByZXY6IG51bGwsXG4gICAgICAgIG5leHQ6IG51bGwsXG4gICAgICAgIGNoaWxkcmVuOiBbXVxuICAgIH0pO1xufTtcblxuZXhwb3J0cy5jcmVhdGVFbGVtZW50ID0gZnVuY3Rpb24gKHRhZ05hbWUsIG5hbWVzcGFjZVVSSSwgYXR0cnMpIHtcbiAgICB2YXIgYXR0cmlicyA9IE9iamVjdC5jcmVhdGUobnVsbCksXG4gICAgICAgIGF0dHJpYnNOYW1lc3BhY2UgPSBPYmplY3QuY3JlYXRlKG51bGwpLFxuICAgICAgICBhdHRyaWJzUHJlZml4ID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXR0cnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIGF0dHJOYW1lID0gYXR0cnNbaV0ubmFtZTtcblxuICAgICAgICBhdHRyaWJzW2F0dHJOYW1lXSA9IGF0dHJzW2ldLnZhbHVlO1xuICAgICAgICBhdHRyaWJzTmFtZXNwYWNlW2F0dHJOYW1lXSA9IGF0dHJzW2ldLm5hbWVzcGFjZTtcbiAgICAgICAgYXR0cmlic1ByZWZpeFthdHRyTmFtZV0gPSBhdHRyc1tpXS5wcmVmaXg7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBOb2RlKHtcbiAgICAgICAgdHlwZTogdGFnTmFtZSA9PT0gJ3NjcmlwdCcgfHwgdGFnTmFtZSA9PT0gJ3N0eWxlJyA/IHRhZ05hbWUgOiAndGFnJyxcbiAgICAgICAgbmFtZTogdGFnTmFtZSxcbiAgICAgICAgbmFtZXNwYWNlOiBuYW1lc3BhY2VVUkksXG4gICAgICAgIGF0dHJpYnM6IGF0dHJpYnMsXG4gICAgICAgICd4LWF0dHJpYnNOYW1lc3BhY2UnOiBhdHRyaWJzTmFtZXNwYWNlLFxuICAgICAgICAneC1hdHRyaWJzUHJlZml4JzogYXR0cmlic1ByZWZpeCxcbiAgICAgICAgY2hpbGRyZW46IFtdLFxuICAgICAgICBwYXJlbnQ6IG51bGwsXG4gICAgICAgIHByZXY6IG51bGwsXG4gICAgICAgIG5leHQ6IG51bGxcbiAgICB9KTtcbn07XG5cbmV4cG9ydHMuY3JlYXRlQ29tbWVudE5vZGUgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgIHJldHVybiBuZXcgTm9kZSh7XG4gICAgICAgIHR5cGU6ICdjb21tZW50JyxcbiAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgcGFyZW50OiBudWxsLFxuICAgICAgICBwcmV2OiBudWxsLFxuICAgICAgICBuZXh0OiBudWxsXG4gICAgfSk7XG59O1xuXG52YXIgY3JlYXRlVGV4dE5vZGUgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICByZXR1cm4gbmV3IE5vZGUoe1xuICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgIGRhdGE6IHZhbHVlLFxuICAgICAgICBwYXJlbnQ6IG51bGwsXG4gICAgICAgIHByZXY6IG51bGwsXG4gICAgICAgIG5leHQ6IG51bGxcbiAgICB9KTtcbn07XG5cblxuLy9UcmVlIG11dGF0aW9uXG52YXIgYXBwZW5kQ2hpbGQgPSBleHBvcnRzLmFwcGVuZENoaWxkID0gZnVuY3Rpb24gKHBhcmVudE5vZGUsIG5ld05vZGUpIHtcbiAgICB2YXIgcHJldiA9IHBhcmVudE5vZGUuY2hpbGRyZW5bcGFyZW50Tm9kZS5jaGlsZHJlbi5sZW5ndGggLSAxXTtcblxuICAgIGlmIChwcmV2KSB7XG4gICAgICAgIHByZXYubmV4dCA9IG5ld05vZGU7XG4gICAgICAgIG5ld05vZGUucHJldiA9IHByZXY7XG4gICAgfVxuXG4gICAgcGFyZW50Tm9kZS5jaGlsZHJlbi5wdXNoKG5ld05vZGUpO1xuICAgIG5ld05vZGUucGFyZW50ID0gcGFyZW50Tm9kZTtcbn07XG5cbnZhciBpbnNlcnRCZWZvcmUgPSBleHBvcnRzLmluc2VydEJlZm9yZSA9IGZ1bmN0aW9uIChwYXJlbnROb2RlLCBuZXdOb2RlLCByZWZlcmVuY2VOb2RlKSB7XG4gICAgdmFyIGluc2VydGlvbklkeCA9IHBhcmVudE5vZGUuY2hpbGRyZW4uaW5kZXhPZihyZWZlcmVuY2VOb2RlKSxcbiAgICAgICAgcHJldiA9IHJlZmVyZW5jZU5vZGUucHJldjtcblxuICAgIGlmIChwcmV2KSB7XG4gICAgICAgIHByZXYubmV4dCA9IG5ld05vZGU7XG4gICAgICAgIG5ld05vZGUucHJldiA9IHByZXY7XG4gICAgfVxuXG4gICAgcmVmZXJlbmNlTm9kZS5wcmV2ID0gbmV3Tm9kZTtcbiAgICBuZXdOb2RlLm5leHQgPSByZWZlcmVuY2VOb2RlO1xuXG4gICAgcGFyZW50Tm9kZS5jaGlsZHJlbi5zcGxpY2UoaW5zZXJ0aW9uSWR4LCAwLCBuZXdOb2RlKTtcbiAgICBuZXdOb2RlLnBhcmVudCA9IHBhcmVudE5vZGU7XG59O1xuXG5leHBvcnRzLnNldFRlbXBsYXRlQ29udGVudCA9IGZ1bmN0aW9uICh0ZW1wbGF0ZUVsZW1lbnQsIGNvbnRlbnRFbGVtZW50KSB7XG4gICAgYXBwZW5kQ2hpbGQodGVtcGxhdGVFbGVtZW50LCBjb250ZW50RWxlbWVudCk7XG59O1xuXG5leHBvcnRzLmdldFRlbXBsYXRlQ29udGVudCA9IGZ1bmN0aW9uICh0ZW1wbGF0ZUVsZW1lbnQpIHtcbiAgICByZXR1cm4gdGVtcGxhdGVFbGVtZW50LmNoaWxkcmVuWzBdO1xufTtcblxuZXhwb3J0cy5zZXREb2N1bWVudFR5cGUgPSBmdW5jdGlvbiAoZG9jdW1lbnQsIG5hbWUsIHB1YmxpY0lkLCBzeXN0ZW1JZCkge1xuICAgIHZhciBkYXRhID0gZG9jdHlwZS5zZXJpYWxpemVDb250ZW50KG5hbWUsIHB1YmxpY0lkLCBzeXN0ZW1JZCksXG4gICAgICAgIGRvY3R5cGVOb2RlID0gbnVsbDtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZG9jdW1lbnQuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKGRvY3VtZW50LmNoaWxkcmVuW2ldLnR5cGUgPT09ICdkaXJlY3RpdmUnICYmIGRvY3VtZW50LmNoaWxkcmVuW2ldLm5hbWUgPT09ICchZG9jdHlwZScpIHtcbiAgICAgICAgICAgIGRvY3R5cGVOb2RlID0gZG9jdW1lbnQuY2hpbGRyZW5baV07XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlmIChkb2N0eXBlTm9kZSkge1xuICAgICAgICBkb2N0eXBlTm9kZS5kYXRhID0gZGF0YTtcbiAgICAgICAgZG9jdHlwZU5vZGVbJ3gtbmFtZSddID0gbmFtZTtcbiAgICAgICAgZG9jdHlwZU5vZGVbJ3gtcHVibGljSWQnXSA9IHB1YmxpY0lkO1xuICAgICAgICBkb2N0eXBlTm9kZVsneC1zeXN0ZW1JZCddID0gc3lzdGVtSWQ7XG4gICAgfVxuXG4gICAgZWxzZSB7XG4gICAgICAgIGFwcGVuZENoaWxkKGRvY3VtZW50LCBuZXcgTm9kZSh7XG4gICAgICAgICAgICB0eXBlOiAnZGlyZWN0aXZlJyxcbiAgICAgICAgICAgIG5hbWU6ICchZG9jdHlwZScsXG4gICAgICAgICAgICBkYXRhOiBkYXRhLFxuICAgICAgICAgICAgJ3gtbmFtZSc6IG5hbWUsXG4gICAgICAgICAgICAneC1wdWJsaWNJZCc6IHB1YmxpY0lkLFxuICAgICAgICAgICAgJ3gtc3lzdGVtSWQnOiBzeXN0ZW1JZFxuICAgICAgICB9KSk7XG4gICAgfVxuXG59O1xuXG5leHBvcnRzLnNldERvY3VtZW50TW9kZSA9IGZ1bmN0aW9uIChkb2N1bWVudCwgbW9kZSkge1xuICAgIGRvY3VtZW50Wyd4LW1vZGUnXSA9IG1vZGU7XG59O1xuXG5leHBvcnRzLmdldERvY3VtZW50TW9kZSA9IGZ1bmN0aW9uIChkb2N1bWVudCkge1xuICAgIHJldHVybiBkb2N1bWVudFsneC1tb2RlJ107XG59O1xuXG5leHBvcnRzLmRldGFjaE5vZGUgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgIGlmIChub2RlLnBhcmVudCkge1xuICAgICAgICB2YXIgaWR4ID0gbm9kZS5wYXJlbnQuY2hpbGRyZW4uaW5kZXhPZihub2RlKSxcbiAgICAgICAgICAgIHByZXYgPSBub2RlLnByZXYsXG4gICAgICAgICAgICBuZXh0ID0gbm9kZS5uZXh0O1xuXG4gICAgICAgIG5vZGUucHJldiA9IG51bGw7XG4gICAgICAgIG5vZGUubmV4dCA9IG51bGw7XG5cbiAgICAgICAgaWYgKHByZXYpXG4gICAgICAgICAgICBwcmV2Lm5leHQgPSBuZXh0O1xuXG4gICAgICAgIGlmIChuZXh0KVxuICAgICAgICAgICAgbmV4dC5wcmV2ID0gcHJldjtcblxuICAgICAgICBub2RlLnBhcmVudC5jaGlsZHJlbi5zcGxpY2UoaWR4LCAxKTtcbiAgICAgICAgbm9kZS5wYXJlbnQgPSBudWxsO1xuICAgIH1cbn07XG5cbmV4cG9ydHMuaW5zZXJ0VGV4dCA9IGZ1bmN0aW9uIChwYXJlbnROb2RlLCB0ZXh0KSB7XG4gICAgdmFyIGxhc3RDaGlsZCA9IHBhcmVudE5vZGUuY2hpbGRyZW5bcGFyZW50Tm9kZS5jaGlsZHJlbi5sZW5ndGggLSAxXTtcblxuICAgIGlmIChsYXN0Q2hpbGQgJiYgbGFzdENoaWxkLnR5cGUgPT09ICd0ZXh0JylcbiAgICAgICAgbGFzdENoaWxkLmRhdGEgKz0gdGV4dDtcbiAgICBlbHNlXG4gICAgICAgIGFwcGVuZENoaWxkKHBhcmVudE5vZGUsIGNyZWF0ZVRleHROb2RlKHRleHQpKTtcbn07XG5cbmV4cG9ydHMuaW5zZXJ0VGV4dEJlZm9yZSA9IGZ1bmN0aW9uIChwYXJlbnROb2RlLCB0ZXh0LCByZWZlcmVuY2VOb2RlKSB7XG4gICAgdmFyIHByZXZOb2RlID0gcGFyZW50Tm9kZS5jaGlsZHJlbltwYXJlbnROb2RlLmNoaWxkcmVuLmluZGV4T2YocmVmZXJlbmNlTm9kZSkgLSAxXTtcblxuICAgIGlmIChwcmV2Tm9kZSAmJiBwcmV2Tm9kZS50eXBlID09PSAndGV4dCcpXG4gICAgICAgIHByZXZOb2RlLmRhdGEgKz0gdGV4dDtcbiAgICBlbHNlXG4gICAgICAgIGluc2VydEJlZm9yZShwYXJlbnROb2RlLCBjcmVhdGVUZXh0Tm9kZSh0ZXh0KSwgcmVmZXJlbmNlTm9kZSk7XG59O1xuXG5leHBvcnRzLmFkb3B0QXR0cmlidXRlcyA9IGZ1bmN0aW9uIChyZWNpcGllbnQsIGF0dHJzKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhdHRycy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgYXR0ck5hbWUgPSBhdHRyc1tpXS5uYW1lO1xuXG4gICAgICAgIGlmICh0eXBlb2YgcmVjaXBpZW50LmF0dHJpYnNbYXR0ck5hbWVdID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgcmVjaXBpZW50LmF0dHJpYnNbYXR0ck5hbWVdID0gYXR0cnNbaV0udmFsdWU7XG4gICAgICAgICAgICByZWNpcGllbnRbJ3gtYXR0cmlic05hbWVzcGFjZSddW2F0dHJOYW1lXSA9IGF0dHJzW2ldLm5hbWVzcGFjZTtcbiAgICAgICAgICAgIHJlY2lwaWVudFsneC1hdHRyaWJzUHJlZml4J11bYXR0ck5hbWVdID0gYXR0cnNbaV0ucHJlZml4O1xuICAgICAgICB9XG4gICAgfVxufTtcblxuXG4vL1RyZWUgdHJhdmVyc2luZ1xuZXhwb3J0cy5nZXRGaXJzdENoaWxkID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICByZXR1cm4gbm9kZS5jaGlsZHJlblswXTtcbn07XG5cbmV4cG9ydHMuZ2V0Q2hpbGROb2RlcyA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgcmV0dXJuIG5vZGUuY2hpbGRyZW47XG59O1xuXG5leHBvcnRzLmdldFBhcmVudE5vZGUgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgIHJldHVybiBub2RlLnBhcmVudDtcbn07XG5cbmV4cG9ydHMuZ2V0QXR0ckxpc3QgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgIHZhciBhdHRyTGlzdCA9IFtdO1xuXG4gICAgZm9yICh2YXIgbmFtZSBpbiBlbGVtZW50LmF0dHJpYnMpIHtcbiAgICAgICAgYXR0ckxpc3QucHVzaCh7XG4gICAgICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICAgICAgdmFsdWU6IGVsZW1lbnQuYXR0cmlic1tuYW1lXSxcbiAgICAgICAgICAgIG5hbWVzcGFjZTogZWxlbWVudFsneC1hdHRyaWJzTmFtZXNwYWNlJ11bbmFtZV0sXG4gICAgICAgICAgICBwcmVmaXg6IGVsZW1lbnRbJ3gtYXR0cmlic1ByZWZpeCddW25hbWVdXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBhdHRyTGlzdDtcbn07XG5cblxuLy9Ob2RlIGRhdGFcbmV4cG9ydHMuZ2V0VGFnTmFtZSA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgcmV0dXJuIGVsZW1lbnQubmFtZTtcbn07XG5cbmV4cG9ydHMuZ2V0TmFtZXNwYWNlVVJJID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICByZXR1cm4gZWxlbWVudC5uYW1lc3BhY2U7XG59O1xuXG5leHBvcnRzLmdldFRleHROb2RlQ29udGVudCA9IGZ1bmN0aW9uICh0ZXh0Tm9kZSkge1xuICAgIHJldHVybiB0ZXh0Tm9kZS5kYXRhO1xufTtcblxuZXhwb3J0cy5nZXRDb21tZW50Tm9kZUNvbnRlbnQgPSBmdW5jdGlvbiAoY29tbWVudE5vZGUpIHtcbiAgICByZXR1cm4gY29tbWVudE5vZGUuZGF0YTtcbn07XG5cbmV4cG9ydHMuZ2V0RG9jdW1lbnRUeXBlTm9kZU5hbWUgPSBmdW5jdGlvbiAoZG9jdHlwZU5vZGUpIHtcbiAgICByZXR1cm4gZG9jdHlwZU5vZGVbJ3gtbmFtZSddO1xufTtcblxuZXhwb3J0cy5nZXREb2N1bWVudFR5cGVOb2RlUHVibGljSWQgPSBmdW5jdGlvbiAoZG9jdHlwZU5vZGUpIHtcbiAgICByZXR1cm4gZG9jdHlwZU5vZGVbJ3gtcHVibGljSWQnXTtcbn07XG5cbmV4cG9ydHMuZ2V0RG9jdW1lbnRUeXBlTm9kZVN5c3RlbUlkID0gZnVuY3Rpb24gKGRvY3R5cGVOb2RlKSB7XG4gICAgcmV0dXJuIGRvY3R5cGVOb2RlWyd4LXN5c3RlbUlkJ107XG59O1xuXG5cbi8vTm9kZSB0eXBlc1xuZXhwb3J0cy5pc1RleHROb2RlID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICByZXR1cm4gbm9kZS50eXBlID09PSAndGV4dCc7XG59O1xuXG5leHBvcnRzLmlzQ29tbWVudE5vZGUgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgIHJldHVybiBub2RlLnR5cGUgPT09ICdjb21tZW50Jztcbn07XG5cbmV4cG9ydHMuaXNEb2N1bWVudFR5cGVOb2RlID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICByZXR1cm4gbm9kZS50eXBlID09PSAnZGlyZWN0aXZlJyAmJiBub2RlLm5hbWUgPT09ICchZG9jdHlwZSc7XG59O1xuXG5leHBvcnRzLmlzRWxlbWVudE5vZGUgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgIHJldHVybiAhIW5vZGUuYXR0cmlicztcbn07XG4iXX0=