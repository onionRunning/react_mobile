80b24d4e1d43b532ff71f6a2bf8cbd29
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = componentWithName;

var _react = _interopRequireDefault(require("react"));

var _isRegex = _interopRequireDefault(require("is-regex"));

var _arrayPrototype = _interopRequireDefault(require("array.prototype.find"));

var _getComponentName = _interopRequireDefault(require("./helpers/getComponentName"));

var _wrapValidator = _interopRequireDefault(require("./helpers/wrapValidator"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    "default": obj
  };
}

function stripHOCs(fullName, namesOfHOCsToStrip) {
  var innerName = fullName;

  while (/\([^()]*\)/g.test(innerName)) {
    var HOC = innerName;
    var previousHOC = void 0;

    do {
      previousHOC = HOC;
      HOC = previousHOC.replace(/\([^()]*\)/g, '');
    } while (previousHOC !== HOC);

    if (namesOfHOCsToStrip.indexOf(HOC) === -1) {
      return innerName;
    }

    innerName = innerName.replace(RegExp("^".concat(HOC, "\\(|\\)$"), 'g'), '');
  }

  return innerName;
}

function hasName(name, namesOfHOCsToStrip, propValue, propName, componentName) {
  for (var _len = arguments.length, rest = new Array(_len > 5 ? _len - 5 : 0), _key = 5; _key < _len; _key++) {
    rest[_key - 5] = arguments[_key];
  }

  if (Array.isArray(propValue)) {
    return (0, _arrayPrototype["default"])(propValue.map(function (item) {
      return hasName.apply(void 0, [name, namesOfHOCsToStrip, item, propName, componentName].concat(rest));
    }), Boolean) || null;
  }

  if (!_react["default"].isValidElement(propValue)) {
    return new TypeError("".concat(componentName, ".").concat(propName, " is not a valid React element"));
  }

  var type = propValue.type;
  var componentNameFromType = (0, _getComponentName["default"])(type);
  var innerComponentName = namesOfHOCsToStrip.length > 0 ? stripHOCs(componentNameFromType, namesOfHOCsToStrip) : componentNameFromType;

  if ((0, _isRegex["default"])(name) && !name.test(innerComponentName)) {
    return new TypeError("`".concat(componentName, ".").concat(propName, "` only accepts components matching the regular expression ").concat(name));
  }

  if (!(0, _isRegex["default"])(name) && innerComponentName !== name) {
    return new TypeError("`".concat(componentName, ".").concat(propName, "` only accepts components named ").concat(name, ", got ").concat(innerComponentName));
  }

  return null;
}

function componentWithName(name) {
  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

  if (typeof name !== 'string' && !(0, _isRegex["default"])(name)) {
    throw new TypeError('name must be a string or a regex');
  }

  var passedOptions = Object.keys(options);

  if (passedOptions.length > 1 || passedOptions.length === 1 && passedOptions[0] !== 'stripHOCs') {
    throw new TypeError("The only options supported are: \u201CstripHOCs\u201D, got: \u201C".concat(passedOptions.join('”, “'), "\u201D"));
  }

  var _options$stripHOCs = options.stripHOCs,
      namesOfHOCsToStrip = _options$stripHOCs === void 0 ? [] : _options$stripHOCs;
  var allHOCNamesAreValid = namesOfHOCsToStrip.every(function (x) {
    if (typeof x !== 'string' || /[()]/g.test(x)) {
      return false;
    }

    return /^(?:[a-z][a-zA-Z0-9]+|[A-Z][a-z][a-zA-Z0-9]+)$/.test(x);
  });

  if (!allHOCNamesAreValid) {
    throw new TypeError('every provided HOC name must be a string with no parens, and in camelCase');
  }

  function componentWithNameValidator(props, propName, componentName) {
    var propValue = props[propName];

    if (props[propName] == null) {
      return null;
    }

    for (var _len2 = arguments.length, rest = new Array(_len2 > 3 ? _len2 - 3 : 0), _key2 = 3; _key2 < _len2; _key2++) {
      rest[_key2 - 3] = arguments[_key2];
    }

    return hasName.apply(void 0, [name, namesOfHOCsToStrip, propValue, propName, componentName].concat(rest));
  }

  componentWithNameValidator.isRequired = function componentWithNameRequired(props, propName, componentName) {
    var propValue = props[propName];

    if (propValue == null) {
      return new TypeError("`".concat(componentName, ".").concat(propName, "` requires at least one component named ").concat(name));
    }

    for (var _len3 = arguments.length, rest = new Array(_len3 > 3 ? _len3 - 3 : 0), _key3 = 3; _key3 < _len3; _key3++) {
      rest[_key3 - 3] = arguments[_key3];
    }

    return hasName.apply(void 0, [name, namesOfHOCsToStrip, propValue, propName, componentName].concat(rest));
  };

  return (0, _wrapValidator["default"])(componentWithNameValidator, "componentWithName:".concat(name), name);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb21wb25lbnRXaXRoTmFtZS5qcyJdLCJuYW1lcyI6WyJpbm5lck5hbWUiLCJIT0MiLCJwcmV2aW91c0hPQyIsIm5hbWVzT2ZIT0NzVG9TdHJpcCIsIlJlZ0V4cCIsInJlc3QiLCJBcnJheSIsImhhc05hbWUiLCJSZWFjdCIsInR5cGUiLCJwcm9wVmFsdWUiLCJjb21wb25lbnROYW1lRnJvbVR5cGUiLCJpbm5lckNvbXBvbmVudE5hbWUiLCJzdHJpcEhPQ3MiLCJuYW1lIiwib3B0aW9ucyIsInBhc3NlZE9wdGlvbnMiLCJPYmplY3QiLCJhbGxIT0NOYW1lc0FyZVZhbGlkIiwicHJvcHMiLCJjb21wb25lbnRXaXRoTmFtZVZhbGlkYXRvciJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBLElBQUEsTUFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLE9BQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsUUFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLFVBQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsZUFBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLHNCQUFBLENBQUEsQ0FBQTs7QUFFQSxJQUFBLGlCQUFBLEdBQUEsc0JBQUEsQ0FBQSxPQUFBLENBQUEsNEJBQUEsQ0FBQSxDQUFBOztBQUNBLElBQUEsY0FBQSxHQUFBLHNCQUFBLENBQUEsT0FBQSxDQUFBLHlCQUFBLENBQUEsQ0FBQTs7Ozs7Ozs7QUFFQSxTQUFBLFNBQUEsQ0FBQSxRQUFBLEVBQUEsa0JBQUEsRUFBaUQ7QUFDL0MsTUFBSUEsU0FBUyxHQUFiLFFBQUE7O0FBQ0EsU0FBTyxjQUFBLElBQUEsQ0FBUCxTQUFPLENBQVAsRUFBd0M7QUFDdEMsUUFBSUMsR0FBRyxHQUFQLFNBQUE7QUFDQSxRQUFJQyxXQUFXLEdBQUEsS0FBZixDQUFBOztBQUNBLE9BQUc7QUFDREEsTUFBQUEsV0FBVyxHQUFYQSxHQUFBQTtBQUNBRCxNQUFBQSxHQUFHLEdBQUdDLFdBQVcsQ0FBWEEsT0FBQUEs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QSxhQUFBLEVBQUEsR0FBQSxFQUFBLE1BQUEsQ0FBQSxRQUFBLEVBQUEsMENBQUEsRUFBQSxNQUFBLENBQVAsSUFBTyxDQUFBLENBQVA7QUFDRDs7QUFKRCxTQUFBLElBQUEsS0FBQSxHQUFBLFNBQUEsQ0FBQSxNQUFBLEVBREdMLElBQ0gsR0FBQSxJQUFBLEtBQUEsQ0FBQSxLQUFBLEdBQUEsQ0FBQSxHQUFBLEtBQUEsR0FBQSxDQUFBLEdBQUEsQ0FBQSxDQUFBLEVBQUEsS0FBQSxHQUFBLENBQUEsRUFBQSxLQUFBLEdBQUEsS0FBQSxFQUFBLEtBQUEsRUFBQSxFQUFBO0FBREdBLE1BQUFBLElBQ0gsQ0FBQSxLQUFBLEdBQUEsQ0FBQSxDQURHQSxHQUNILFNBQUEsQ0FBQSxLQUFBLENBREdBO0FBQ0g7O0FBS0EsV0FBT0UsT0FBTyxDQUFQQSxLQUFBQSxDQUFBQSxLQUFBQSxDQUFBQSxFQUFBQSxDQUFBQSxJQUFBQSxFQUFBQSxrQkFBQUEsRUFBQUEsU0FBQUEsRUFBQUEsUUFBQUEsRUFBQUEsYUFBQUEsRUFBQUEsTUFBQUEsQ0FBUCxJQUFPQSxDQUFBQSxDQUFQO0FBVkZhLEdBQUFBOztBQWFBLFNBQU8sQ0FBQSxHQUFBLGNBQUEsQ0FBQSxTQUFBLENBQUEsRUFBQSwwQkFBQSxFQUFBLHFCQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsRUFBUCxJQUFPLENBQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgaXNSZWdleCBmcm9tICdpcy1yZWdleCc7XG5pbXBvcnQgZmluZCBmcm9tICdhcnJheS5wcm90b3R5cGUuZmluZCc7XG5cbmltcG9ydCBnZXRDb21wb25lbnROYW1lIGZyb20gJy4vaGVscGVycy9nZXRDb21wb25lbnROYW1lJztcbmltcG9ydCB3cmFwVmFsaWRhdG9yIGZyb20gJy4vaGVscGVycy93cmFwVmFsaWRhdG9yJztcblxuZnVuY3Rpb24gc3RyaXBIT0NzKGZ1bGxOYW1lLCBuYW1lc09mSE9Dc1RvU3RyaXApIHtcbiAgbGV0IGlubmVyTmFtZSA9IGZ1bGxOYW1lO1xuICB3aGlsZSAoKC9cXChbXigpXSpcXCkvZykudGVzdChpbm5lck5hbWUpKSB7XG4gICAgbGV0IEhPQyA9IGlubmVyTmFtZTtcbiAgICBsZXQgcHJldmlvdXNIT0M7XG4gICAgZG8ge1xuICAgICAgcHJldmlvdXNIT0MgPSBIT0M7XG4gICAgICBIT0MgPSBwcmV2aW91c0hPQy5yZXBsYWNlKC9cXChbXigpXSpcXCkvZywgJycpO1xuICAgIH0gd2hpbGUgKHByZXZpb3VzSE9DICE9PSBIT0MpO1xuXG4gICAgaWYgKG5hbWVzT2ZIT0NzVG9TdHJpcC5pbmRleE9mKEhPQykgPT09IC0xKSB7XG4gICAgICByZXR1cm4gaW5uZXJOYW1lO1xuICAgIH1cbiAgICBpbm5lck5hbWUgPSBpbm5lck5hbWUucmVwbGFjZShSZWdFeHAoYF4ke0hPQ31cXFxcKHxcXFxcKSRgLCAnZycpLCAnJyk7XG4gIH1cbiAgcmV0dXJuIGlubmVyTmFtZTtcbn1cblxuZnVuY3Rpb24gaGFzTmFtZShuYW1lLCBuYW1lc09mSE9Dc1RvU3RyaXAsIHByb3BWYWx1ZSwgcHJvcE5hbWUsIGNvbXBvbmVudE5hbWUsIC4uLnJlc3QpIHtcbiAgaWYgKEFycmF5LmlzQXJyYXkocHJvcFZhbHVlKSkge1xuICAgIHJldHVybiBmaW5kKFxuICAgICAgcHJvcFZhbHVlLm1hcCgoaXRlbSkgPT4gaGFzTmFtZShcbiAgICAgICAgbmFtZSxcbiAgICAgICAgbmFtZXNPZkhPQ3NUb1N0cmlwLFxuICAgICAgICBpdGVtLFxuICAgICAgICBwcm9wTmFtZSxcbiAgICAgICAgY29tcG9uZW50TmFtZSxcbiAgICAgICAgLi4ucmVzdCxcbiAgICAgICkpLFxuICAgICAgQm9vbGVhbixcbiAgICApIHx8IG51bGw7XG4gIH1cblxuICBpZiAoIVJlYWN0LmlzVmFsaWRFbGVtZW50KHByb3BWYWx1ZSkpIHtcbiAgICByZXR1cm4gbmV3IFR5cGVFcnJvcihcbiAgICAgIGAke2NvbXBvbmVudE5hbWV9LiR7cHJvcE5hbWV9IGlzIG5vdCBhIHZhbGlkIFJlYWN0IGVsZW1lbnRgLFxuICAgICk7XG4gIH1cblxuICBjb25zdCB7IHR5cGUgfSA9IHByb3BWYWx1ZTtcbiAgY29uc3QgY29tcG9uZW50TmFtZUZyb21UeXBlID0gZ2V0Q29tcG9uZW50TmFtZSh0eXBlKTtcbiAgY29uc3QgaW5uZXJDb21wb25lbnROYW1lID0gbmFtZXNPZkhPQ3NUb1N0cmlwLmxlbmd0aCA+IDBcbiAgICA/IHN0cmlwSE9Dcyhjb21wb25lbnROYW1lRnJvbVR5cGUsIG5hbWVzT2ZIT0NzVG9TdHJpcClcbiAgICA6IGNvbXBvbmVudE5hbWVGcm9tVHlwZTtcblxuICBpZiAoaXNSZWdleChuYW1lKSAmJiAhbmFtZS50ZXN0KGlubmVyQ29tcG9uZW50TmFtZSkpIHtcbiAgICByZXR1cm4gbmV3IFR5cGVFcnJvcihcbiAgICAgIGBcXGAke2NvbXBvbmVudE5hbWV9LiR7cHJvcE5hbWV9XFxgIG9ubHkgYWNjZXB0cyBjb21wb25lbnRzIG1hdGNoaW5nIHRoZSByZWd1bGFyIGV4cHJlc3Npb24gJHtuYW1lfWAsXG4gICAgKTtcbiAgfVxuXG4gIGlmICghaXNSZWdleChuYW1lKSAmJiBpbm5lckNvbXBvbmVudE5hbWUgIT09IG5hbWUpIHtcbiAgICByZXR1cm4gbmV3IFR5cGVFcnJvcihcbiAgICAgIGBcXGAke2NvbXBvbmVudE5hbWV9LiR7cHJvcE5hbWV9XFxgIG9ubHkgYWNjZXB0cyBjb21wb25lbnRzIG5hbWVkICR7bmFtZX0sIGdvdCAke2lubmVyQ29tcG9uZW50TmFtZX1gLFxuICAgICk7XG4gIH1cblxuICByZXR1cm4gbnVsbDtcbn1cblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gY29tcG9uZW50V2l0aE5hbWUoXG4gIG5hbWUsXG4gIG9wdGlvbnMgPSB7fSxcbikge1xuICBpZiAodHlwZW9mIG5hbWUgIT09ICdzdHJpbmcnICYmICFpc1JlZ2V4KG5hbWUpKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcignbmFtZSBtdXN0IGJlIGEgc3RyaW5nIG9yIGEgcmVnZXgnKTtcbiAgfVxuXG4gIGNvbnN0IHBhc3NlZE9wdGlvbnMgPSBPYmplY3Qua2V5cyhvcHRpb25zKTtcbiAgaWYgKHBhc3NlZE9wdGlvbnMubGVuZ3RoID4gMSB8fCAocGFzc2VkT3B0aW9ucy5sZW5ndGggPT09IDEgJiYgcGFzc2VkT3B0aW9uc1swXSAhPT0gJ3N0cmlwSE9DcycpKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihgVGhlIG9ubHkgb3B0aW9ucyBzdXBwb3J0ZWQgYXJlOiDigJxzdHJpcEhPQ3PigJ0sIGdvdDog4oCcJHtwYXNzZWRPcHRpb25zLmpvaW4oJ+KAnSwg4oCcJyl94oCdYCk7XG4gIH1cbiAgY29uc3QgeyBzdHJpcEhPQ3M6IG5hbWVzT2ZIT0NzVG9TdHJpcCA9IFtdIH0gPSBvcHRpb25zO1xuXG4gIGNvbnN0IGFsbEhPQ05hbWVzQXJlVmFsaWQgPSBuYW1lc09mSE9Dc1RvU3RyaXAuZXZlcnkoKHgpID0+IHtcbiAgICBpZiAodHlwZW9mIHggIT09ICdzdHJpbmcnIHx8IC9bKCldL2cudGVzdCh4KSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gL14oPzpbYS16XVthLXpBLVowLTldK3xbQS1aXVthLXpdW2EtekEtWjAtOV0rKSQvLnRlc3QoeCk7XG4gIH0pO1xuICBpZiAoIWFsbEhPQ05hbWVzQXJlVmFsaWQpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdldmVyeSBwcm92aWRlZCBIT0MgbmFtZSBtdXN0IGJlIGEgc3RyaW5nIHdpdGggbm8gcGFyZW5zLCBhbmQgaW4gY2FtZWxDYXNlJyk7XG4gIH1cblxuICBmdW5jdGlvbiBjb21wb25lbnRXaXRoTmFtZVZhbGlkYXRvcihwcm9wcywgcHJvcE5hbWUsIGNvbXBvbmVudE5hbWUsIC4uLnJlc3QpIHtcbiAgICBjb25zdCB7IFtwcm9wTmFtZV06IHByb3BWYWx1ZSB9ID0gcHJvcHM7XG4gICAgaWYgKHByb3BzW3Byb3BOYW1lXSA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIGhhc05hbWUobmFtZSwgbmFtZXNPZkhPQ3NUb1N0cmlwLCBwcm9wVmFsdWUsIHByb3BOYW1lLCBjb21wb25lbnROYW1lLCAuLi5yZXN0KTtcbiAgfVxuXG4gIGNvbXBvbmVudFdpdGhOYW1lVmFsaWRhdG9yLmlzUmVxdWlyZWQgPSBmdW5jdGlvbiBjb21wb25lbnRXaXRoTmFtZVJlcXVpcmVkKFxuICAgIHByb3BzLFxuICAgIHByb3BOYW1lLFxuICAgIGNvbXBvbmVudE5hbWUsXG4gICAgLi4ucmVzdFxuICApIHtcbiAgICBjb25zdCB7IFtwcm9wTmFtZV06IHByb3BWYWx1ZSB9ID0gcHJvcHM7XG4gICAgaWYgKHByb3BWYWx1ZSA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gbmV3IFR5cGVFcnJvcihgXFxgJHtjb21wb25lbnROYW1lfS4ke3Byb3BOYW1lfVxcYCByZXF1aXJlcyBhdCBsZWFzdCBvbmUgY29tcG9uZW50IG5hbWVkICR7bmFtZX1gKTtcbiAgICB9XG4gICAgcmV0dXJuIGhhc05hbWUobmFtZSwgbmFtZXNPZkhPQ3NUb1N0cmlwLCBwcm9wVmFsdWUsIHByb3BOYW1lLCBjb21wb25lbnROYW1lLCAuLi5yZXN0KTtcbiAgfTtcblxuICByZXR1cm4gd3JhcFZhbGlkYXRvcihjb21wb25lbnRXaXRoTmFtZVZhbGlkYXRvciwgYGNvbXBvbmVudFdpdGhOYW1lOiR7bmFtZX1gLCBuYW1lKTtcbn1cbiJdfQ==