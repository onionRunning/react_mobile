166c845a626d49066517a7e511586004
var ElementType = require("domelementtype");

var isTag = exports.isTag = ElementType.isTag;

exports.testElement = function (options, element) {
  for (var key in options) {
    if (!options.hasOwnProperty(key)) ;else if (key === "tag_name") {
      if (!isTag(element) || !options.tag_name(element.name)) {
        return false;
      }
    } else if (key === "tag_type") {
      if (!options.tag_type(element.type)) return false;
    } else if (key === "tag_contains") {
      if (isTag(element) || !options.tag_contains(element.data)) {
        return false;
      }
    } else if (!element.attribs || !options[key](element.attribs[key])) {
      return false;
    }
  }

  return true;
};

var Checks = {
  tag_name: function (name) {
    if (typeof name === "function") {
      return function (elem) {
        return isTag(elem) && name(elem.name);
      };
    } else if (name === "*") {
      return isTag;
    } else {
      return function (elem) {
        return isTag(elem) && elem.name === name;
      };
    }
  },
  tag_type: function (type) {
    if (typeof type === "function") {
      return function (elem) {
        return type(elem.type);
      };
    } else {
      return function (elem) {
        return elem.type === type;
      };
    }
  },
  tag_contains: function (data) {
    if (typeof data === "function") {
      return function (elem) {
        return !isTag(elem) && data(elem.data);
      };
    } else {
      return function (elem) {
        return !isTag(elem) && elem.data === data;
      };
    }
  }
};

function getAttribCheck(attrib, value) {
  if (typeof value === "function") {
    return function (elem) {
      return elem.attribs && value(elem.attribs[attrib]);
    };
  } else {
    return function (elem) {
      return elem.attribs && elem.attribs[attrib] === value;
    };
  }
}

function combineFuncs(a, b) {
  return function (elem) {
    return a(elem) || b(elem);
  };
}

exports.getElements = function (options, element, recurse, limit) {
  var funcs = Object.keys(options).map(function (key) {
    var value = options[key];
    return key in Checks ? Checks[key](value) : getAttribCheck(key, value);
  });
  return funcs.length === 0 ? [] : this.filter(funcs.reduce(combineFuncs), element, recurse, limit);
};

exports.getElementById = function (id, element, recurse) {
  if (!Array.isArray(element)) element = [element];
  return this.findOne(getAttribCheck("id", id), element, recurse !== false);
};

exports.getElementsByTagName = function (name, element, recurse, limit) {
  return this.filter(Checks.tag_name(name), element, recurse, limit);
};

exports.getElementsByTagType = function (type, element, recurse, limit) {
  return this.filter(Checks.tag_type(type), element, recurse, limit);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxlZ2FjeS5qcyJdLCJuYW1lcyI6WyJFbGVtZW50VHlwZSIsInJlcXVpcmUiLCJpc1RhZyIsImV4cG9ydHMiLCJ0ZXN0RWxlbWVudCIsIm9wdGlvbnMiLCJlbGVtZW50Iiwia2V5IiwiaGFzT3duUHJvcGVydHkiLCJ0YWdfbmFtZSIsIm5hbWUiLCJ0YWdfdHlwZSIsInR5cGUiLCJ0YWdfY29udGFpbnMiLCJkYXRhIiwiYXR0cmlicyIsIkNoZWNrcyIsImVsZW0iLCJnZXRBdHRyaWJDaGVjayIsImF0dHJpYiIsInZhbHVlIiwiY29tYmluZUZ1bmNzIiwiYSIsImIiLCJnZXRFbGVtZW50cyIsInJlY3Vyc2UiLCJsaW1pdCIsImZ1bmNzIiwiT2JqZWN0Iiwia2V5cyIsIm1hcCIsImxlbmd0aCIsImZpbHRlciIsInJlZHVjZSIsImdldEVsZW1lbnRCeUlkIiwiaWQiLCJBcnJheSIsImlzQXJyYXkiLCJmaW5kT25lIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJnZXRFbGVtZW50c0J5VGFnVHlwZSJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSUEsV0FBVyxHQUFHQyxPQUFPLENBQUMsZ0JBQUQsQ0FBekI7O0FBQ0EsSUFBSUMsS0FBSyxHQUFHQyxPQUFPLENBQUNELEtBQVIsR0FBZ0JGLFdBQVcsQ0FBQ0UsS0FBeEM7O0FBRUFDLE9BQU8sQ0FBQ0MsV0FBUixHQUFzQixVQUFTQyxPQUFULEVBQWtCQyxPQUFsQixFQUEwQjtBQUMvQyxPQUFJLElBQUlDLEdBQVIsSUFBZUYsT0FBZixFQUF1QjtBQUN0QixRQUFHLENBQUNBLE9BQU8sQ0FBQ0csY0FBUixDQUF1QkQsR0FBdkIsQ0FBSixFQUFnQyxDQUFoQyxLQUNLLElBQUdBLEdBQUcsS0FBSyxVQUFYLEVBQXNCO0FBQzFCLFVBQUcsQ0FBQ0wsS0FBSyxDQUFDSSxPQUFELENBQU4sSUFBbUIsQ0FBQ0QsT0FBTyxDQUFDSSxRQUFSLENBQWlCSCxPQUFPLENBQUNJLElBQXpCLENBQXZCLEVBQXNEO0FBQ3JELGVBQU8sS0FB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LEVBQVAsQ0FBM0IsRUFBdUM3QixPQUF2QyxFQUFnRG1CLE9BQU8sS0FBSyxLQUE1RCxDQUFQO0FBQ0EsQ0FIRDs7QUFLQXRCLE9BQU8sQ0FBQ29DLG9CQUFSLEdBQStCLFVBQVM3QixJQUFULEVBQWVKLE9BQWYsRUFBd0JtQixPQUF4QixFQUFpQ0MsS0FBakMsRUFBdUM7QUFDckUsU0FBTyxLQUFLTSxNQUFMLENBQVloQixNQUFNLENBQUNQLFFBQVAsQ0FBZ0JDLElBQWhCLENBQVosRUFBbUNKLE9BQW5DLEVBQTRDbUIsT0FBNUMsRUFBcURDLEtBQXJELENBQVA7QUFDQSxDQUZEOztBQUlBdkIsT0FBTyxDQUFDcUMsb0JBQVIsR0FBK0IsVUFBUzVCLElBQVQsRUFBZU4sT0FBZixFQUF3Qm1CLE9BQXhCLEVBQWlDQyxLQUFqQyxFQUF1QztBQUNyRSxTQUFPLEtBQUtNLE1BQUwsQ0FBWWhCLE1BQU0sQ0FBQ0wsUUFBUCxDQUFnQkMsSUFBaEIsQ0FBWixFQUFtQ04sT0FBbkMsRUFBNENtQixPQUE1QyxFQUFxREMsS0FBckQsQ0FBUDtBQUNBLENBRkQiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgRWxlbWVudFR5cGUgPSByZXF1aXJlKFwiZG9tZWxlbWVudHR5cGVcIik7XG52YXIgaXNUYWcgPSBleHBvcnRzLmlzVGFnID0gRWxlbWVudFR5cGUuaXNUYWc7XG5cbmV4cG9ydHMudGVzdEVsZW1lbnQgPSBmdW5jdGlvbihvcHRpb25zLCBlbGVtZW50KXtcblx0Zm9yKHZhciBrZXkgaW4gb3B0aW9ucyl7XG5cdFx0aWYoIW9wdGlvbnMuaGFzT3duUHJvcGVydHkoa2V5KSk7XG5cdFx0ZWxzZSBpZihrZXkgPT09IFwidGFnX25hbWVcIil7XG5cdFx0XHRpZighaXNUYWcoZWxlbWVudCkgfHwgIW9wdGlvbnMudGFnX25hbWUoZWxlbWVudC5uYW1lKSl7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblx0XHR9IGVsc2UgaWYoa2V5ID09PSBcInRhZ190eXBlXCIpe1xuXHRcdFx0aWYoIW9wdGlvbnMudGFnX3R5cGUoZWxlbWVudC50eXBlKSkgcmV0dXJuIGZhbHNlO1xuXHRcdH0gZWxzZSBpZihrZXkgPT09IFwidGFnX2NvbnRhaW5zXCIpe1xuXHRcdFx0aWYoaXNUYWcoZWxlbWVudCkgfHwgIW9wdGlvbnMudGFnX2NvbnRhaW5zKGVsZW1lbnQuZGF0YSkpe1xuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIGlmKCFlbGVtZW50LmF0dHJpYnMgfHwgIW9wdGlvbnNba2V5XShlbGVtZW50LmF0dHJpYnNba2V5XSkpe1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0fVxuXHRyZXR1cm4gdHJ1ZTtcbn07XG5cbnZhciBDaGVja3MgPSB7XG5cdHRhZ19uYW1lOiBmdW5jdGlvbihuYW1lKXtcblx0XHRpZih0eXBlb2YgbmFtZSA9PT0gXCJmdW5jdGlvblwiKXtcblx0XHRcdHJldHVybiBmdW5jdGlvbihlbGVtKXsgcmV0dXJuIGlzVGFnKGVsZW0pICYmIG5hbWUoZWxlbS5uYW1lKTsgfTtcblx0XHR9IGVsc2UgaWYobmFtZSA9PT0gXCIqXCIpe1xuXHRcdFx0cmV0dXJuIGlzVGFnO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gZnVuY3Rpb24oZWxlbSl7IHJldHVybiBpc1RhZyhlbGVtKSAmJiBlbGVtLm5hbWUgPT09IG5hbWU7IH07XG5cdFx0fVxuXHR9LFxuXHR0YWdfdHlwZTogZnVuY3Rpb24odHlwZSl7XG5cdFx0aWYodHlwZW9mIHR5cGUgPT09IFwiZnVuY3Rpb25cIil7XG5cdFx0XHRyZXR1cm4gZnVuY3Rpb24oZWxlbSl7IHJldHVybiB0eXBlKGVsZW0udHlwZSk7IH07XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiBmdW5jdGlvbihlbGVtKXsgcmV0dXJuIGVsZW0udHlwZSA9PT0gdHlwZTsgfTtcblx0XHR9XG5cdH0sXG5cdHRhZ19jb250YWluczogZnVuY3Rpb24oZGF0YSl7XG5cdFx0aWYodHlwZW9mIGRhdGEgPT09IFwiZnVuY3Rpb25cIil7XG5cdFx0XHRyZXR1cm4gZnVuY3Rpb24oZWxlbSl7IHJldHVybiAhaXNUYWcoZWxlbSkgJiYgZGF0YShlbGVtLmRhdGEpOyB9O1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRyZXR1cm4gZnVuY3Rpb24oZWxlbSl7IHJldHVybiAhaXNUYWcoZWxlbSkgJiYgZWxlbS5kYXRhID09PSBkYXRhOyB9O1xuXHRcdH1cblx0fVxufTtcblxuZnVuY3Rpb24gZ2V0QXR0cmliQ2hlY2soYXR0cmliLCB2YWx1ZSl7XG5cdGlmKHR5cGVvZiB2YWx1ZSA9PT0gXCJmdW5jdGlvblwiKXtcblx0XHRyZXR1cm4gZnVuY3Rpb24oZWxlbSl7IHJldHVybiBlbGVtLmF0dHJpYnMgJiYgdmFsdWUoZWxlbS5hdHRyaWJzW2F0dHJpYl0pOyB9O1xuXHR9IGVsc2Uge1xuXHRcdHJldHVybiBmdW5jdGlvbihlbGVtKXsgcmV0dXJuIGVsZW0uYXR0cmlicyAmJiBlbGVtLmF0dHJpYnNbYXR0cmliXSA9PT0gdmFsdWU7IH07XG5cdH1cbn1cblxuZnVuY3Rpb24gY29tYmluZUZ1bmNzKGEsIGIpe1xuXHRyZXR1cm4gZnVuY3Rpb24oZWxlbSl7XG5cdFx0cmV0dXJuIGEoZWxlbSkgfHwgYihlbGVtKTtcblx0fTtcbn1cblxuZXhwb3J0cy5nZXRFbGVtZW50cyA9IGZ1bmN0aW9uKG9wdGlvbnMsIGVsZW1lbnQsIHJlY3Vyc2UsIGxpbWl0KXtcblx0dmFyIGZ1bmNzID0gT2JqZWN0LmtleXMob3B0aW9ucykubWFwKGZ1bmN0aW9uKGtleSl7XG5cdFx0dmFyIHZhbHVlID0gb3B0aW9uc1trZXldO1xuXHRcdHJldHVybiBrZXkgaW4gQ2hlY2tzID8gQ2hlY2tzW2tleV0odmFsdWUpIDogZ2V0QXR0cmliQ2hlY2soa2V5LCB2YWx1ZSk7XG5cdH0pO1xuXG5cdHJldHVybiBmdW5jcy5sZW5ndGggPT09IDAgPyBbXSA6IHRoaXMuZmlsdGVyKFxuXHRcdGZ1bmNzLnJlZHVjZShjb21iaW5lRnVuY3MpLFxuXHRcdGVsZW1lbnQsIHJlY3Vyc2UsIGxpbWl0XG5cdCk7XG59O1xuXG5leHBvcnRzLmdldEVsZW1lbnRCeUlkID0gZnVuY3Rpb24oaWQsIGVsZW1lbnQsIHJlY3Vyc2Upe1xuXHRpZighQXJyYXkuaXNBcnJheShlbGVtZW50KSkgZWxlbWVudCA9IFtlbGVtZW50XTtcblx0cmV0dXJuIHRoaXMuZmluZE9uZShnZXRBdHRyaWJDaGVjayhcImlkXCIsIGlkKSwgZWxlbWVudCwgcmVjdXJzZSAhPT0gZmFsc2UpO1xufTtcblxuZXhwb3J0cy5nZXRFbGVtZW50c0J5VGFnTmFtZSA9IGZ1bmN0aW9uKG5hbWUsIGVsZW1lbnQsIHJlY3Vyc2UsIGxpbWl0KXtcblx0cmV0dXJuIHRoaXMuZmlsdGVyKENoZWNrcy50YWdfbmFtZShuYW1lKSwgZWxlbWVudCwgcmVjdXJzZSwgbGltaXQpO1xufTtcblxuZXhwb3J0cy5nZXRFbGVtZW50c0J5VGFnVHlwZSA9IGZ1bmN0aW9uKHR5cGUsIGVsZW1lbnQsIHJlY3Vyc2UsIGxpbWl0KXtcblx0cmV0dXJuIHRoaXMuZmlsdGVyKENoZWNrcy50YWdfdHlwZSh0eXBlKSwgZWxlbWVudCwgcmVjdXJzZSwgbGltaXQpO1xufTtcbiJdfQ==