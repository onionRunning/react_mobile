bf00f5e973d114e8e5fd55f8c3d69d77
// removeSubsets
// Given an array of nodes, remove any member that is contained by another.
exports.removeSubsets = function (nodes) {
  var idx = nodes.length,
      node,
      ancestor,
      replace; // Check if each node (or one of its ancestors) is already contained in the
  // array.

  while (--idx > -1) {
    node = ancestor = nodes[idx]; // Temporarily remove the node under consideration

    nodes[idx] = null;
    replace = true;

    while (ancestor) {
      if (nodes.indexOf(ancestor) > -1) {
        replace = false;
        nodes.splice(idx, 1);
        break;
      }

      ancestor = ancestor.parent;
    } // If the node has been found to be unique, re-insert it.


    if (replace) {
      nodes[idx] = node;
    }
  }

  return nodes;
}; // Source: http://dom.spec.whatwg.org/#dom-node-comparedocumentposition


var POSITION = {
  DISCONNECTED: 1,
  PRECEDING: 2,
  FOLLOWING: 4,
  CONTAINS: 8,
  CONTAINED_BY: 16
}; // Compare the position of one node against another node in any other document.
// The return value is a bitmask with the following values:
//
// document order:
// > There is an ordering, document order, defined on all the nodes in the
// > document corresponding to the order in which the first character of the
// > XML representation of each node occurs in the XML representation of the
// > document after expansion of general entities. Thus, the document element
// > node will be the first node. Element nodes occur before their children.
// > Thus, document order orders element nodes in order of the occurrence of
// > their start-tag in the XML (after expansion of entities). The attribute
// > nodes of an element occur after the element and before its children. The
// > relative order of attribute nodes is implementation-dependent./
// Source:
// http://www.w3.org/TR/DOM-Level-3-Core/glossary.html#dt-document-order
//
// @argument {Node} nodaA The first node to use in the comparison
// @argument {Node} nodeB The second node to use in the comparison
//
// @return {Number} A bitmask describing the input nodes' relative position.
//         See http://dom.spec.whatwg.org/#dom-node-comparedocumentposition for
//         a description of these values.

var comparePos = exports.compareDocumentPosition = function (nodeA, nodeB) {
  var aParents = [];
  var bParents = [];
  var current, sharedParent, siblings, aSibling, bSibling, idx;

  if (nodeA === nodeB) {
    return 0;
  }

  current = nodeA;

  while (current) {
    aParents.unshift(current);
    current = current.parent;
  }

  current = nodeB;

  while (current) {
    bParents.unshift(current);
    current = current.parent;
  }

  idx = 0;

  while (aParents[idx] === bParents[idx]) {
    idx++;
  }

  if (idx === 0) {
    return POSITION.DISCONNECTED;
  }

  sharedParent = aParents[idx - 1];
  siblings = sharedParent.children;
  aSibling = aParents[idx];
  bSibling = bParents[idx];

  if (siblings.indexOf(aSibling) > siblings.indexOf(bSibling)) {
    if (sharedParent === nodeB) {
      return POSITION.FOLLOWING | POSITION.CONTAINED_BY;
    }

    return POSITION.FOLLOWING;
  } else {
    if (sharedParent === nodeA) {
      return POSITION.PRECEDING | POSITION.CONTAINS;
    }

    return POSITION.PRECEDING;
  }
}; // Sort an array of nodes based on their relative position in the document and
// remove any duplicate nodes. If the array contains nodes that do not belong
// to the same document, sort order is unspecified.
//
// @argument {Array} nodes Array of DOM nodes
//
// @returns {Array} collection of unique nodes, sorted in document order


exports.uniqueSort = function (nodes) {
  var idx = nodes.length,
      node,
      position;
  nodes = nodes.slice();

  while (--idx > -1) {
    node = nodes[idx];
    position = nodes.indexOf(node);

    if (position > -1 && position < idx) {
      nodes.splice(idx, 1);
    }
  }

  nodes.sort(function (a, b) {
    var relative = comparePos(a, b);

    if (relative & POSITION.PRECEDING) {
      return -1;
    } else if (relative & POSITION.FOLLOWING) {
      return 1;
    }

    return 0;
  });
  return nodes;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhlbHBlcnMuanMiXSwibmFtZXMiOlsiZXhwb3J0cyIsInJlbW92ZVN1YnNldHMiLCJub2RlcyIsImlkeCIsImxlbmd0aCIsIm5vZGUiLCJhbmNlc3RvciIsInJlcGxhY2UiLCJpbmRleE9mIiwic3BsaWNlIiwicGFyZW50IiwiUE9TSVRJT04iLCJESVNDT05ORUNURUQiLCJQUkVDRURJTkciLCJGT0xMT1dJTkciLCJDT05UQUlOUyIsIkNPTlRBSU5FRF9CWSIsImNvbXBhcmVQb3MiLCJjb21wYXJlRG9jdW1lbnRQb3NpdGlvbiIsIm5vZGVBIiwibm9kZUIiLCJhUGFyZW50cyIsImJQYXJlbnRzIiwiY3VycmVudCIsInNoYXJlZFBhcmVudCIsInNpYmxpbmdzIiwiYVNpYmxpbmciLCJiU2libGluZyIsInVuc2hpZnQiLCJjaGlsZHJlbiIsInVuaXF1ZVNvcnQiLCJwb3NpdGlvbiIsInNsaWNlIiwic29ydCIsImEiLCJiIiwicmVsYXRpdmUiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQUEsT0FBTyxDQUFDQyxhQUFSLEdBQXdCLFVBQVNDLEtBQVQsRUFBZ0I7QUFDdkMsTUFBSUMsR0FBRyxHQUFHRCxLQUFLLENBQUNFLE1BQWhCO0FBQUEsTUFBd0JDLElBQXhCO0FBQUEsTUFBOEJDLFFBQTlCO0FBQUEsTUFBd0NDLE9BQXhDLENBRHVDLENBR3ZDO0FBQ0E7O0FBQ0EsU0FBTyxFQUFFSixHQUFGLEdBQVEsQ0FBQyxDQUFoQixFQUFtQjtBQUNsQkUsSUFBQUEsSUFBSSxHQUFHQyxRQUFRLEdBQUdKLEtBQUssQ0FBQ0MsR0FBRCxDQUF2QixDQURrQixDQUdsQjs7QUFDQUQsSUFBQUEsS0FBSyxDQUFDQyxHQUFELENBQUwsR0FBYSxJQUFiO0FBQ0FJLElBQUFBLE9BQU8sR0FBRyxJQUFWOztBQUVBLFdBQU9ELFFBQVAsRUFBaUI7QUFDaEIsVUFBSUosS0FBSyxDQUFDTSxPQUFOLENBQWNGLFFBQWQsSUFBMEIsQ0FBQyxDQUEvQixFQUFrQztBQUNqQ0MsUUFB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Q0E7QUFDRCxDQTdDRCxDLENBK0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQWIsT0FBTyxDQUFDOEIsVUFBUixHQUFxQixVQUFTNUIsS0FBVCxFQUFnQjtBQUNwQyxNQUFJQyxHQUFHLEdBQUdELEtBQUssQ0FBQ0UsTUFBaEI7QUFBQSxNQUF3QkMsSUFBeEI7QUFBQSxNQUE4QjBCLFFBQTlCO0FBRUE3QixFQUFBQSxLQUFLLEdBQUdBLEtBQUssQ0FBQzhCLEtBQU4sRUFBUjs7QUFFQSxTQUFPLEVBQUU3QixHQUFGLEdBQVEsQ0FBQyxDQUFoQixFQUFtQjtBQUNsQkUsSUFBQUEsSUFBSSxHQUFHSCxLQUFLLENBQUNDLEdBQUQsQ0FBWjtBQUNBNEIsSUFBQUEsUUFBUSxHQUFHN0IsS0FBSyxDQUFDTSxPQUFOLENBQWNILElBQWQsQ0FBWDs7QUFDQSxRQUFJMEIsUUFBUSxHQUFHLENBQUMsQ0FBWixJQUFpQkEsUUFBUSxHQUFHNUIsR0FBaEMsRUFBcUM7QUFDcENELE1BQUFBLEtBQUssQ0FBQ08sTUFBTixDQUFhTixHQUFiLEVBQWtCLENBQWxCO0FBQ0E7QUFDRDs7QUFDREQsRUFBQUEsS0FBSyxDQUFDK0IsSUFBTixDQUFXLFVBQVNDLENBQVQsRUFBWUMsQ0FBWixFQUFlO0FBQ3pCLFFBQUlDLFFBQVEsR0FBR25CLFVBQVUsQ0FBQ2lCLENBQUQsRUFBSUMsQ0FBSixDQUF6Qjs7QUFDQSxRQUFJQyxRQUFRLEdBQUd6QixRQUFRLENBQUNFLFNBQXhCLEVBQW1DO0FBQ2xDLGFBQU8sQ0FBQyxDQUFSO0FBQ0EsS0FGRCxNQUVPLElBQUl1QixRQUFRLEdBQUd6QixRQUFRLENBQUNHLFNBQXhCLEVBQW1DO0FBQ3pDLGFBQU8sQ0FBUDtBQUNBOztBQUNELFdBQU8sQ0FBUDtBQUNBLEdBUkQ7QUFVQSxTQUFPWixLQUFQO0FBQ0EsQ0F2QkQiLCJzb3VyY2VzQ29udGVudCI6WyIvLyByZW1vdmVTdWJzZXRzXG4vLyBHaXZlbiBhbiBhcnJheSBvZiBub2RlcywgcmVtb3ZlIGFueSBtZW1iZXIgdGhhdCBpcyBjb250YWluZWQgYnkgYW5vdGhlci5cbmV4cG9ydHMucmVtb3ZlU3Vic2V0cyA9IGZ1bmN0aW9uKG5vZGVzKSB7XG5cdHZhciBpZHggPSBub2Rlcy5sZW5ndGgsIG5vZGUsIGFuY2VzdG9yLCByZXBsYWNlO1xuXG5cdC8vIENoZWNrIGlmIGVhY2ggbm9kZSAob3Igb25lIG9mIGl0cyBhbmNlc3RvcnMpIGlzIGFscmVhZHkgY29udGFpbmVkIGluIHRoZVxuXHQvLyBhcnJheS5cblx0d2hpbGUgKC0taWR4ID4gLTEpIHtcblx0XHRub2RlID0gYW5jZXN0b3IgPSBub2Rlc1tpZHhdO1xuXG5cdFx0Ly8gVGVtcG9yYXJpbHkgcmVtb3ZlIHRoZSBub2RlIHVuZGVyIGNvbnNpZGVyYXRpb25cblx0XHRub2Rlc1tpZHhdID0gbnVsbDtcblx0XHRyZXBsYWNlID0gdHJ1ZTtcblxuXHRcdHdoaWxlIChhbmNlc3Rvcikge1xuXHRcdFx0aWYgKG5vZGVzLmluZGV4T2YoYW5jZXN0b3IpID4gLTEpIHtcblx0XHRcdFx0cmVwbGFjZSA9IGZhbHNlO1xuXHRcdFx0XHRub2Rlcy5zcGxpY2UoaWR4LCAxKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHR9XG5cdFx0XHRhbmNlc3RvciA9IGFuY2VzdG9yLnBhcmVudDtcblx0XHR9XG5cblx0XHQvLyBJZiB0aGUgbm9kZSBoYXMgYmVlbiBmb3VuZCB0byBiZSB1bmlxdWUsIHJlLWluc2VydCBpdC5cblx0XHRpZiAocmVwbGFjZSkge1xuXHRcdFx0bm9kZXNbaWR4XSA9IG5vZGU7XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIG5vZGVzO1xufTtcblxuLy8gU291cmNlOiBodHRwOi8vZG9tLnNwZWMud2hhdHdnLm9yZy8jZG9tLW5vZGUtY29tcGFyZWRvY3VtZW50cG9zaXRpb25cbnZhciBQT1NJVElPTiA9IHtcblx0RElTQ09OTkVDVEVEOiAxLFxuXHRQUkVDRURJTkc6IDIsXG5cdEZPTExPV0lORzogNCxcblx0Q09OVEFJTlM6IDgsXG5cdENPTlRBSU5FRF9CWTogMTZcbn07XG5cbi8vIENvbXBhcmUgdGhlIHBvc2l0aW9uIG9mIG9uZSBub2RlIGFnYWluc3QgYW5vdGhlciBub2RlIGluIGFueSBvdGhlciBkb2N1bWVudC5cbi8vIFRoZSByZXR1cm4gdmFsdWUgaXMgYSBiaXRtYXNrIHdpdGggdGhlIGZvbGxvd2luZyB2YWx1ZXM6XG4vL1xuLy8gZG9jdW1lbnQgb3JkZXI6XG4vLyA+IFRoZXJlIGlzIGFuIG9yZGVyaW5nLCBkb2N1bWVudCBvcmRlciwgZGVmaW5lZCBvbiBhbGwgdGhlIG5vZGVzIGluIHRoZVxuLy8gPiBkb2N1bWVudCBjb3JyZXNwb25kaW5nIHRvIHRoZSBvcmRlciBpbiB3aGljaCB0aGUgZmlyc3QgY2hhcmFjdGVyIG9mIHRoZVxuLy8gPiBYTUwgcmVwcmVzZW50YXRpb24gb2YgZWFjaCBub2RlIG9jY3VycyBpbiB0aGUgWE1MIHJlcHJlc2VudGF0aW9uIG9mIHRoZVxuLy8gPiBkb2N1bWVudCBhZnRlciBleHBhbnNpb24gb2YgZ2VuZXJhbCBlbnRpdGllcy4gVGh1cywgdGhlIGRvY3VtZW50IGVsZW1lbnRcbi8vID4gbm9kZSB3aWxsIGJlIHRoZSBmaXJzdCBub2RlLiBFbGVtZW50IG5vZGVzIG9jY3VyIGJlZm9yZSB0aGVpciBjaGlsZHJlbi5cbi8vID4gVGh1cywgZG9jdW1lbnQgb3JkZXIgb3JkZXJzIGVsZW1lbnQgbm9kZXMgaW4gb3JkZXIgb2YgdGhlIG9jY3VycmVuY2Ugb2Zcbi8vID4gdGhlaXIgc3RhcnQtdGFnIGluIHRoZSBYTUwgKGFmdGVyIGV4cGFuc2lvbiBvZiBlbnRpdGllcykuIFRoZSBhdHRyaWJ1dGVcbi8vID4gbm9kZXMgb2YgYW4gZWxlbWVudCBvY2N1ciBhZnRlciB0aGUgZWxlbWVudCBhbmQgYmVmb3JlIGl0cyBjaGlsZHJlbi4gVGhlXG4vLyA+IHJlbGF0aXZlIG9yZGVyIG9mIGF0dHJpYnV0ZSBub2RlcyBpcyBpbXBsZW1lbnRhdGlvbi1kZXBlbmRlbnQuL1xuLy8gU291cmNlOlxuLy8gaHR0cDovL3d3dy53My5vcmcvVFIvRE9NLUxldmVsLTMtQ29yZS9nbG9zc2FyeS5odG1sI2R0LWRvY3VtZW50LW9yZGVyXG4vL1xuLy8gQGFyZ3VtZW50IHtOb2RlfSBub2RhQSBUaGUgZmlyc3Qgbm9kZSB0byB1c2UgaW4gdGhlIGNvbXBhcmlzb25cbi8vIEBhcmd1bWVudCB7Tm9kZX0gbm9kZUIgVGhlIHNlY29uZCBub2RlIHRvIHVzZSBpbiB0aGUgY29tcGFyaXNvblxuLy9cbi8vIEByZXR1cm4ge051bWJlcn0gQSBiaXRtYXNrIGRlc2NyaWJpbmcgdGhlIGlucHV0IG5vZGVzJyByZWxhdGl2ZSBwb3NpdGlvbi5cbi8vICAgICAgICAgU2VlIGh0dHA6Ly9kb20uc3BlYy53aGF0d2cub3JnLyNkb20tbm9kZS1jb21wYXJlZG9jdW1lbnRwb3NpdGlvbiBmb3Jcbi8vICAgICAgICAgYSBkZXNjcmlwdGlvbiBvZiB0aGVzZSB2YWx1ZXMuXG52YXIgY29tcGFyZVBvcyA9IGV4cG9ydHMuY29tcGFyZURvY3VtZW50UG9zaXRpb24gPSBmdW5jdGlvbihub2RlQSwgbm9kZUIpIHtcblx0dmFyIGFQYXJlbnRzID0gW107XG5cdHZhciBiUGFyZW50cyA9IFtdO1xuXHR2YXIgY3VycmVudCwgc2hhcmVkUGFyZW50LCBzaWJsaW5ncywgYVNpYmxpbmcsIGJTaWJsaW5nLCBpZHg7XG5cblx0aWYgKG5vZGVBID09PSBub2RlQikge1xuXHRcdHJldHVybiAwO1xuXHR9XG5cblx0Y3VycmVudCA9IG5vZGVBO1xuXHR3aGlsZSAoY3VycmVudCkge1xuXHRcdGFQYXJlbnRzLnVuc2hpZnQoY3VycmVudCk7XG5cdFx0Y3VycmVudCA9IGN1cnJlbnQucGFyZW50O1xuXHR9XG5cdGN1cnJlbnQgPSBub2RlQjtcblx0d2hpbGUgKGN1cnJlbnQpIHtcblx0XHRiUGFyZW50cy51bnNoaWZ0KGN1cnJlbnQpO1xuXHRcdGN1cnJlbnQgPSBjdXJyZW50LnBhcmVudDtcblx0fVxuXG5cdGlkeCA9IDA7XG5cdHdoaWxlIChhUGFyZW50c1tpZHhdID09PSBiUGFyZW50c1tpZHhdKSB7XG5cdFx0aWR4Kys7XG5cdH1cblxuXHRpZiAoaWR4ID09PSAwKSB7XG5cdFx0cmV0dXJuIFBPU0lUSU9OLkRJU0NPTk5FQ1RFRDtcblx0fVxuXG5cdHNoYXJlZFBhcmVudCA9IGFQYXJlbnRzW2lkeCAtIDFdO1xuXHRzaWJsaW5ncyA9IHNoYXJlZFBhcmVudC5jaGlsZHJlbjtcblx0YVNpYmxpbmcgPSBhUGFyZW50c1tpZHhdO1xuXHRiU2libGluZyA9IGJQYXJlbnRzW2lkeF07XG5cblx0aWYgKHNpYmxpbmdzLmluZGV4T2YoYVNpYmxpbmcpID4gc2libGluZ3MuaW5kZXhPZihiU2libGluZykpIHtcblx0XHRpZiAoc2hhcmVkUGFyZW50ID09PSBub2RlQikge1xuXHRcdFx0cmV0dXJuIFBPU0lUSU9OLkZPTExPV0lORyB8IFBPU0lUSU9OLkNPTlRBSU5FRF9CWTtcblx0XHR9XG5cdFx0cmV0dXJuIFBPU0lUSU9OLkZPTExPV0lORztcblx0fSBlbHNlIHtcblx0XHRpZiAoc2hhcmVkUGFyZW50ID09PSBub2RlQSkge1xuXHRcdFx0cmV0dXJuIFBPU0lUSU9OLlBSRUNFRElORyB8IFBPU0lUSU9OLkNPTlRBSU5TO1xuXHRcdH1cblx0XHRyZXR1cm4gUE9TSVRJT04uUFJFQ0VESU5HO1xuXHR9XG59O1xuXG4vLyBTb3J0IGFuIGFycmF5IG9mIG5vZGVzIGJhc2VkIG9uIHRoZWlyIHJlbGF0aXZlIHBvc2l0aW9uIGluIHRoZSBkb2N1bWVudCBhbmRcbi8vIHJlbW92ZSBhbnkgZHVwbGljYXRlIG5vZGVzLiBJZiB0aGUgYXJyYXkgY29udGFpbnMgbm9kZXMgdGhhdCBkbyBub3QgYmVsb25nXG4vLyB0byB0aGUgc2FtZSBkb2N1bWVudCwgc29ydCBvcmRlciBpcyB1bnNwZWNpZmllZC5cbi8vXG4vLyBAYXJndW1lbnQge0FycmF5fSBub2RlcyBBcnJheSBvZiBET00gbm9kZXNcbi8vXG4vLyBAcmV0dXJucyB7QXJyYXl9IGNvbGxlY3Rpb24gb2YgdW5pcXVlIG5vZGVzLCBzb3J0ZWQgaW4gZG9jdW1lbnQgb3JkZXJcbmV4cG9ydHMudW5pcXVlU29ydCA9IGZ1bmN0aW9uKG5vZGVzKSB7XG5cdHZhciBpZHggPSBub2Rlcy5sZW5ndGgsIG5vZGUsIHBvc2l0aW9uO1xuXG5cdG5vZGVzID0gbm9kZXMuc2xpY2UoKTtcblxuXHR3aGlsZSAoLS1pZHggPiAtMSkge1xuXHRcdG5vZGUgPSBub2Rlc1tpZHhdO1xuXHRcdHBvc2l0aW9uID0gbm9kZXMuaW5kZXhPZihub2RlKTtcblx0XHRpZiAocG9zaXRpb24gPiAtMSAmJiBwb3NpdGlvbiA8IGlkeCkge1xuXHRcdFx0bm9kZXMuc3BsaWNlKGlkeCwgMSk7XG5cdFx0fVxuXHR9XG5cdG5vZGVzLnNvcnQoZnVuY3Rpb24oYSwgYikge1xuXHRcdHZhciByZWxhdGl2ZSA9IGNvbXBhcmVQb3MoYSwgYik7XG5cdFx0aWYgKHJlbGF0aXZlICYgUE9TSVRJT04uUFJFQ0VESU5HKSB7XG5cdFx0XHRyZXR1cm4gLTE7XG5cdFx0fSBlbHNlIGlmIChyZWxhdGl2ZSAmIFBPU0lUSU9OLkZPTExPV0lORykge1xuXHRcdFx0cmV0dXJuIDE7XG5cdFx0fVxuXHRcdHJldHVybiAwO1xuXHR9KTtcblxuXHRyZXR1cm4gbm9kZXM7XG59O1xuIl19