ce23448e5c608e7ead5e369a389bdf9d
var parse = require('../parse'),
    $ = require('../static'),
    updateDOM = parse.update,
    evaluate = parse.evaluate,
    utils = require('../utils'),
    domEach = utils.domEach,
    cloneDom = utils.cloneDom,
    isHtml = utils.isHtml,
    slice = Array.prototype.slice,
    _ = {
  flatten: require('lodash/flatten'),
  bind: require('lodash/bind'),
  forEach: require('lodash/forEach')
}; // Create an array of nodes, recursing into arrays and parsing strings if
// necessary


exports._makeDomArray = function makeDomArray(elem, clone) {
  if (elem == null) {
    return [];
  } else if (elem.cheerio) {
    return clone ? cloneDom(elem.get(), elem.options) : elem.get();
  } else if (Array.isArray(elem)) {
    return _.flatten(elem.map(function (el) {
      return this._makeDomArray(el, clone);
    }, this));
  } else if (typeof elem === 'string') {
    return evaluate(elem, this.options, false);
  } else {
    return clone ? cloneDom([elem]) : [elem];
  }
};

var _insert = function (concatenator) {
  return function () {
    var elems = slice.call(arguments),
        lastIdx = this.length - 1;
    return domEach(this, function (i, el) {
      var dom, domSrc;

      if (typeof elems[0] === 'function') {
        domSrc = elems[0].call(el, i, $.html(el.children));
      } else {
        domSrc = elems;
      }

      dom = this._makeDomArray(domSrc, i < lastIdx);
      concatenator(dom, el.children, el);
    });
  };
};
/*
 * Modify an array in-place, removing some number of elements and adding new
 * elements directly following them.
 *
 * @param {Array} array Target array to splice.
 * @param {Number} spliceIdx Index at which to begin changing the array.
 * @param {Number} spliceCount Number of elements to remove from the array.
 * @param {Array} newElems Elements to insert into the array.
 *
 * @api private
 */


var uniqueSplice = function (array, spliceIdx, spliceCount, newElems, parent) {
  var spliceArgs = [spliceIdx, spliceCount].concat(newElems),
      prev = array[spliceIdx - 1] || null,
      next = array[spliceIdx] || null;
  var idx, len, prevIdx, node, oldParent; // Before splicing in new elements, ensure they do not already appear in the
  // current array.

  for (idx = 0, len = newElems.length; idx < len; ++idx) {
    node = newElems[idx];
    oldParent = node.parent || node.root;
    prevIdx = oldParent && oldParent.children.indexOf(newElems[idx]);

    if (oldParent && prevIdx > -1) {
      oldParent.children.splice(prevIdx, 1);

      if (parent === oldParent && spliceIdx > prevIdx) {
        spliceArgs[0]--;
      }
    }

    node.root = null;
    node.parent = parent;

    if (node.prev) {
      node.prev.next = node.next || null;
    }

    if (node.next) {
      node.next.prev = node.prev || null;
    }

    node.prev = newElems[idx - 1] || prev;
    node.next = newElems[idx + 1] || next;
  }

  if (prev) {
    prev.next = newElems[0];
  }

  if (next) {
    next.prev = newElems[newElems.length - 1];
  }

  return array.splice.apply(array, spliceArgs);
};

exports.appendTo = function (target) {
  if (!target.cheerio) {
    target = this.constructor.call(this.constructor, target, null, this._originalRoot);
  }

  target.append(this);
  return this;
};

exports.prependTo = function (target) {
  if (!target.cheerio) {
    target = this.constructor.call(this.constructor, target, null, this._originalRoot);
  }

  target.prepend(this);
  return this;
};

exports.append = _insert(function (dom, children, parent) {
  uniqueSplice(children, children.length, 0, dom, parent);
});
exports.prepend = _insert(function (dom, children, parent) {
  uniqueSplice(children, 0, 0, dom, parent);
});

exports.wrap = function (wrapper) {
  var wrapperFn = typeof wrapper === 'function' && wrapper,
      lastIdx = this.length - 1;

  _.forEach(this, _.bind(function (el, i) {
    var parent = el.parent || el.root,
        siblings = parent.children,
        wrapperDom,
        elInsertLocation,
        j,
        index;

    if (!parent) {
      return;
    }

    if (wrapperFn) {
      wrapper = wrapperFn.call(el, i);
    }

    if (typeof wrapper === 'string' && !isHtml(wrapper)) {
      wrapper = this.parents().last().find(wrapper).clone();
    }

    wrapperDom = this._makeDomArray(wrapper, i < lastIdx).slice(0, 1);
    elInsertLocation = wrapperDom[0]; // Find the deepest child. Only consider the first tag child of each node
    // (ignore text); stop if no children are found.

    j = 0;

    while (elInsertLocation && elInsertLocation.children) {
      if (j >= elInsertLocation.children.length) {
        break;
      }

      if (elInsertLocation.children[j].type === 'tag') {
        elInsertLocation = elInsertLocation.children[j];
        j = 0;
      } else {
        j++;
      }
    }

    index = siblings.indexOf(el);
    updateDOM([el], elInsertLocation); // The previous operation removed the current element from the `siblings`
    // array, so the `dom` array can be inserted without removing any
    // additional elements.

    uniqueSplice(siblings, index, 0, wrapperDom, parent);
  }, this));

  return this;
};

exports.after = function () {
  var elems = slice.call(arguments),
      lastIdx = this.length - 1;
  domEach(this, function (i, el) {
    var parent = el.parent || el.root;

    if (!parent) {
      return;
    }

    var siblings = parent.children,
        index = siblings.indexOf(el),
        domSrc,
        dom; // If not found, move on

    if (index < 0) return;

    if (typeof elems[0] === 'function') {
      domSrc = elems[0].call(el, i, $.html(el.children));
    } else {
      domSrc = elems;
    }

    dom = this._makeDomArray(domSrc, i < lastIdx); // Add element after `this` element

    uniqueSplice(siblings, index + 1, 0, dom, parent);
  });
  return this;
};

exports.insertAfter = function (target) {
  var clones = [],
      self = this;

  if (typeof target === 'string') {
    target = this.constructor.call(this.constructor, target, null, this._originalRoot);
  }

  target = this._makeDomArray(target);
  self.remove();
  domEach(target, function (i, el) {
    var clonedSelf = self._makeDomArray(self.clone());

    var parent = el.parent || el.root;

    if (!parent) {
      return;
    }

    var siblings = parent.children,
        index = siblings.indexOf(el); // If not found, move on

    if (index < 0) return; // Add cloned `this` element(s) after target element

    uniqueSplice(siblings, index + 1, 0, clonedSelf, parent);
    clones.push(clonedSelf);
  });
  return this.constructor.call(this.constructor, this._makeDomArray(clones));
};

exports.before = function () {
  var elems = slice.call(arguments),
      lastIdx = this.length - 1;
  domEach(this, function (i, el) {
    var parent = el.parent || el.root;

    if (!parent) {
      return;
    }

    var siblings = parent.children,
        index = siblings.indexOf(el),
        domSrc,
        dom; // If not found, move on

    if (index < 0) return;

    if (typeof elems[0] === 'function') {
      domSrc = elems[0].call(el, i, $.html(el.children));
    } else {
      domSrc = elems;
    }

    dom = this._makeDomArray(domSrc, i < lastIdx); // Add element before `el` element

    uniqueSplice(siblings, index, 0, dom, parent);
  });
  return this;
};

exports.insertBefore = function (target) {
  var clones = [],
      self = this;

  if (typeof target === 'string') {
    target = this.constructor.call(this.constructor, target, null, this._originalRoot);
  }

  target = this._makeDomArray(target);
  self.remove();
  domEach(target, function (i, el) {
    var clonedSelf = self._makeDomArray(self.clone());

    var parent = el.parent || el.root;

    if (!parent) {
      return;
    }

    var siblings = parent.children,
        index = siblings.indexOf(el); // If not found, move on

    if (index < 0) return; // Add cloned `this` element(s) after target element

    uniqueSplice(siblings, index, 0, clonedSelf, parent);
    clones.push(clonedSelf);
  });
  return this.constructor.call(this.constructor, this._makeDomArray(clones));
};
/*
  remove([selector])
*/


exports.remove = function (selector) {
  var elems = this; // Filter if we have selector

  if (selector) elems = elems.filter(selector);
  domEach(elems, function (i, el) {
    var parent = el.parent || el.root;

    if (!parent) {
      return;
    }

    var siblings = parent.children,
        index = siblings.indexOf(el);
    if (index < 0) return;
    siblings.splice(index, 1);

    if (el.prev) {
      el.prev.next = el.next;
    }

    if (el.next) {
      el.next.prev = el.prev;
    }

    el.prev = el.next = el.parent = el.root = null;
  });
  return this;
};

exports.replaceWith = function (content) {
  var self = this;
  domEach(this, function (i, el) {
    var parent = el.parent || el.root;

    if (!parent) {
      return;
    }

    var siblings = parent.children,
        dom = self._makeDomArray(typeof content === 'function' ? content.call(el, i, el) : content),
        index; // In the case that `dom` contains nodes that already exist in other
    // structures, ensure those nodes are properly removed.


    updateDOM(dom, null);
    index = siblings.indexOf(el); // Completely remove old element

    uniqueSplice(siblings, index, 1, dom, parent);
    el.parent = el.prev = el.next = el.root = null;
  });
  return this;
};

exports.empty = function () {
  domEach(this, function (i, el) {
    _.forEach(el.children, function (child) {
      child.next = child.prev = child.parent = null;
    });

    el.children.length = 0;
  });
  return this;
};
/**
 * Set/Get the HTML
 */


exports.html = function (str) {
  if (str === undefined) {
    if (!this[0] || !this[0].children) return null;
    return $.html(this[0].children, this.options);
  }

  var opts = this.options;
  domEach(this, function (i, el) {
    _.forEach(el.children, function (child) {
      child.next = child.prev = child.parent = null;
    });

    var content = str.cheerio ? str.clone().get() : evaluate('' + str, opts, false);
    updateDOM(content, el);
  });
  return this;
};

exports.toString = function () {
  return $.html(this, this.options);
};

exports.text = function (str) {
  // If `str` is undefined, act as a "getter"
  if (str === undefined) {
    return $.text(this);
  } else if (typeof str === 'function') {
    // Function support
    return domEach(this, function (i, el) {
      var $el = [el];
      return exports.text.call($el, str.call(el, i, $.text($el)));
    });
  } // Append text node to each selected elements


  domEach(this, function (i, el) {
    _.forEach(el.children, function (child) {
      child.next = child.prev = child.parent = null;
    });

    var elem = {
      data: '' + str,
      type: 'text',
      parent: el,
      prev: null,
      next: null,
      children: []
    };
    updateDOM(elem, el);
  });
  return this;
};

exports.clone = function () {
  return this._make(cloneDom(this.get(), this.options));
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1hbmlwdWxhdGlvbi5qcyJdLCJuYW1lcyI6WyJwYXJzZSIsInJlcXVpcmUiLCIkIiwidXBkYXRlRE9NIiwidXBkYXRlIiwiZXZhbHVhdGUiLCJ1dGlscyIsImRvbUVhY2giLCJjbG9uZURvbSIsImlzSHRtbCIsInNsaWNlIiwiQXJyYXkiLCJwcm90b3R5cGUiLCJfIiwiZmxhdHRlbiIsImJpbmQiLCJmb3JFYWNoIiwiZXhwb3J0cyIsIl9tYWtlRG9tQXJyYXkiLCJtYWtlRG9tQXJyYXkiLCJlbGVtIiwiY2xvbmUiLCJjaGVlcmlvIiwiZ2V0Iiwib3B0aW9ucyIsImlzQXJyYXkiLCJtYXAiLCJlbCIsIl9pbnNlcnQiLCJjb25jYXRlbmF0b3IiLCJlbGVtcyIsImNhbGwiLCJhcmd1bWVudHMiLCJsYXN0SWR4IiwibGVuZ3RoIiwiaSIsImRvbSIsImRvbVNyYyIsImh0bWwiLCJjaGlsZHJlbiIsInVuaXF1ZVNwbGljZSIsImFycmF5Iiwic3BsaWNlSWR4Iiwic3BsaWNlQ291bnQiLCJuZXdFbGVtcyIsInBhcmVudCIsInNwbGljZUFyZ3MiLCJjb25jYXQiLCJwcmV2IiwibmV4dCIsImlkeCIsImxlbiIsInByZXZJZHgiLCJub2RlIiwib2xkUGFyZW50Iiwicm9vdCIsImluZGV4T2YiLCJzcGxpY2UiLCJhcHBseSIsImFwcGVuZFRvIiwidGFyZ2V0IiwiY29uc3RydWN0b3IiLCJfb3JpZ2luYWxSb290IiwiYXBwZW5kIiwicHJlcGVuZFRvIiwicHJlcGVuZCIsIndyYXAiLCJ3cmFwcGVyIiwid3JhcHBlckZuIiwic2libGluZ3MiLCJ3cmFwcGVyRG9tIiwiZWxJbnNlcnRMb2NhdGlvbiIsImoiLCJpbmRleCIsInBhcmVudHMiLCJsYXN0IiwiZmluZCIsInR5cGUiLCJhZnRlciIsImluc2VydEFmdGVyIiwiY2xvbmVzIiwic2VsZiIsInJlbW92ZSIsImNsb25lZFNlbGYiLCJwdXNoIiwiYmVmb3JlIiwiaW5zZXJ0QmVmb3JlIiwic2VsZWN0b3IiLCJmaWx0ZXIiLCJyZXBsYWNlV2l0aCIsImNvbnRlbnQiLCJlbXB0eSIsImNoaWxkIiwic3RyIiwidW5kZWZpbmVkIiwib3B0cyIsInRvU3RyaW5nIiwidGV4dCIsIiRlbCIsImRhdGEiLCJfbWFrZSJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSUEsS0FBSyxHQUFHQyxPQUFPLENBQUMsVUFBRCxDQUFuQjtBQUFBLElBQ0lDLENBQUMsR0FBR0QsT0FBTyxDQUFDLFdBQUQsQ0FEZjtBQUFBLElBRUlFLFNBQVMsR0FBR0gsS0FBSyxDQUFDSSxNQUZ0QjtBQUFBLElBR0lDLFFBQVEsR0FBR0wsS0FBSyxDQUFDSyxRQUhyQjtBQUFBLElBSUlDLEtBQUssR0FBR0wsT0FBTyxDQUFDLFVBQUQsQ0FKbkI7QUFBQSxJQUtJTSxPQUFPLEdBQUdELEtBQUssQ0FBQ0MsT0FMcEI7QUFBQSxJQU1JQyxRQUFRLEdBQUdGLEtBQUssQ0FBQ0UsUUFOckI7QUFBQSxJQU9JQyxNQUFNLEdBQUdILEtBQUssQ0FBQ0csTUFQbkI7QUFBQSxJQVFJQyxLQUFLLEdBQUdDLEtBQUssQ0FBQ0MsU0FBTixDQUFnQkYsS0FSNUI7QUFBQSxJQVNJRyxDQUFDLEdBQUc7QUFDRkMsRUFBQUEsT0FBTyxFQUFFYixPQUFPLENBQUMsZ0JBQUQsQ0FEZDtBQUVGYyxFQUFBQSxJQUFJLEVBQUVkLE9BQU8sQ0FBQyxhQUFELENBRlg7QUFHRmUsRUFBQUEsT0FBTyxFQUFFZixPQUFPLENBQUMsZ0JBQUQ7QUFIZCxDQVRSLEMsQ0FlQTtBQUNBOzs7QUFDQWdCLE9BQU8sQ0FBQ0MsYUFBUixHQUF3QixTQUFTQyxZQUFULENBQXNCQyxJQUF0QixFQUE0QkMsS0FBNUIsRUFBbUM7QUFDekQsTUFBSUQsSUFBSSxJQUFJLElBQVosRUFBa0I7QUFDaEIsV0FBTyxFQUFQO0FBQ0QsR0FGRCxNQUVPLElBQUlBLElBQUksQ0FBQ0UsT0FBVCxFQUFrQjtBQUN2QixXQUFPRCxLQUFLLEdBQUdiLFFBQVEsQ0FBQ1ksSUFBSSxDQUFDRyxHQUFMLEVBQUQsRUFBYUgsSUFBSSxDQUFDSSxP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LENBWTNCOzs7QUFDQTNGLEVBQUFBLE9BQU8sQ0FBQyxJQUFELEVBQU8sVUFBUzRCLENBQVQsRUFBWVIsRUFBWixFQUFnQjtBQUM1QmQsSUFBQUEsQ0FBQyxDQUFDRyxPQUFGLENBQVVXLEVBQUUsQ0FBQ1ksUUFBYixFQUF1QixVQUFTcUQsS0FBVCxFQUFnQjtBQUNyQ0EsTUFBQUEsS0FBSyxDQUFDM0MsSUFBTixHQUFhMkMsS0FBSyxDQUFDNUMsSUFBTixHQUFhNEMsS0FBSyxDQUFDL0MsTUFBTixHQUFlLElBQXpDO0FBQ0QsS0FGRDs7QUFJQSxRQUFJekIsSUFBSSxHQUFHO0FBQ1QrRSxNQUFBQSxJQUFJLEVBQUUsS0FBS04sR0FERjtBQUVUaEIsTUFBQUEsSUFBSSxFQUFFLE1BRkc7QUFHVGhDLE1BQUFBLE1BQU0sRUFBRWxCLEVBSEM7QUFJVHFCLE1BQUFBLElBQUksRUFBRSxJQUpHO0FBS1RDLE1BQUFBLElBQUksRUFBRSxJQUxHO0FBTVRWLE1BQUFBLFFBQVEsRUFBRTtBQU5ELEtBQVg7QUFTQXBDLElBQUFBLFNBQVMsQ0FBQ2lCLElBQUQsRUFBT08sRUFBUCxDQUFUO0FBQ0QsR0FmTSxDQUFQO0FBaUJBLFNBQU8sSUFBUDtBQUNELENBL0JEOztBQWlDQVYsT0FBTyxDQUFDSSxLQUFSLEdBQWdCLFlBQVc7QUFDekIsU0FBTyxLQUFLK0UsS0FBTCxDQUFXNUYsUUFBUSxDQUFDLEtBQUtlLEdBQUwsRUFBRCxFQUFhLEtBQUtDLE9BQWxCLENBQW5CLENBQVA7QUFDRCxDQUZEIiwic291cmNlc0NvbnRlbnQiOlsidmFyIHBhcnNlID0gcmVxdWlyZSgnLi4vcGFyc2UnKSxcbiAgICAkID0gcmVxdWlyZSgnLi4vc3RhdGljJyksXG4gICAgdXBkYXRlRE9NID0gcGFyc2UudXBkYXRlLFxuICAgIGV2YWx1YXRlID0gcGFyc2UuZXZhbHVhdGUsXG4gICAgdXRpbHMgPSByZXF1aXJlKCcuLi91dGlscycpLFxuICAgIGRvbUVhY2ggPSB1dGlscy5kb21FYWNoLFxuICAgIGNsb25lRG9tID0gdXRpbHMuY2xvbmVEb20sXG4gICAgaXNIdG1sID0gdXRpbHMuaXNIdG1sLFxuICAgIHNsaWNlID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLFxuICAgIF8gPSB7XG4gICAgICBmbGF0dGVuOiByZXF1aXJlKCdsb2Rhc2gvZmxhdHRlbicpLFxuICAgICAgYmluZDogcmVxdWlyZSgnbG9kYXNoL2JpbmQnKSxcbiAgICAgIGZvckVhY2g6IHJlcXVpcmUoJ2xvZGFzaC9mb3JFYWNoJylcbiAgICB9O1xuXG4vLyBDcmVhdGUgYW4gYXJyYXkgb2Ygbm9kZXMsIHJlY3Vyc2luZyBpbnRvIGFycmF5cyBhbmQgcGFyc2luZyBzdHJpbmdzIGlmXG4vLyBuZWNlc3NhcnlcbmV4cG9ydHMuX21ha2VEb21BcnJheSA9IGZ1bmN0aW9uIG1ha2VEb21BcnJheShlbGVtLCBjbG9uZSkge1xuICBpZiAoZWxlbSA9PSBudWxsKSB7XG4gICAgcmV0dXJuIFtdO1xuICB9IGVsc2UgaWYgKGVsZW0uY2hlZXJpbykge1xuICAgIHJldHVybiBjbG9uZSA/IGNsb25lRG9tKGVsZW0uZ2V0KCksIGVsZW0ub3B0aW9ucykgOiBlbGVtLmdldCgpO1xuICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoZWxlbSkpIHtcbiAgICByZXR1cm4gXy5mbGF0dGVuKGVsZW0ubWFwKGZ1bmN0aW9uKGVsKSB7XG4gICAgICByZXR1cm4gdGhpcy5fbWFrZURvbUFycmF5KGVsLCBjbG9uZSk7XG4gICAgfSwgdGhpcykpO1xuICB9IGVsc2UgaWYgKHR5cGVvZiBlbGVtID09PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBldmFsdWF0ZShlbGVtLCB0aGlzLm9wdGlvbnMsIGZhbHNlKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gY2xvbmUgPyBjbG9uZURvbShbZWxlbV0pIDogW2VsZW1dO1xuICB9XG59O1xuXG52YXIgX2luc2VydCA9IGZ1bmN0aW9uKGNvbmNhdGVuYXRvcikge1xuICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGVsZW1zID0gc2xpY2UuY2FsbChhcmd1bWVudHMpLFxuICAgICAgICBsYXN0SWR4ID0gdGhpcy5sZW5ndGggLSAxO1xuXG4gICAgcmV0dXJuIGRvbUVhY2godGhpcywgZnVuY3Rpb24oaSwgZWwpIHtcbiAgICAgIHZhciBkb20sIGRvbVNyYztcblxuICAgICAgaWYgKHR5cGVvZiBlbGVtc1swXSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBkb21TcmMgPSBlbGVtc1swXS5jYWxsKGVsLCBpLCAkLmh0bWwoZWwuY2hpbGRyZW4pKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRvbVNyYyA9IGVsZW1zO1xuICAgICAgfVxuXG4gICAgICBkb20gPSB0aGlzLl9tYWtlRG9tQXJyYXkoZG9tU3JjLCBpIDwgbGFzdElkeCk7XG4gICAgICBjb25jYXRlbmF0b3IoZG9tLCBlbC5jaGlsZHJlbiwgZWwpO1xuICAgIH0pO1xuICB9O1xufTtcblxuLypcbiAqIE1vZGlmeSBhbiBhcnJheSBpbi1wbGFjZSwgcmVtb3Zpbmcgc29tZSBudW1iZXIgb2YgZWxlbWVudHMgYW5kIGFkZGluZyBuZXdcbiAqIGVsZW1lbnRzIGRpcmVjdGx5IGZvbGxvd2luZyB0aGVtLlxuICpcbiAqIEBwYXJhbSB7QXJyYXl9IGFycmF5IFRhcmdldCBhcnJheSB0byBzcGxpY2UuXG4gKiBAcGFyYW0ge051bWJlcn0gc3BsaWNlSWR4IEluZGV4IGF0IHdoaWNoIHRvIGJlZ2luIGNoYW5naW5nIHRoZSBhcnJheS5cbiAqIEBwYXJhbSB7TnVtYmVyfSBzcGxpY2VDb3VudCBOdW1iZXIgb2YgZWxlbWVudHMgdG8gcmVtb3ZlIGZyb20gdGhlIGFycmF5LlxuICogQHBhcmFtIHtBcnJheX0gbmV3RWxlbXMgRWxlbWVudHMgdG8gaW5zZXJ0IGludG8gdGhlIGFycmF5LlxuICpcbiAqIEBhcGkgcHJpdmF0ZVxuICovXG52YXIgdW5pcXVlU3BsaWNlID0gZnVuY3Rpb24oYXJyYXksIHNwbGljZUlkeCwgc3BsaWNlQ291bnQsIG5ld0VsZW1zLCBwYXJlbnQpIHtcbiAgdmFyIHNwbGljZUFyZ3MgPSBbc3BsaWNlSWR4LCBzcGxpY2VDb3VudF0uY29uY2F0KG5ld0VsZW1zKSxcbiAgICAgIHByZXYgPSBhcnJheVtzcGxpY2VJZHggLSAxXSB8fCBudWxsLFxuICAgICAgbmV4dCA9IGFycmF5W3NwbGljZUlkeF0gfHwgbnVsbDtcbiAgdmFyIGlkeCwgbGVuLCBwcmV2SWR4LCBub2RlLCBvbGRQYXJlbnQ7XG5cbiAgLy8gQmVmb3JlIHNwbGljaW5nIGluIG5ldyBlbGVtZW50cywgZW5zdXJlIHRoZXkgZG8gbm90IGFscmVhZHkgYXBwZWFyIGluIHRoZVxuICAvLyBjdXJyZW50IGFycmF5LlxuICBmb3IgKGlkeCA9IDAsIGxlbiA9IG5ld0VsZW1zLmxlbmd0aDsgaWR4IDwgbGVuOyArK2lkeCkge1xuICAgIG5vZGUgPSBuZXdFbGVtc1tpZHhdO1xuICAgIG9sZFBhcmVudCA9IG5vZGUucGFyZW50IHx8IG5vZGUucm9vdDtcbiAgICBwcmV2SWR4ID0gb2xkUGFyZW50ICYmIG9sZFBhcmVudC5jaGlsZHJlbi5pbmRleE9mKG5ld0VsZW1zW2lkeF0pO1xuXG4gICAgaWYgKG9sZFBhcmVudCAmJiBwcmV2SWR4ID4gLTEpIHtcbiAgICAgIG9sZFBhcmVudC5jaGlsZHJlbi5zcGxpY2UocHJldklkeCwgMSk7XG4gICAgICBpZiAocGFyZW50ID09PSBvbGRQYXJlbnQgJiYgc3BsaWNlSWR4ID4gcHJldklkeCkge1xuICAgICAgICBzcGxpY2VBcmdzWzBdLS07XG4gICAgICB9XG4gICAgfVxuXG4gICAgbm9kZS5yb290ID0gbnVsbDtcbiAgICBub2RlLnBhcmVudCA9IHBhcmVudDtcblxuICAgIGlmIChub2RlLnByZXYpIHtcbiAgICAgIG5vZGUucHJldi5uZXh0ID0gbm9kZS5uZXh0IHx8IG51bGw7XG4gICAgfVxuXG4gICAgaWYgKG5vZGUubmV4dCkge1xuICAgICAgbm9kZS5uZXh0LnByZXYgPSBub2RlLnByZXYgfHwgbnVsbDtcbiAgICB9XG5cbiAgICBub2RlLnByZXYgPSBuZXdFbGVtc1tpZHggLSAxXSB8fCBwcmV2O1xuICAgIG5vZGUubmV4dCA9IG5ld0VsZW1zW2lkeCArIDFdIHx8IG5leHQ7XG4gIH1cblxuICBpZiAocHJldikge1xuICAgIHByZXYubmV4dCA9IG5ld0VsZW1zWzBdO1xuICB9XG4gIGlmIChuZXh0KSB7XG4gICAgbmV4dC5wcmV2ID0gbmV3RWxlbXNbbmV3RWxlbXMubGVuZ3RoIC0gMV07XG4gIH1cbiAgcmV0dXJuIGFycmF5LnNwbGljZS5hcHBseShhcnJheSwgc3BsaWNlQXJncyk7XG59O1xuXG5leHBvcnRzLmFwcGVuZFRvID0gZnVuY3Rpb24odGFyZ2V0KSB7XG4gIGlmICghdGFyZ2V0LmNoZWVyaW8pIHtcbiAgICB0YXJnZXQgPSB0aGlzLmNvbnN0cnVjdG9yLmNhbGwodGhpcy5jb25zdHJ1Y3RvciwgdGFyZ2V0LCBudWxsLCB0aGlzLl9vcmlnaW5hbFJvb3QpO1xuICB9XG5cbiAgdGFyZ2V0LmFwcGVuZCh0aGlzKTtcblxuICByZXR1cm4gdGhpcztcbn07XG5cbmV4cG9ydHMucHJlcGVuZFRvID0gZnVuY3Rpb24odGFyZ2V0KSB7XG4gIGlmICghdGFyZ2V0LmNoZWVyaW8pIHtcbiAgICB0YXJnZXQgPSB0aGlzLmNvbnN0cnVjdG9yLmNhbGwodGhpcy5jb25zdHJ1Y3RvciwgdGFyZ2V0LCBudWxsLCB0aGlzLl9vcmlnaW5hbFJvb3QpO1xuICB9XG5cbiAgdGFyZ2V0LnByZXBlbmQodGhpcyk7XG5cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5leHBvcnRzLmFwcGVuZCA9IF9pbnNlcnQoZnVuY3Rpb24oZG9tLCBjaGlsZHJlbiwgcGFyZW50KSB7XG4gIHVuaXF1ZVNwbGljZShjaGlsZHJlbiwgY2hpbGRyZW4ubGVuZ3RoLCAwLCBkb20sIHBhcmVudCk7XG59KTtcblxuZXhwb3J0cy5wcmVwZW5kID0gX2luc2VydChmdW5jdGlvbihkb20sIGNoaWxkcmVuLCBwYXJlbnQpIHtcbiAgdW5pcXVlU3BsaWNlKGNoaWxkcmVuLCAwLCAwLCBkb20sIHBhcmVudCk7XG59KTtcblxuZXhwb3J0cy53cmFwID0gZnVuY3Rpb24od3JhcHBlcikge1xuICB2YXIgd3JhcHBlckZuID0gdHlwZW9mIHdyYXBwZXIgPT09ICdmdW5jdGlvbicgJiYgd3JhcHBlcixcbiAgICAgIGxhc3RJZHggPSB0aGlzLmxlbmd0aCAtIDE7XG5cbiAgXy5mb3JFYWNoKHRoaXMsIF8uYmluZChmdW5jdGlvbihlbCwgaSkge1xuICAgIHZhciBwYXJlbnQgPSBlbC5wYXJlbnQgfHwgZWwucm9vdCxcbiAgICAgICAgc2libGluZ3MgPSBwYXJlbnQuY2hpbGRyZW4sXG4gICAgICAgIHdyYXBwZXJEb20sIGVsSW5zZXJ0TG9jYXRpb24sIGosIGluZGV4O1xuXG4gICAgaWYgKCFwYXJlbnQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAod3JhcHBlckZuKSB7XG4gICAgICB3cmFwcGVyID0gd3JhcHBlckZuLmNhbGwoZWwsIGkpO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2Ygd3JhcHBlciA9PT0gJ3N0cmluZycgJiYgIWlzSHRtbCh3cmFwcGVyKSkge1xuICAgICAgd3JhcHBlciA9IHRoaXMucGFyZW50cygpLmxhc3QoKS5maW5kKHdyYXBwZXIpLmNsb25lKCk7XG4gICAgfVxuXG4gICAgd3JhcHBlckRvbSA9IHRoaXMuX21ha2VEb21BcnJheSh3cmFwcGVyLCBpIDwgbGFzdElkeCkuc2xpY2UoMCwgMSk7XG4gICAgZWxJbnNlcnRMb2NhdGlvbiA9IHdyYXBwZXJEb21bMF07XG4gICAgLy8gRmluZCB0aGUgZGVlcGVzdCBjaGlsZC4gT25seSBjb25zaWRlciB0aGUgZmlyc3QgdGFnIGNoaWxkIG9mIGVhY2ggbm9kZVxuICAgIC8vIChpZ25vcmUgdGV4dCk7IHN0b3AgaWYgbm8gY2hpbGRyZW4gYXJlIGZvdW5kLlxuICAgIGogPSAwO1xuXG4gICAgd2hpbGUgKGVsSW5zZXJ0TG9jYXRpb24gJiYgZWxJbnNlcnRMb2NhdGlvbi5jaGlsZHJlbikge1xuICAgICAgaWYgKGogPj0gZWxJbnNlcnRMb2NhdGlvbi5jaGlsZHJlbi5sZW5ndGgpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG5cbiAgICAgIGlmIChlbEluc2VydExvY2F0aW9uLmNoaWxkcmVuW2pdLnR5cGUgPT09ICd0YWcnKSB7XG4gICAgICAgIGVsSW5zZXJ0TG9jYXRpb24gPSBlbEluc2VydExvY2F0aW9uLmNoaWxkcmVuW2pdO1xuICAgICAgICBqPTA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBqKys7XG4gICAgICB9XG4gICAgfVxuICAgIGluZGV4ID0gc2libGluZ3MuaW5kZXhPZihlbCk7XG5cbiAgICB1cGRhdGVET00oW2VsXSwgZWxJbnNlcnRMb2NhdGlvbik7XG4gICAgLy8gVGhlIHByZXZpb3VzIG9wZXJhdGlvbiByZW1vdmVkIHRoZSBjdXJyZW50IGVsZW1lbnQgZnJvbSB0aGUgYHNpYmxpbmdzYFxuICAgIC8vIGFycmF5LCBzbyB0aGUgYGRvbWAgYXJyYXkgY2FuIGJlIGluc2VydGVkIHdpdGhvdXQgcmVtb3ZpbmcgYW55XG4gICAgLy8gYWRkaXRpb25hbCBlbGVtZW50cy5cbiAgICB1bmlxdWVTcGxpY2Uoc2libGluZ3MsIGluZGV4LCAwLCB3cmFwcGVyRG9tLCBwYXJlbnQpO1xuICB9LCB0aGlzKSk7XG5cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5leHBvcnRzLmFmdGVyID0gZnVuY3Rpb24oKSB7XG4gIHZhciBlbGVtcyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzKSxcbiAgICAgIGxhc3RJZHggPSB0aGlzLmxlbmd0aCAtIDE7XG5cbiAgZG9tRWFjaCh0aGlzLCBmdW5jdGlvbihpLCBlbCkge1xuICAgIHZhciBwYXJlbnQgPSBlbC5wYXJlbnQgfHwgZWwucm9vdDtcbiAgICBpZiAoIXBhcmVudCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBzaWJsaW5ncyA9IHBhcmVudC5jaGlsZHJlbixcbiAgICAgICAgaW5kZXggPSBzaWJsaW5ncy5pbmRleE9mKGVsKSxcbiAgICAgICAgZG9tU3JjLCBkb207XG5cbiAgICAvLyBJZiBub3QgZm91bmQsIG1vdmUgb25cbiAgICBpZiAoaW5kZXggPCAwKSByZXR1cm47XG5cbiAgICBpZiAodHlwZW9mIGVsZW1zWzBdID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBkb21TcmMgPSBlbGVtc1swXS5jYWxsKGVsLCBpLCAkLmh0bWwoZWwuY2hpbGRyZW4pKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZG9tU3JjID0gZWxlbXM7XG4gICAgfVxuICAgIGRvbSA9IHRoaXMuX21ha2VEb21BcnJheShkb21TcmMsIGkgPCBsYXN0SWR4KTtcblxuICAgIC8vIEFkZCBlbGVtZW50IGFmdGVyIGB0aGlzYCBlbGVtZW50XG4gICAgdW5pcXVlU3BsaWNlKHNpYmxpbmdzLCBpbmRleCArIDEsIDAsIGRvbSwgcGFyZW50KTtcbiAgfSk7XG5cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5leHBvcnRzLmluc2VydEFmdGVyID0gZnVuY3Rpb24odGFyZ2V0KSB7XG4gIHZhciBjbG9uZXMgPSBbXSxcbiAgICAgIHNlbGYgPSB0aGlzO1xuICBpZiAodHlwZW9mIHRhcmdldCA9PT0gJ3N0cmluZycpIHtcbiAgICB0YXJnZXQgPSB0aGlzLmNvbnN0cnVjdG9yLmNhbGwodGhpcy5jb25zdHJ1Y3RvciwgdGFyZ2V0LCBudWxsLCB0aGlzLl9vcmlnaW5hbFJvb3QpO1xuICB9XG4gIHRhcmdldCA9IHRoaXMuX21ha2VEb21BcnJheSh0YXJnZXQpO1xuICBzZWxmLnJlbW92ZSgpO1xuICBkb21FYWNoKHRhcmdldCwgZnVuY3Rpb24oaSwgZWwpIHtcbiAgICB2YXIgY2xvbmVkU2VsZiA9IHNlbGYuX21ha2VEb21BcnJheShzZWxmLmNsb25lKCkpO1xuICAgIHZhciBwYXJlbnQgPSBlbC5wYXJlbnQgfHwgZWwucm9vdDtcbiAgICBpZiAoIXBhcmVudCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBzaWJsaW5ncyA9IHBhcmVudC5jaGlsZHJlbixcbiAgICAgICAgaW5kZXggPSBzaWJsaW5ncy5pbmRleE9mKGVsKTtcblxuICAgIC8vIElmIG5vdCBmb3VuZCwgbW92ZSBvblxuICAgIGlmIChpbmRleCA8IDApIHJldHVybjtcblxuICAgIC8vIEFkZCBjbG9uZWQgYHRoaXNgIGVsZW1lbnQocykgYWZ0ZXIgdGFyZ2V0IGVsZW1lbnRcbiAgICB1bmlxdWVTcGxpY2Uoc2libGluZ3MsIGluZGV4ICsgMSwgMCwgY2xvbmVkU2VsZiwgcGFyZW50KTtcbiAgICBjbG9uZXMucHVzaChjbG9uZWRTZWxmKTtcbiAgfSk7XG4gIHJldHVybiB0aGlzLmNvbnN0cnVjdG9yLmNhbGwodGhpcy5jb25zdHJ1Y3RvciwgdGhpcy5fbWFrZURvbUFycmF5KGNsb25lcykpO1xufTtcblxuZXhwb3J0cy5iZWZvcmUgPSBmdW5jdGlvbigpIHtcbiAgdmFyIGVsZW1zID0gc2xpY2UuY2FsbChhcmd1bWVudHMpLFxuICAgICAgbGFzdElkeCA9IHRoaXMubGVuZ3RoIC0gMTtcblxuICBkb21FYWNoKHRoaXMsIGZ1bmN0aW9uKGksIGVsKSB7XG4gICAgdmFyIHBhcmVudCA9IGVsLnBhcmVudCB8fCBlbC5yb290O1xuICAgIGlmICghcGFyZW50KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIHNpYmxpbmdzID0gcGFyZW50LmNoaWxkcmVuLFxuICAgICAgICBpbmRleCA9IHNpYmxpbmdzLmluZGV4T2YoZWwpLFxuICAgICAgICBkb21TcmMsIGRvbTtcblxuICAgIC8vIElmIG5vdCBmb3VuZCwgbW92ZSBvblxuICAgIGlmIChpbmRleCA8IDApIHJldHVybjtcblxuICAgIGlmICh0eXBlb2YgZWxlbXNbMF0gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGRvbVNyYyA9IGVsZW1zWzBdLmNhbGwoZWwsIGksICQuaHRtbChlbC5jaGlsZHJlbikpO1xuICAgIH0gZWxzZSB7XG4gICAgICBkb21TcmMgPSBlbGVtcztcbiAgICB9XG5cbiAgICBkb20gPSB0aGlzLl9tYWtlRG9tQXJyYXkoZG9tU3JjLCBpIDwgbGFzdElkeCk7XG5cbiAgICAvLyBBZGQgZWxlbWVudCBiZWZvcmUgYGVsYCBlbGVtZW50XG4gICAgdW5pcXVlU3BsaWNlKHNpYmxpbmdzLCBpbmRleCwgMCwgZG9tLCBwYXJlbnQpO1xuICB9KTtcblxuICByZXR1cm4gdGhpcztcbn07XG5cbmV4cG9ydHMuaW5zZXJ0QmVmb3JlID0gZnVuY3Rpb24odGFyZ2V0KSB7XG4gIHZhciBjbG9uZXMgPSBbXSxcbiAgICAgIHNlbGYgPSB0aGlzO1xuICBpZiAodHlwZW9mIHRhcmdldCA9PT0gJ3N0cmluZycpIHtcbiAgICB0YXJnZXQgPSB0aGlzLmNvbnN0cnVjdG9yLmNhbGwodGhpcy5jb25zdHJ1Y3RvciwgdGFyZ2V0LCBudWxsLCB0aGlzLl9vcmlnaW5hbFJvb3QpO1xuICB9XG4gIHRhcmdldCA9IHRoaXMuX21ha2VEb21BcnJheSh0YXJnZXQpO1xuICBzZWxmLnJlbW92ZSgpO1xuICBkb21FYWNoKHRhcmdldCwgZnVuY3Rpb24oaSwgZWwpIHtcbiAgICB2YXIgY2xvbmVkU2VsZiA9IHNlbGYuX21ha2VEb21BcnJheShzZWxmLmNsb25lKCkpO1xuICAgIHZhciBwYXJlbnQgPSBlbC5wYXJlbnQgfHwgZWwucm9vdDtcbiAgICBpZiAoIXBhcmVudCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBzaWJsaW5ncyA9IHBhcmVudC5jaGlsZHJlbixcbiAgICAgICAgaW5kZXggPSBzaWJsaW5ncy5pbmRleE9mKGVsKTtcblxuICAgIC8vIElmIG5vdCBmb3VuZCwgbW92ZSBvblxuICAgIGlmIChpbmRleCA8IDApIHJldHVybjtcblxuICAgIC8vIEFkZCBjbG9uZWQgYHRoaXNgIGVsZW1lbnQocykgYWZ0ZXIgdGFyZ2V0IGVsZW1lbnRcbiAgICB1bmlxdWVTcGxpY2Uoc2libGluZ3MsIGluZGV4LCAwLCBjbG9uZWRTZWxmLCBwYXJlbnQpO1xuICAgIGNsb25lcy5wdXNoKGNsb25lZFNlbGYpO1xuICB9KTtcbiAgcmV0dXJuIHRoaXMuY29uc3RydWN0b3IuY2FsbCh0aGlzLmNvbnN0cnVjdG9yLCB0aGlzLl9tYWtlRG9tQXJyYXkoY2xvbmVzKSk7XG59O1xuXG4vKlxuICByZW1vdmUoW3NlbGVjdG9yXSlcbiovXG5leHBvcnRzLnJlbW92ZSA9IGZ1bmN0aW9uKHNlbGVjdG9yKSB7XG4gIHZhciBlbGVtcyA9IHRoaXM7XG5cbiAgLy8gRmlsdGVyIGlmIHdlIGhhdmUgc2VsZWN0b3JcbiAgaWYgKHNlbGVjdG9yKVxuICAgIGVsZW1zID0gZWxlbXMuZmlsdGVyKHNlbGVjdG9yKTtcblxuICBkb21FYWNoKGVsZW1zLCBmdW5jdGlvbihpLCBlbCkge1xuICAgIHZhciBwYXJlbnQgPSBlbC5wYXJlbnQgfHwgZWwucm9vdDtcbiAgICBpZiAoIXBhcmVudCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBzaWJsaW5ncyA9IHBhcmVudC5jaGlsZHJlbixcbiAgICAgICAgaW5kZXggPSBzaWJsaW5ncy5pbmRleE9mKGVsKTtcblxuICAgIGlmIChpbmRleCA8IDApIHJldHVybjtcblxuICAgIHNpYmxpbmdzLnNwbGljZShpbmRleCwgMSk7XG4gICAgaWYgKGVsLnByZXYpIHtcbiAgICAgIGVsLnByZXYubmV4dCA9IGVsLm5leHQ7XG4gICAgfVxuICAgIGlmIChlbC5uZXh0KSB7XG4gICAgICBlbC5uZXh0LnByZXYgPSBlbC5wcmV2O1xuICAgIH1cbiAgICBlbC5wcmV2ID0gZWwubmV4dCA9IGVsLnBhcmVudCA9IGVsLnJvb3QgPSBudWxsO1xuICB9KTtcblxuICByZXR1cm4gdGhpcztcbn07XG5cbmV4cG9ydHMucmVwbGFjZVdpdGggPSBmdW5jdGlvbihjb250ZW50KSB7XG4gIHZhciBzZWxmID0gdGhpcztcblxuICBkb21FYWNoKHRoaXMsIGZ1bmN0aW9uKGksIGVsKSB7XG4gICAgdmFyIHBhcmVudCA9IGVsLnBhcmVudCB8fCBlbC5yb290O1xuICAgIGlmICghcGFyZW50KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIHNpYmxpbmdzID0gcGFyZW50LmNoaWxkcmVuLFxuICAgICAgICBkb20gPSBzZWxmLl9tYWtlRG9tQXJyYXkodHlwZW9mIGNvbnRlbnQgPT09ICdmdW5jdGlvbicgPyBjb250ZW50LmNhbGwoZWwsIGksIGVsKSA6IGNvbnRlbnQpLFxuICAgICAgICBpbmRleDtcblxuICAgIC8vIEluIHRoZSBjYXNlIHRoYXQgYGRvbWAgY29udGFpbnMgbm9kZXMgdGhhdCBhbHJlYWR5IGV4aXN0IGluIG90aGVyXG4gICAgLy8gc3RydWN0dXJlcywgZW5zdXJlIHRob3NlIG5vZGVzIGFyZSBwcm9wZXJseSByZW1vdmVkLlxuICAgIHVwZGF0ZURPTShkb20sIG51bGwpO1xuXG4gICAgaW5kZXggPSBzaWJsaW5ncy5pbmRleE9mKGVsKTtcblxuICAgIC8vIENvbXBsZXRlbHkgcmVtb3ZlIG9sZCBlbGVtZW50XG4gICAgdW5pcXVlU3BsaWNlKHNpYmxpbmdzLCBpbmRleCwgMSwgZG9tLCBwYXJlbnQpO1xuICAgIGVsLnBhcmVudCA9IGVsLnByZXYgPSBlbC5uZXh0ID0gZWwucm9vdCA9IG51bGw7XG4gIH0pO1xuXG4gIHJldHVybiB0aGlzO1xufTtcblxuZXhwb3J0cy5lbXB0eSA9IGZ1bmN0aW9uKCkge1xuICBkb21FYWNoKHRoaXMsIGZ1bmN0aW9uKGksIGVsKSB7XG4gICAgXy5mb3JFYWNoKGVsLmNoaWxkcmVuLCBmdW5jdGlvbihjaGlsZCkge1xuICAgICAgY2hpbGQubmV4dCA9IGNoaWxkLnByZXYgPSBjaGlsZC5wYXJlbnQgPSBudWxsO1xuICAgIH0pO1xuXG4gICAgZWwuY2hpbGRyZW4ubGVuZ3RoID0gMDtcbiAgfSk7XG4gIHJldHVybiB0aGlzO1xufTtcblxuLyoqXG4gKiBTZXQvR2V0IHRoZSBIVE1MXG4gKi9cbmV4cG9ydHMuaHRtbCA9IGZ1bmN0aW9uKHN0cikge1xuICBpZiAoc3RyID09PSB1bmRlZmluZWQpIHtcbiAgICBpZiAoIXRoaXNbMF0gfHwgIXRoaXNbMF0uY2hpbGRyZW4pIHJldHVybiBudWxsO1xuICAgIHJldHVybiAkLmh0bWwodGhpc1swXS5jaGlsZHJlbiwgdGhpcy5vcHRpb25zKTtcbiAgfVxuXG4gIHZhciBvcHRzID0gdGhpcy5vcHRpb25zO1xuXG4gIGRvbUVhY2godGhpcywgZnVuY3Rpb24oaSwgZWwpIHtcbiAgICBfLmZvckVhY2goZWwuY2hpbGRyZW4sIGZ1bmN0aW9uKGNoaWxkKSB7XG4gICAgICBjaGlsZC5uZXh0ID0gY2hpbGQucHJldiA9IGNoaWxkLnBhcmVudCA9IG51bGw7XG4gICAgfSk7XG5cbiAgICB2YXIgY29udGVudCA9IHN0ci5jaGVlcmlvID8gc3RyLmNsb25lKCkuZ2V0KCkgOiBldmFsdWF0ZSgnJyArIHN0ciwgb3B0cywgZmFsc2UpO1xuXG4gICAgdXBkYXRlRE9NKGNvbnRlbnQsIGVsKTtcbiAgfSk7XG5cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5leHBvcnRzLnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiAkLmh0bWwodGhpcywgdGhpcy5vcHRpb25zKTtcbn07XG5cbmV4cG9ydHMudGV4dCA9IGZ1bmN0aW9uKHN0cikge1xuICAvLyBJZiBgc3RyYCBpcyB1bmRlZmluZWQsIGFjdCBhcyBhIFwiZ2V0dGVyXCJcbiAgaWYgKHN0ciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0dXJuICQudGV4dCh0aGlzKTtcbiAgfSBlbHNlIGlmICh0eXBlb2Ygc3RyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgLy8gRnVuY3Rpb24gc3VwcG9ydFxuICAgIHJldHVybiBkb21FYWNoKHRoaXMsIGZ1bmN0aW9uKGksIGVsKSB7XG4gICAgICB2YXIgJGVsID0gW2VsXTtcbiAgICAgIHJldHVybiBleHBvcnRzLnRleHQuY2FsbCgkZWwsIHN0ci5jYWxsKGVsLCBpLCAkLnRleHQoJGVsKSkpO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gQXBwZW5kIHRleHQgbm9kZSB0byBlYWNoIHNlbGVjdGVkIGVsZW1lbnRzXG4gIGRvbUVhY2godGhpcywgZnVuY3Rpb24oaSwgZWwpIHtcbiAgICBfLmZvckVhY2goZWwuY2hpbGRyZW4sIGZ1bmN0aW9uKGNoaWxkKSB7XG4gICAgICBjaGlsZC5uZXh0ID0gY2hpbGQucHJldiA9IGNoaWxkLnBhcmVudCA9IG51bGw7XG4gICAgfSk7XG5cbiAgICB2YXIgZWxlbSA9IHtcbiAgICAgIGRhdGE6ICcnICsgc3RyLFxuICAgICAgdHlwZTogJ3RleHQnLFxuICAgICAgcGFyZW50OiBlbCxcbiAgICAgIHByZXY6IG51bGwsXG4gICAgICBuZXh0OiBudWxsLFxuICAgICAgY2hpbGRyZW46IFtdXG4gICAgfTtcblxuICAgIHVwZGF0ZURPTShlbGVtLCBlbCk7XG4gIH0pO1xuXG4gIHJldHVybiB0aGlzO1xufTtcblxuZXhwb3J0cy5jbG9uZSA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gdGhpcy5fbWFrZShjbG9uZURvbSh0aGlzLmdldCgpLCB0aGlzLm9wdGlvbnMpKTtcbn07XG4iXX0=