93bb301064711747d36a79b3158bd127
"use strict";

module.exports = parse;
var re_name = /^(?:\\.|[\w\-\u00b0-\uFFFF])+/,
    re_escape = /\\([\da-f]{1,6}\s?|(\s)|.)/ig,
    //modified version of https://github.com/jquery/sizzle/blob/master/src/sizzle.js#L87
re_attr = /^\s*((?:\\.|[\w\u00b0-\uFFFF\-])+)\s*(?:(\S?)=\s*(?:(['"])([^]*?)\3|(#?(?:\\.|[\w\u00b0-\uFFFF\-])*)|)|)\s*(i)?\]/;
var actionTypes = {
  __proto__: null,
  "undefined": "exists",
  "": "equals",
  "~": "element",
  "^": "start",
  "$": "end",
  "*": "any",
  "!": "not",
  "|": "hyphen"
};
var simpleSelectors = {
  __proto__: null,
  ">": "child",
  "<": "parent",
  "~": "sibling",
  "+": "adjacent"
};
var attribSelectors = {
  __proto__: null,
  "#": ["id", "equals"],
  ".": ["class", "element"]
}; //pseudos, whose data-property is parsed as well

var unpackPseudos = {
  __proto__: null,
  "has": true,
  "not": true,
  "matches": true
};
var stripQuotesFromPseudos = {
  __proto__: null,
  "contains": true,
  "icontains": true
};
var quotes = {
  __proto__: null,
  "\"": true,
  "'": true
}; //unescape function taken from https://github.com/jquery/sizzle/blob/master/src/sizzle.js#L139

function funescape(_, escaped, escapedWhitespace) {
  var high = "0x" + escaped - 0x10000; // NaN means non-codepoint
  // Support: Firefox
  // Workaround erroneous numeric interpretation of +"0x"

  return high !== high || escapedWhitespace ? escaped : // BMP codepoint
  high < 0 ? String.fromCharCode(high + 0x10000) : // Supplemental Plane codepoint (surrogate pair)
  String.fromCharCode(high >> 10 | 0xD800, high & 0x3FF | 0xDC00);
}

function unescapeCSS(str) {
  return str.replace(re_escape, funescape);
}

function isWhitespace(c) {
  return c === " " || c === "\n" || c === "\t" || c === "\f" || c === "\r";
}

function parse(selector, options) {
  var subselects = [];
  selector = parseSelector(subselects, selector + "", options);

  if (selector !== "") {
    throw new SyntaxError("Unmatched selector: " + selector);
  }

  return subselects;
}

function parseSelector(subselects, selector, options) {
  var tokens = [],
      sawWS = false,
      data,
      firstChar,
      name,
      quot;

  function getName() {
    var sub = selector.match(re_name)[0];
    selector = selector.substr(sub.length);
    return unescapeCSS(sub);
  }

  function stripWhitespace(start) {
    while (isWhitespace(selector.charAt(start))) start++;

    selector = selector.substr(start);
  }

  function isEscaped(pos) {
    var slashCount = 0;

    while (selector.charAt(--pos) === "\\") slashCount++;

    return (slashCount & 1) === 1;
  }

  stripWhitespace(0);

  while (selector !== "") {
    firstChar = selector.charAt(0);

    if (isWhitespace(firstChar)) {
      sawWS = true;
      stripWhitespace(1);
    } else if (firstChar in simpleSelectors) {
      tokens.push({
        type: simpleSelectors[firstChar]
      });
      sawWS = false;
      stripWhitespace(1);
    } else if (firstChar === ",") {
      if (tokens.length === 0) {
        throw new SyntaxError("empty sub-selector");
      }

      subselects.push(tokens);
      tokens = [];
      sawWS = false;
      stripWhitespace(1);
    } else {
      if (sawWS) {
        if (tokens.length > 0) {
          tokens.push({
            type: "descendant"
          });
        }

        sawWS = false;
      }

      if (firstChar === "*") {
        selector = selector.substr(1);
        tokens.push({
          type: "universal"
        });
      } else if (firstChar in attribSelectors) {
        selector = selector.substr(1);
        tokens.push({
          type: "attribute",
          name: attribSelectors[firstChar][0],
          action: attribSelectors[firstChar][1],
          value: getName(),
          ignoreCase: false
        });
      } else if (firstChar === "[") {
        selector = selector.substr(1);
        data = selector.match(re_attr);

        if (!data) {
          throw new SyntaxError("Malformed attribute selector: " + selector);
        }

        selector = selector.substr(data[0].length);
        name = unescapeCSS(data[1]);

        if (!options || ("lowerCaseAttributeNames" in options ? options.lowerCaseAttributeNames : !options.xmlMode)) {
          name = name.toLowerCase();
        }

        tokens.push({
          type: "attribute",
          name: name,
          action: actionTypes[data[2]],
          value: unescapeCSS(data[4] || data[5] || ""),
          ignoreCase: !!data[6]
        });
      } else if (firstChar === ":") {
        if (selector.charAt(1) === ":") {
          selector = selector.substr(2);
          tokens.push({
            type: "pseudo-element",
            name: getName().toLowerCase()
          });
          continue;
        }

        selector = selector.substr(1);
        name = getName().toLowerCase();
        data = null;

        if (selector.charAt(0) === "(") {
          if (name in unpackPseudos) {
            quot = selector.charAt(1);
            var quoted = (quot in quotes);
            selector = selector.substr(quoted + 1);
            data = [];
            selector = parseSelector(data, selector, options);

            if (quoted) {
              if (selector.charAt(0) !== quot) {
                throw new SyntaxError("unmatched quotes in :" + name);
              } else {
                selector = selector.substr(1);
              }
            }

            if (selector.charAt(0) !== ")") {
              throw new SyntaxError("missing closing parenthesis in :" + name + " " + selector);
            }

            selector = selector.substr(1);
          } else {
            var pos = 1,
                counter = 1;

            for (; counter > 0 && pos < selector.length; pos++) {
              if (selector.charAt(pos) === "(" && !isEscaped(pos)) counter++;else if (selector.charAt(pos) === ")" && !isEscaped(pos)) counter--;
            }

            if (counter) {
              throw new SyntaxError("parenthesis not matched");
            }

            data = selector.substr(1, pos - 2);
            selector = selector.substr(pos);

            if (name in stripQuotesFromPseudos) {
              quot = data.charAt(0);

              if (quot === data.slice(-1) && quot in quotes) {
                data = data.slice(1, -1);
              }

              data = unescapeCSS(data);
            }
          }
        }

        tokens.push({
          type: "pseudo",
          name: name,
          data: data
        });
      } else if (re_name.test(selector)) {
        name = getName();

        if (!options || ("lowerCaseTags" in options ? options.lowerCaseTags : !options.xmlMode)) {
          name = name.toLowerCase();
        }

        tokens.push({
          type: "tag",
          name: name
        });
      } else {
        if (tokens.length && tokens[tokens.length - 1].type === "descendant") {
          tokens.pop();
        }

        addToken(subselects, tokens);
        return selector;
      }
    }
  }

  addToken(subselects, tokens);
  return selector;
}

function addToken(subselects, tokens) {
  if (subselects.length > 0 && tokens.length === 0) {
    throw new SyntaxError("empty sub-selector");
  }

  subselects.push(tokens);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIm1vZHVsZSIsImV4cG9ydHMiLCJwYXJzZSIsInJlX25hbWUiLCJyZV9lc2NhcGUiLCJyZV9hdHRyIiwiYWN0aW9uVHlwZXMiLCJfX3Byb3RvX18iLCJzaW1wbGVTZWxlY3RvcnMiLCJhdHRyaWJTZWxlY3RvcnMiLCJ1bnBhY2tQc2V1ZG9zIiwic3RyaXBRdW90ZXNGcm9tUHNldWRvcyIsInF1b3RlcyIsImZ1bmVzY2FwZSIsIl8iLCJlc2NhcGVkIiwiZXNjYXBlZFdoaXRlc3BhY2UiLCJoaWdoIiwiU3RyaW5nIiwiZnJvbUNoYXJDb2RlIiwidW5lc2NhcGVDU1MiLCJzdHIiLCJyZXBsYWNlIiwiaXNXaGl0ZXNwYWNlIiwiYyIsInNlbGVjdG9yIiwib3B0aW9ucyIsInN1YnNlbGVjdHMiLCJwYXJzZVNlbGVjdG9yIiwiU3ludGF4RXJyb3IiLCJ0b2tlbnMiLCJzYXdXUyIsImRhdGEiLCJmaXJzdENoYXIiLCJuYW1lIiwicXVvdCIsImdldE5hbWUiLCJzdWIiLCJtYXRjaCIsInN1YnN0ciIsImxlbmd0aCIsInN0cmlwV2hpdGVzcGFjZSIsInN0YXJ0IiwiY2hhckF0IiwiaXNFc2NhcGVkIiwicG9zIiwic2xhc2hDb3VudCIsInB1c2giLCJ0eXBlIiwiYWN0aW9uIiwidmFsdWUiLCJpZ25vcmVDYXNlIiwibG93ZXJDYXNlQXR0cmlidXRlTmFtZXMiLCJ4bWxNb2RlIiwidG9Mb3dlckNhc2UiLCJxdW90ZWQiLCJjb3VudGVyIiwic2xpY2UiLCJ0ZXN0IiwibG93ZXJDYXNlVGFncyIsInBvcCIsImFkZFRva2VuIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQUEsTUFBTSxDQUFDQyxPQUFQLEdBQWlCQyxLQUFqQjtBQUVBLElBQUlDLE9BQU8sR0FBRywrQkFBZDtBQUFBLElBQ0lDLFNBQVMsR0FBRyw4QkFEaEI7QUFBQSxJQUVJO0FBQ0FDLE9BQU8sR0FBRyxtSEFIZDtBQUtBLElBQUlDLFdBQVcsR0FBRztBQUNqQkMsRUFBQUEs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Q0FBQ0EsTUFBTSxDQUFDVSxNQUFQLEdBQWdCLENBQWpCLENBQU4sQ0FBMEJRLElBQTFCLEtBQW1DLFlBQXZELEVBQW9FO0FBQ25FbEIsVUFBQUEsTUFBTSxDQUFDOEIsR0FBUDtBQUNBOztBQUNEQyxRQUFBQSxRQUFRLENBQUNsQyxVQUFELEVBQWFHLE1BQWIsQ0FBUjtBQUNBLGVBQU9MLFFBQVA7QUFDQTtBQUNEO0FBQ0Q7O0FBRURvQyxFQUFBQSxRQUFRLENBQUNsQyxVQUFELEVBQWFHLE1BQWIsQ0FBUjtBQUVBLFNBQU9MLFFBQVA7QUFDQTs7QUFFRCxTQUFTb0MsUUFBVCxDQUFrQmxDLFVBQWxCLEVBQThCRyxNQUE5QixFQUFxQztBQUNwQyxNQUFHSCxVQUFVLENBQUNhLE1BQVgsR0FBb0IsQ0FBcEIsSUFBeUJWLE1BQU0sQ0FBQ1UsTUFBUCxLQUFrQixDQUE5QyxFQUFnRDtBQUMvQyxVQUFNLElBQUlYLFdBQUosQ0FBZ0Isb0JBQWhCLENBQU47QUFDQTs7QUFFREYsRUFBQUEsVUFBVSxDQUFDb0IsSUFBWCxDQUFnQmpCLE1BQWhCO0FBQ0EiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxubW9kdWxlLmV4cG9ydHMgPSBwYXJzZTtcblxudmFyIHJlX25hbWUgPSAvXig/OlxcXFwufFtcXHdcXC1cXHUwMGIwLVxcdUZGRkZdKSsvLFxuICAgIHJlX2VzY2FwZSA9IC9cXFxcKFtcXGRhLWZdezEsNn1cXHM/fChcXHMpfC4pL2lnLFxuICAgIC8vbW9kaWZpZWQgdmVyc2lvbiBvZiBodHRwczovL2dpdGh1Yi5jb20vanF1ZXJ5L3NpenpsZS9ibG9iL21hc3Rlci9zcmMvc2l6emxlLmpzI0w4N1xuICAgIHJlX2F0dHIgPSAvXlxccyooKD86XFxcXC58W1xcd1xcdTAwYjAtXFx1RkZGRlxcLV0pKylcXHMqKD86KFxcUz8pPVxccyooPzooWydcIl0pKFteXSo/KVxcM3woIz8oPzpcXFxcLnxbXFx3XFx1MDBiMC1cXHVGRkZGXFwtXSkqKXwpfClcXHMqKGkpP1xcXS87XG5cbnZhciBhY3Rpb25UeXBlcyA9IHtcblx0X19wcm90b19fOiBudWxsLFxuXHRcInVuZGVmaW5lZFwiOiBcImV4aXN0c1wiLFxuXHRcIlwiOiAgXCJlcXVhbHNcIixcblx0XCJ+XCI6IFwiZWxlbWVudFwiLFxuXHRcIl5cIjogXCJzdGFydFwiLFxuXHRcIiRcIjogXCJlbmRcIixcblx0XCIqXCI6IFwiYW55XCIsXG5cdFwiIVwiOiBcIm5vdFwiLFxuXHRcInxcIjogXCJoeXBoZW5cIlxufTtcblxudmFyIHNpbXBsZVNlbGVjdG9ycyA9IHtcblx0X19wcm90b19fOiBudWxsLFxuXHRcIj5cIjogXCJjaGlsZFwiLFxuXHRcIjxcIjogXCJwYXJlbnRcIixcblx0XCJ+XCI6IFwic2libGluZ1wiLFxuXHRcIitcIjogXCJhZGphY2VudFwiXG59O1xuXG52YXIgYXR0cmliU2VsZWN0b3JzID0ge1xuXHRfX3Byb3RvX186IG51bGwsXG5cdFwiI1wiOiBbXCJpZFwiLCBcImVxdWFsc1wiXSxcblx0XCIuXCI6IFtcImNsYXNzXCIsIFwiZWxlbWVudFwiXVxufTtcblxuLy9wc2V1ZG9zLCB3aG9zZSBkYXRhLXByb3BlcnR5IGlzIHBhcnNlZCBhcyB3ZWxsXG52YXIgdW5wYWNrUHNldWRvcyA9IHtcblx0X19wcm90b19fOiBudWxsLFxuXHRcImhhc1wiOiB0cnVlLFxuXHRcIm5vdFwiOiB0cnVlLFxuXHRcIm1hdGNoZXNcIjogdHJ1ZVxufTtcblxudmFyIHN0cmlwUXVvdGVzRnJvbVBzZXVkb3MgPSB7XG5cdF9fcHJvdG9fXzogbnVsbCxcblx0XCJjb250YWluc1wiOiB0cnVlLFxuXHRcImljb250YWluc1wiOiB0cnVlXG59O1xuXG52YXIgcXVvdGVzID0ge1xuXHRfX3Byb3RvX186IG51bGwsXG5cdFwiXFxcIlwiOiB0cnVlLFxuXHRcIidcIjogdHJ1ZVxufTtcblxuLy91bmVzY2FwZSBmdW5jdGlvbiB0YWtlbiBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9qcXVlcnkvc2l6emxlL2Jsb2IvbWFzdGVyL3NyYy9zaXp6bGUuanMjTDEzOVxuZnVuY3Rpb24gZnVuZXNjYXBlKCBfLCBlc2NhcGVkLCBlc2NhcGVkV2hpdGVzcGFjZSApIHtcblx0dmFyIGhpZ2ggPSBcIjB4XCIgKyBlc2NhcGVkIC0gMHgxMDAwMDtcblx0Ly8gTmFOIG1lYW5zIG5vbi1jb2RlcG9pbnRcblx0Ly8gU3VwcG9ydDogRmlyZWZveFxuXHQvLyBXb3JrYXJvdW5kIGVycm9uZW91cyBudW1lcmljIGludGVycHJldGF0aW9uIG9mICtcIjB4XCJcblx0cmV0dXJuIGhpZ2ggIT09IGhpZ2ggfHwgZXNjYXBlZFdoaXRlc3BhY2UgP1xuXHRcdGVzY2FwZWQgOlxuXHRcdC8vIEJNUCBjb2RlcG9pbnRcblx0XHRoaWdoIDwgMCA/XG5cdFx0XHRTdHJpbmcuZnJvbUNoYXJDb2RlKCBoaWdoICsgMHgxMDAwMCApIDpcblx0XHRcdC8vIFN1cHBsZW1lbnRhbCBQbGFuZSBjb2RlcG9pbnQgKHN1cnJvZ2F0ZSBwYWlyKVxuXHRcdFx0U3RyaW5nLmZyb21DaGFyQ29kZSggaGlnaCA+PiAxMCB8IDB4RDgwMCwgaGlnaCAmIDB4M0ZGIHwgMHhEQzAwICk7XG59XG5cbmZ1bmN0aW9uIHVuZXNjYXBlQ1NTKHN0cil7XG5cdHJldHVybiBzdHIucmVwbGFjZShyZV9lc2NhcGUsIGZ1bmVzY2FwZSk7XG59XG5cbmZ1bmN0aW9uIGlzV2hpdGVzcGFjZShjKXtcblx0cmV0dXJuIGMgPT09IFwiIFwiIHx8IGMgPT09IFwiXFxuXCIgfHwgYyA9PT0gXCJcXHRcIiB8fCBjID09PSBcIlxcZlwiIHx8IGMgPT09IFwiXFxyXCI7XG59XG5cbmZ1bmN0aW9uIHBhcnNlKHNlbGVjdG9yLCBvcHRpb25zKXtcblx0dmFyIHN1YnNlbGVjdHMgPSBbXTtcblxuXHRzZWxlY3RvciA9IHBhcnNlU2VsZWN0b3Ioc3Vic2VsZWN0cywgc2VsZWN0b3IgKyBcIlwiLCBvcHRpb25zKTtcblxuXHRpZihzZWxlY3RvciAhPT0gXCJcIil7XG5cdFx0dGhyb3cgbmV3IFN5bnRheEVycm9yKFwiVW5tYXRjaGVkIHNlbGVjdG9yOiBcIiArIHNlbGVjdG9yKTtcblx0fVxuXG5cdHJldHVybiBzdWJzZWxlY3RzO1xufVxuXG5mdW5jdGlvbiBwYXJzZVNlbGVjdG9yKHN1YnNlbGVjdHMsIHNlbGVjdG9yLCBvcHRpb25zKXtcblx0dmFyIHRva2VucyA9IFtdLFxuXHRcdHNhd1dTID0gZmFsc2UsXG5cdFx0ZGF0YSwgZmlyc3RDaGFyLCBuYW1lLCBxdW90O1xuXG5cdGZ1bmN0aW9uIGdldE5hbWUoKXtcblx0XHR2YXIgc3ViID0gc2VsZWN0b3IubWF0Y2gocmVfbmFtZSlbMF07XG5cdFx0c2VsZWN0b3IgPSBzZWxlY3Rvci5zdWJzdHIoc3ViLmxlbmd0aCk7XG5cdFx0cmV0dXJuIHVuZXNjYXBlQ1NTKHN1Yik7XG5cdH1cblxuXHRmdW5jdGlvbiBzdHJpcFdoaXRlc3BhY2Uoc3RhcnQpe1xuXHRcdHdoaWxlKGlzV2hpdGVzcGFjZShzZWxlY3Rvci5jaGFyQXQoc3RhcnQpKSkgc3RhcnQrKztcblx0XHRzZWxlY3RvciA9IHNlbGVjdG9yLnN1YnN0cihzdGFydCk7XG5cdH1cblxuXHRmdW5jdGlvbiBpc0VzY2FwZWQocG9zKSB7XG5cdFx0dmFyIHNsYXNoQ291bnQgPSAwO1xuXG5cdFx0d2hpbGUgKHNlbGVjdG9yLmNoYXJBdCgtLXBvcykgPT09IFwiXFxcXFwiKSBzbGFzaENvdW50Kys7XG5cdFx0cmV0dXJuIChzbGFzaENvdW50ICYgMSkgPT09IDE7XG5cdH1cblxuXHRzdHJpcFdoaXRlc3BhY2UoMCk7XG5cblx0d2hpbGUoc2VsZWN0b3IgIT09IFwiXCIpe1xuXHRcdGZpcnN0Q2hhciA9IHNlbGVjdG9yLmNoYXJBdCgwKTtcblxuXHRcdGlmKGlzV2hpdGVzcGFjZShmaXJzdENoYXIpKXtcblx0XHRcdHNhd1dTID0gdHJ1ZTtcblx0XHRcdHN0cmlwV2hpdGVzcGFjZSgxKTtcblx0XHR9IGVsc2UgaWYoZmlyc3RDaGFyIGluIHNpbXBsZVNlbGVjdG9ycyl7XG5cdFx0XHR0b2tlbnMucHVzaCh7dHlwZTogc2ltcGxlU2VsZWN0b3JzW2ZpcnN0Q2hhcl19KTtcblx0XHRcdHNhd1dTID0gZmFsc2U7XG5cblx0XHRcdHN0cmlwV2hpdGVzcGFjZSgxKTtcblx0XHR9IGVsc2UgaWYoZmlyc3RDaGFyID09PSBcIixcIil7XG5cdFx0XHRpZih0b2tlbnMubGVuZ3RoID09PSAwKXtcblx0XHRcdFx0dGhyb3cgbmV3IFN5bnRheEVycm9yKFwiZW1wdHkgc3ViLXNlbGVjdG9yXCIpO1xuXHRcdFx0fVxuXHRcdFx0c3Vic2VsZWN0cy5wdXNoKHRva2Vucyk7XG5cdFx0XHR0b2tlbnMgPSBbXTtcblx0XHRcdHNhd1dTID0gZmFsc2U7XG5cdFx0XHRzdHJpcFdoaXRlc3BhY2UoMSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGlmKHNhd1dTKXtcblx0XHRcdFx0aWYodG9rZW5zLmxlbmd0aCA+IDApe1xuXHRcdFx0XHRcdHRva2Vucy5wdXNoKHt0eXBlOiBcImRlc2NlbmRhbnRcIn0pO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHNhd1dTID0gZmFsc2U7XG5cdFx0XHR9XG5cblx0XHRcdGlmKGZpcnN0Q2hhciA9PT0gXCIqXCIpe1xuXHRcdFx0XHRzZWxlY3RvciA9IHNlbGVjdG9yLnN1YnN0cigxKTtcblx0XHRcdFx0dG9rZW5zLnB1c2goe3R5cGU6IFwidW5pdmVyc2FsXCJ9KTtcblx0XHRcdH0gZWxzZSBpZihmaXJzdENoYXIgaW4gYXR0cmliU2VsZWN0b3JzKXtcblx0XHRcdFx0c2VsZWN0b3IgPSBzZWxlY3Rvci5zdWJzdHIoMSk7XG5cdFx0XHRcdHRva2Vucy5wdXNoKHtcblx0XHRcdFx0XHR0eXBlOiBcImF0dHJpYnV0ZVwiLFxuXHRcdFx0XHRcdG5hbWU6IGF0dHJpYlNlbGVjdG9yc1tmaXJzdENoYXJdWzBdLFxuXHRcdFx0XHRcdGFjdGlvbjogYXR0cmliU2VsZWN0b3JzW2ZpcnN0Q2hhcl1bMV0sXG5cdFx0XHRcdFx0dmFsdWU6IGdldE5hbWUoKSxcblx0XHRcdFx0XHRpZ25vcmVDYXNlOiBmYWxzZVxuXHRcdFx0XHR9KTtcblx0XHRcdH0gZWxzZSBpZihmaXJzdENoYXIgPT09IFwiW1wiKXtcblx0XHRcdFx0c2VsZWN0b3IgPSBzZWxlY3Rvci5zdWJzdHIoMSk7XG5cdFx0XHRcdGRhdGEgPSBzZWxlY3Rvci5tYXRjaChyZV9hdHRyKTtcblx0XHRcdFx0aWYoIWRhdGEpe1xuXHRcdFx0XHRcdHRocm93IG5ldyBTeW50YXhFcnJvcihcIk1hbGZvcm1lZCBhdHRyaWJ1dGUgc2VsZWN0b3I6IFwiICsgc2VsZWN0b3IpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHNlbGVjdG9yID0gc2VsZWN0b3Iuc3Vic3RyKGRhdGFbMF0ubGVuZ3RoKTtcblx0XHRcdFx0bmFtZSA9IHVuZXNjYXBlQ1NTKGRhdGFbMV0pO1xuXG5cdFx0XHRcdGlmKFxuXHRcdFx0XHRcdCFvcHRpb25zIHx8IChcblx0XHRcdFx0XHRcdFwibG93ZXJDYXNlQXR0cmlidXRlTmFtZXNcIiBpbiBvcHRpb25zID9cblx0XHRcdFx0XHRcdFx0b3B0aW9ucy5sb3dlckNhc2VBdHRyaWJ1dGVOYW1lcyA6XG5cdFx0XHRcdFx0XHRcdCFvcHRpb25zLnhtbE1vZGVcblx0XHRcdFx0XHQpXG5cdFx0XHRcdCl7XG5cdFx0XHRcdFx0bmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHRva2Vucy5wdXNoKHtcblx0XHRcdFx0XHR0eXBlOiBcImF0dHJpYnV0ZVwiLFxuXHRcdFx0XHRcdG5hbWU6IG5hbWUsXG5cdFx0XHRcdFx0YWN0aW9uOiBhY3Rpb25UeXBlc1tkYXRhWzJdXSxcblx0XHRcdFx0XHR2YWx1ZTogdW5lc2NhcGVDU1MoZGF0YVs0XSB8fCBkYXRhWzVdIHx8IFwiXCIpLFxuXHRcdFx0XHRcdGlnbm9yZUNhc2U6ICEhZGF0YVs2XVxuXHRcdFx0XHR9KTtcblxuXHRcdFx0fSBlbHNlIGlmKGZpcnN0Q2hhciA9PT0gXCI6XCIpe1xuXHRcdFx0XHRpZihzZWxlY3Rvci5jaGFyQXQoMSkgPT09IFwiOlwiKXtcblx0XHRcdFx0XHRzZWxlY3RvciA9IHNlbGVjdG9yLnN1YnN0cigyKTtcblx0XHRcdFx0XHR0b2tlbnMucHVzaCh7dHlwZTogXCJwc2V1ZG8tZWxlbWVudFwiLCBuYW1lOiBnZXROYW1lKCkudG9Mb3dlckNhc2UoKX0pO1xuXHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0c2VsZWN0b3IgPSBzZWxlY3Rvci5zdWJzdHIoMSk7XG5cblx0XHRcdFx0bmFtZSA9IGdldE5hbWUoKS50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRkYXRhID0gbnVsbDtcblxuXHRcdFx0XHRpZihzZWxlY3Rvci5jaGFyQXQoMCkgPT09IFwiKFwiKXtcblx0XHRcdFx0XHRpZihuYW1lIGluIHVucGFja1BzZXVkb3Mpe1xuXHRcdFx0XHRcdFx0cXVvdCA9IHNlbGVjdG9yLmNoYXJBdCgxKTtcblx0XHRcdFx0XHRcdHZhciBxdW90ZWQgPSBxdW90IGluIHF1b3RlcztcblxuXHRcdFx0XHRcdFx0c2VsZWN0b3IgPSBzZWxlY3Rvci5zdWJzdHIocXVvdGVkICsgMSk7XG5cblx0XHRcdFx0XHRcdGRhdGEgPSBbXTtcblx0XHRcdFx0XHRcdHNlbGVjdG9yID0gcGFyc2VTZWxlY3RvcihkYXRhLCBzZWxlY3Rvciwgb3B0aW9ucyk7XG5cblx0XHRcdFx0XHRcdGlmKHF1b3RlZCl7XG5cdFx0XHRcdFx0XHRcdGlmKHNlbGVjdG9yLmNoYXJBdCgwKSAhPT0gcXVvdCl7XG5cdFx0XHRcdFx0XHRcdFx0dGhyb3cgbmV3IFN5bnRheEVycm9yKFwidW5tYXRjaGVkIHF1b3RlcyBpbiA6XCIgKyBuYW1lKTtcblx0XHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0XHRzZWxlY3RvciA9IHNlbGVjdG9yLnN1YnN0cigxKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRpZihzZWxlY3Rvci5jaGFyQXQoMCkgIT09IFwiKVwiKXtcblx0XHRcdFx0XHRcdFx0dGhyb3cgbmV3IFN5bnRheEVycm9yKFwibWlzc2luZyBjbG9zaW5nIHBhcmVudGhlc2lzIGluIDpcIiArIG5hbWUgKyBcIiBcIiArIHNlbGVjdG9yKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0c2VsZWN0b3IgPSBzZWxlY3Rvci5zdWJzdHIoMSk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHZhciBwb3MgPSAxLCBjb3VudGVyID0gMTtcblxuXHRcdFx0XHRcdFx0Zm9yKDsgY291bnRlciA+IDAgJiYgcG9zIDwgc2VsZWN0b3IubGVuZ3RoOyBwb3MrKyl7XG5cdFx0XHRcdFx0XHRcdGlmKHNlbGVjdG9yLmNoYXJBdChwb3MpID09PSBcIihcIiAmJiAhaXNFc2NhcGVkKHBvcykpIGNvdW50ZXIrKztcblx0XHRcdFx0XHRcdFx0ZWxzZSBpZihzZWxlY3Rvci5jaGFyQXQocG9zKSA9PT0gXCIpXCIgJiYgIWlzRXNjYXBlZChwb3MpKSBjb3VudGVyLS07XG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmKGNvdW50ZXIpe1xuXHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgU3ludGF4RXJyb3IoXCJwYXJlbnRoZXNpcyBub3QgbWF0Y2hlZFwiKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0ZGF0YSA9IHNlbGVjdG9yLnN1YnN0cigxLCBwb3MgLSAyKTtcblx0XHRcdFx0XHRcdHNlbGVjdG9yID0gc2VsZWN0b3Iuc3Vic3RyKHBvcyk7XG5cblx0XHRcdFx0XHRcdGlmKG5hbWUgaW4gc3RyaXBRdW90ZXNGcm9tUHNldWRvcyl7XG5cdFx0XHRcdFx0XHRcdHF1b3QgPSBkYXRhLmNoYXJBdCgwKTtcblxuXHRcdFx0XHRcdFx0XHRpZihxdW90ID09PSBkYXRhLnNsaWNlKC0xKSAmJiBxdW90IGluIHF1b3Rlcyl7XG5cdFx0XHRcdFx0XHRcdFx0ZGF0YSA9IGRhdGEuc2xpY2UoMSwgLTEpO1xuXHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0ZGF0YSA9IHVuZXNjYXBlQ1NTKGRhdGEpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdHRva2Vucy5wdXNoKHt0eXBlOiBcInBzZXVkb1wiLCBuYW1lOiBuYW1lLCBkYXRhOiBkYXRhfSk7XG5cdFx0XHR9IGVsc2UgaWYocmVfbmFtZS50ZXN0KHNlbGVjdG9yKSl7XG5cdFx0XHRcdG5hbWUgPSBnZXROYW1lKCk7XG5cblx0XHRcdFx0aWYoIW9wdGlvbnMgfHwgKFwibG93ZXJDYXNlVGFnc1wiIGluIG9wdGlvbnMgPyBvcHRpb25zLmxvd2VyQ2FzZVRhZ3MgOiAhb3B0aW9ucy54bWxNb2RlKSl7XG5cdFx0XHRcdFx0bmFtZSA9IG5hbWUudG9Mb3dlckNhc2UoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHRva2Vucy5wdXNoKHt0eXBlOiBcInRhZ1wiLCBuYW1lOiBuYW1lfSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZih0b2tlbnMubGVuZ3RoICYmIHRva2Vuc1t0b2tlbnMubGVuZ3RoIC0gMV0udHlwZSA9PT0gXCJkZXNjZW5kYW50XCIpe1xuXHRcdFx0XHRcdHRva2Vucy5wb3AoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRhZGRUb2tlbihzdWJzZWxlY3RzLCB0b2tlbnMpO1xuXHRcdFx0XHRyZXR1cm4gc2VsZWN0b3I7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0YWRkVG9rZW4oc3Vic2VsZWN0cywgdG9rZW5zKTtcblxuXHRyZXR1cm4gc2VsZWN0b3I7XG59XG5cbmZ1bmN0aW9uIGFkZFRva2VuKHN1YnNlbGVjdHMsIHRva2Vucyl7XG5cdGlmKHN1YnNlbGVjdHMubGVuZ3RoID4gMCAmJiB0b2tlbnMubGVuZ3RoID09PSAwKXtcblx0XHR0aHJvdyBuZXcgU3ludGF4RXJyb3IoXCJlbXB0eSBzdWItc2VsZWN0b3JcIik7XG5cdH1cblxuXHRzdWJzZWxlY3RzLnB1c2godG9rZW5zKTtcbn1cbiJdfQ==